webpackJsonp([31],{1717:function(e,a,t){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a.default=e,a}function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0});var s=t(6),i=l(s),r=t(2),o=l(r),d=t(4),u=l(d),m=t(5),c=l(m),f=t(3),g=l(f),p=t(1667),h=l(p),E=t(1662),w=l(E),v=t(332),_=l(v),b=t(41),S=n(b),M=t(333),y=t(46),N=t(79),I=l(N),L=t(15),k=l(L),C=t(28),F=l(C),P=t(20),U=n(P),D=t(90),A=n(D),O=t(11),T=n(O),q=t(8),G=l(q),R=t(13),W=t(37),x=t(1),B=l(x),z=t(1659),H=l(z),j=function(a){function t(a){(0,o.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this,a));n.preSubmit=n.preSubmit.bind(n),n.submit=n.submit.bind(n),n.finishSignin=n.finishSignin.bind(n),n.handleLoginIdChange=n.handleLoginIdChange.bind(n),n.handlePasswordChange=n.handlePasswordChange.bind(n);var l="";return n.props.location.query.extra===G.default.SIGNIN_VERIFIED&&n.props.location.query.email&&(l=n.props.location.query.email),n.state={ldapEnabled:"true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_config.EnableLdap,usernameSigninEnabled:"true"===e.window.mm_config.EnableSignInWithUsername,emailSigninEnabled:"true"===e.window.mm_config.EnableSignInWithEmail,samlEnabled:"true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_config.EnableSaml,loginId:l,password:"",showMfa:!1,loading:!1},n}return(0,g.default)(t,a),(0,c.default)(t,null,[{key:"propTypes",get:function(){return{location:B.default.PropTypes.object.isRequired,params:B.default.PropTypes.object.isRequired}}}]),(0,c.default)(t,[{key:"componentDidMount",value:function(){document.title=e.window.mm_config.SiteName,I.default.removeGlobalItem("team"),k.default.getCurrentUser()&&S.redirectUserToDefaultTeam(),this.props.location.query.extra===G.default.SIGNIN_VERIFIED&&this.props.location.query.email&&this.refs.password.focus(),U.checkVersion()}},{key:"preSubmit",value:function(a){var t=this;a.preventDefault();var n=this.refs.loginId.value;n!==this.state.loginId&&this.setState({loginId:n});var l=this.refs.password.value;if(l!==this.state.password&&this.setState({password:l}),!(n=n.trim().toLowerCase())){var s="login.no";return this.state.emailSigninEnabled&&(s+="Email"),this.state.usernameSigninEnabled&&(s+="Username"),this.state.ldapEnabled&&(s+="LdapUsername"),void this.setState({serverError:B.default.createElement(R.FormattedMessage,{id:s,values:{ldapUsername:e.window.mm_config.LdapLoginFieldName||T.localizeMessage("login.ldapUsernameLower","AD/LDAP username")}})})}if(!l)return void this.setState({serverError:B.default.createElement(R.FormattedMessage,{id:"login.noPassword",defaultMessage:"Please enter your password"})});(0,y.checkMfa)(n,function(e){e?t.setState({showMfa:!0}):t.submit(n,l,"")},function(e){t.setState({serverError:e.message})})}},{key:"submit",value:function(e,a,t){var n=this;this.setState({serverError:null,loading:!0}),(0,y.webLogin)(e,a,t,function(){var e=n.props.location.query.h,a=n.props.location.query.d,t=n.props.location.query.id;if(t||e)return void(0,M.addUserToTeamFromInvite)(a,e,t,function(e){n.finishSignin(e)},function(){n.finishSignin()});n.finishSignin()},function(a){"api.user.login.not_verified.app_error"===a.id?W.browserHistory.push("/should_verify_email?&email="+encodeURIComponent(e)):"store.sql_user.get_for_login.app_error"===a.id||"ent.ldap.do_login.user_not_registered.app_error"===a.id?n.setState({showMfa:!1,loading:!1,serverError:B.default.createElement(R.FormattedMessage,{id:"login.userNotFound",defaultMessage:"We couldn't find an account matching your login credentials."})}):"api.user.check_user_password.invalid.app_error"===a.id||"ent.ldap.do_login.invalid_password.app_error"===a.id?n.setState({showMfa:!1,loading:!1,serverError:B.default.createElement(R.FormattedMessage,{id:"login.invalidPassword",defaultMessage:"Your password is incorrect."})}):n.setState({showMfa:!1,serverError:a.message,loading:!1})})}},{key:"finishSignin",value:function(e){var a=this;S.emitInitialLoad(function(){var t=a.props.location.query;S.loadDefaultLocale(),t.redirect_to?W.browserHistory.push(t.redirect_to):e?W.browserHistory.push("/"+e.name):S.redirectUserToDefaultTeam()})}},{key:"handleLoginIdChange",value:function(e){this.setState({loginId:e.target.value})}},{key:"handlePasswordChange",value:function(e){this.setState({password:e.target.value})}},{key:"createCustomLogin",value:function(){if("true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_license.CustomBrand&&"true"===e.window.mm_config.EnableCustomBrand){var a=e.window.mm_config.CustomBrandText||"";return B.default.createElement("div",null,B.default.createElement("img",{src:F.default.getAdminRoute()+"/get_brand_image"}),B.default.createElement("p",{dangerouslySetInnerHTML:{__html:A.formatText(a)}}))}return null}},{key:"createLoginPlaceholder",value:function(){var a=this.state.ldapEnabled,t=this.state.usernameSigninEnabled,n=this.state.emailSigninEnabled,l=[];return n&&l.push(T.localizeMessage("login.email","Email")),t&&l.push(T.localizeMessage("login.username","Username")),a&&(e.window.mm_config.LdapLoginFieldName?l.push(e.window.mm_config.LdapLoginFieldName):l.push(T.localizeMessage("login.ldapUsername","AD/LDAP Username"))),l.length>=2?l.slice(0,l.length-1).join(", ")+T.localizeMessage("login.placeholderOr"," or ")+l[l.length-1]:1===l.length?l[0]:""}},{key:"checkSignUpEnabled",value:function(){return"true"===e.window.mm_config.EnableSignUpWithEmail||"true"===e.window.mm_config.EnableSignUpWithGitLab||"true"===e.window.mm_config.EnableSignUpWithOffice365||"true"===e.window.mm_config.EnableSignUpWithGoogle||"true"===e.window.mm_config.EnableLdap||"true"===e.window.mm_config.EnableSaml}},{key:"createLoginOptions",value:function(){var a=this.props.location.query.extra,t="";a&&(a===G.default.SIGNIN_CHANGE?t=B.default.createElement("div",{className:"alert alert-success"},B.default.createElement("i",{className:"fa fa-check"}),B.default.createElement(R.FormattedMessage,{id:"login.changed",defaultMessage:" Sign-in method changed successfully"})):a===G.default.SIGNIN_VERIFIED?t=B.default.createElement("div",{className:"alert alert-success"},B.default.createElement("i",{className:"fa fa-check"}),B.default.createElement(R.FormattedMessage,{id:"login.verified",defaultMessage:" Email Verified"})):a===G.default.SESSION_EXPIRED?t=B.default.createElement("div",{className:"alert alert-warning"},B.default.createElement("i",{className:"fa fa-exclamation-triangle"}),B.default.createElement(R.FormattedMessage,{id:"login.session_expired",defaultMessage:" Your session has expired. Please login again."})):a===G.default.PASSWORD_CHANGE&&(t=B.default.createElement("div",{className:"alert alert-success"},B.default.createElement("i",{className:"fa fa-check"}),B.default.createElement(R.FormattedMessage,{id:"login.passwordChanged",defaultMessage:" Password updated successfully"}))));var n=[],l=this.state.ldapEnabled,s="true"===e.window.mm_config.EnableSignUpWithGitLab,i="true"===e.window.mm_config.EnableSignUpWithGoogle,r="true"===e.window.mm_config.EnableSignUpWithOffice365,o=this.state.samlEnabled,d=this.state.usernameSigninEnabled,u=this.state.emailSigninEnabled;if(u||d||l){var m="";this.state.serverError&&(m=" has-error");var c=B.default.createElement(R.FormattedMessage,{id:"login.signIn",defaultMessage:"Sign in"});this.state.loading&&(c=B.default.createElement("span",null,B.default.createElement("span",{className:"fa fa-refresh icon--rotate"}),B.default.createElement(R.FormattedMessage,{id:"login.signInLoading",defaultMessage:"Signing in..."}))),n.push(B.default.createElement("form",{key:"loginBoxes",onSubmit:this.preSubmit},B.default.createElement("div",{className:"signup__email-container"},B.default.createElement(_.default,{error:this.state.serverError,margin:!0}),B.default.createElement("div",{className:"form-group"+m},B.default.createElement("input",{className:"form-control",ref:"loginId",name:"loginId",value:this.state.loginId,onChange:this.handleLoginIdChange,placeholder:this.createLoginPlaceholder(),spellCheck:"false",autoCapitalize:"off"})),B.default.createElement("div",{className:"form-group"+m},B.default.createElement("input",{type:"password",className:"form-control",ref:"password",name:"password",value:this.state.password,onChange:this.handlePasswordChange,placeholder:T.localizeMessage("login.password","Password"),spellCheck:"false"})),B.default.createElement("div",{className:"form-group"},B.default.createElement("button",{id:"loginButton",type:"submit",className:"btn btn-primary"},c)))))}return"true"===e.window.mm_config.EnableOpenServer&&this.checkSignUpEnabled()&&n.push(B.default.createElement("div",{className:"form-group",key:"signup"},B.default.createElement("span",null,B.default.createElement(R.FormattedMessage,{id:"login.noAccount",defaultMessage:"Don't have an account? "}),B.default.createElement(W.Link,{to:"/signup_user_complete"+this.props.location.search,className:"signup-team-login"},B.default.createElement(R.FormattedMessage,{id:"login.create",defaultMessage:"Create one now"}))))),(d||u)&&n.push(B.default.createElement("div",{key:"forgotPassword",className:"form-group"},B.default.createElement(W.Link,{to:"/reset_password"},B.default.createElement(R.FormattedMessage,{id:"login.forgot",defaultMessage:"I forgot my password"})))),(u||d||l)&&(s||i||o||r)&&(n.push(B.default.createElement("div",{key:"divider",className:"or__container"},B.default.createElement(R.FormattedMessage,{id:"login.or",defaultMessage:"or"}))),n.push(B.default.createElement("h5",{key:"oauthHeader"},B.default.createElement(R.FormattedMessage,{id:"login.signInWith",defaultMessage:"Sign in with:"})))),s&&n.push(B.default.createElement("a",{className:"btn btn-custom-login gitlab",key:"gitlab",href:F.default.getOAuthRoute()+"/gitlab/login"+this.props.location.search},B.default.createElement("span",{className:"icon"}),B.default.createElement("span",null,B.default.createElement(R.FormattedMessage,{id:"login.gitlab",defaultMessage:"GitLab"})))),i&&n.push(B.default.createElement("a",{className:"btn btn-custom-login google",key:"google",href:F.default.getOAuthRoute()+"/google/login"+this.props.location.search},B.default.createElement("span",{className:"icon"}),B.default.createElement("span",null,B.default.createElement(R.FormattedMessage,{id:"login.google",defaultMessage:"Google Apps"})))),r&&n.push(B.default.createElement("a",{className:"btn btn-custom-login office365",key:"office365",href:F.default.getOAuthRoute()+"/office365/login"+this.props.location.search},B.default.createElement("span",{className:"icon"}),B.default.createElement("span",null,B.default.createElement(R.FormattedMessage,{id:"login.office365",defaultMessage:"Office 365"})))),o&&n.push(B.default.createElement("a",{className:"btn btn-custom-login saml",key:"saml",href:"/login/sso/saml"+this.props.location.search},B.default.createElement("span",{className:"icon fa fa-lock fa--margin-top"}),B.default.createElement("span",null,e.window.mm_config.SamlLoginButtonText))),0===n.length&&n.push(B.default.createElement(_.default,{error:B.default.createElement(R.FormattedMessage,{id:"login.noMethods",defaultMessage:"No sign-in methods are enabled. Please contact your System Administrator."}),margin:!0})),B.default.createElement("div",null,t,n)}},{key:"render",value:function(){var a=void 0,t=void 0,n=void 0;this.state.showMfa?a=B.default.createElement(h.default,{loginId:this.state.loginId,password:this.state.password,submit:this.submit}):(a=this.createLoginOptions(),(t=this.createCustomLogin())&&(n="branded"));var l=null;return l="true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_license.CustomBrand&&"true"===e.window.mm_config.EnableCustomBrand?e.window.mm_config.CustomDescriptionText:B.default.createElement(R.FormattedMessage,{id:"web.root.signup_info",defaultMessage:"All team communication in one place, searchable and accessible anywhere"}),B.default.createElement("div",null,B.default.createElement(w.default,null),B.default.createElement("div",{className:"col-sm-12"},B.default.createElement("div",{className:"signup-team__container "+n},B.default.createElement("div",{className:"signup__markdown"},t),B.default.createElement("img",{className:"signup-team-logo",src:H.default}),B.default.createElement("div",{className:"signup__content"},B.default.createElement("h1",null,e.window.mm_config.SiteName),B.default.createElement("h4",{className:"color--light"},l),a))))}}]),t}(B.default.Component);a.default=j}).call(a,t(17))}});
//# sourceMappingURL=31.4b9c27148648ebf2204b.js.map