{"version":3,"sources":["webpack:///29.df4b65be83babd7776f5.js","webpack:///./components/mfa/components/setup.jsx"],"names":["webpackJsonp","1719","module","exports","__webpack_require__","global","_interopRequireWildcard","obj","__esModule","newObj","key","Object","prototype","hasOwnProperty","call","default","_interopRequireDefault","defineProperty","value","_getPrototypeOf","_getPrototypeOf2","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","_user_actions","_user_store","_user_store2","_utils","Utils","_react","_react2","_reactIntl","_es","Setup","_React$Component","props","this","_this","__proto__","submit","bind","state","secret","qrCode","_this2","user","getCurrentUser","mfa_active","browserHistory","push","generateMfaSecret","data","setState","qr_code","err","serverError","message","e","_this3","preventDefault","code","refs","replace","length","error","localizeMessage","activateMfa","id","formClass","errorContent","createElement","className","mfaRequired","window","mm_config","EnforceMultifactorAuthentication","FormattedHTMLMessage","defaultMessage","values","siteName","SiteName","onSubmit","style","maxHeight","src","FormattedMessage","ref","placeholder","autoFocus","type","Component","defaultProps","propTypes"],"mappings":"AAAAA,cAAc,KAERC,KACA,SAAUC,EAAQC,EAASC,GAEjC,cAC4B,SAASC,GA4CrC,QAASC,GAAwBC,GAAO,GAAIA,GAAOA,EAAIC,WAAc,MAAOD,EAAc,IAAIE,KAAa,IAAW,MAAPF,EAAe,IAAK,GAAIG,KAAOH,GAAWI,OAAOC,UAAUC,eAAeC,KAAKP,EAAKG,KAAMD,EAAOC,GAAOH,EAAIG,GAAgC,OAAtBD,GAAOM,QAAUR,EAAYE,EAElQ,QAASO,GAAuBT,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQQ,QAASR,GA5CvFI,OAAOM,eAAed,EAAS,cAC3Be,OAAO,GAGX,IAAIC,GAAkBf,EAAoB,GAEtCgB,EAAmBJ,EAAuBG,GAE1CE,EAAmBjB,EAAoB,GAEvCkB,EAAmBN,EAAuBK,GAE1CE,EAAgBnB,EAAoB,GAEpCoB,EAAgBR,EAAuBO,GAEvCE,EAA8BrB,EAAoB,GAElDsB,EAA8BV,EAAuBS,GAErDE,EAAavB,EAAoB,GAEjCwB,EAAaZ,EAAuBW,GC3BxCE,EAAAzB,EAAA,IAEA0B,EAAA1B,EAAA,ID+BI2B,EAAef,EAAuBc,GC7B1CE,EAAA5B,EAAA,IAAY6B,EDiCA3B,EAAwB0B,GC/BpCE,EAAA9B,EAAA,GDmCI+B,EAAUnB,EAAuBkB,GClCrCE,EAAAhC,EAAA,IACAiC,EAAAjC,EAAA,IAEqBkC,ED4CT,SAAUC,GC3ClB,QAAAD,GAAYE,IAAO,EAAAlB,EAAAP,SAAA0B,KAAAH,EAAA,IAAAI,IAAA,EAAAhB,EAAAX,SAAA0B,MAAAH,EAAAK,YAAA,EAAAvB,EAAAL,SAAAuB,IAAAxB,KAAA2B,KACTD,GADS,OAGfE,GAAKE,OAASF,EAAKE,OAAOC,KAAZH,GAEdA,EAAKI,OAASC,OAAQ,GAAIC,OAAQ,IALnBN,ED2NnB,OA/KA,EAAId,EAAWb,SAASuB,EAAOC,IAa/B,EAAIf,EAAcT,SAASuB,IACvB5B,IAAK,oBACLQ,MAAO,WCnDS,GAAA+B,GAAAR,KACVS,EAAOnB,EAAAhB,QAAUoC,gBACvB,KAAKD,GAAQA,EAAKE,WAEd,WADAf,GAAAgB,eAAeC,KAAK,MAIxB,EAAAzB,EAAA0B,mBACI,SAACC,GAAD,MAAUP,GAAKQ,UAAUV,OAAQS,EAAKT,OAAQC,OAAQQ,EAAKE,WAC3D,SAACC,GAAD,MAASV,GAAKQ,UAAUG,YAAaD,EAAIE,eD0D7CnD,IAAK,SACLQ,MAAO,SCvDJ4C,GAAG,GAAAC,GAAAtB,IACNqB,GAAEE,gBACF,IAAMC,GAAOxB,KAAKyB,KAAKD,KAAK/C,MAAMiD,QAAQ,MAAO,GACjD,KAAKF,GAAwB,IAAhBA,EAAKG,OAEd,WADA3B,MAAKgB,UAAUY,MAAOpC,EAAMqC,gBAAgB,sBAAuB,qDAIvE7B,MAAKgB,UAAUY,MAAO,QAEtB,EAAAxC,EAAA0C,aACIN,EACA,WACI5B,EAAAgB,eAAeC,KAAK,iBAExB,SAACK,GACG,GAAe,4CAAXA,EAAIa,GAEJ,WADAT,GAAKN,UAAUY,MAAOpC,EAAMqC,gBAAgB,oBAAqB,6EAGrEP,GAAKN,UAAUY,MAAOV,EAAIE,eD0DlCnD,IAAK,SACLQ,MAAO,WCrDP,GAAIuD,GAAY,aACZC,QACAjC,MAAKK,MAAMuB,QACXK,EAAevC,EAAApB,QAAA4D,cAAA,OAAKC,UAAU,wBAAuBzC,EAAApB,QAAA4D,cAAA,SAAOC,UAAU,iBAAiBnC,KAAKK,MAAMuB,QAClGI,GAAa,aAGjB,IAAII,SAeJ,OAdiE,SAA7DxE,EAAOyE,OAAOC,UAAUC,mCACxBH,EACI1C,EAAApB,QAAA4D,cAAA,SACIxC,EAAApB,QAAA4D,cAAAvC,EAAA6C,sBACIT,GAAG,qBACHU,eAAe,0EACfC,QACIC,SAAU/E,EAAOyE,OAAOC,UAAUM,cAQlDlD,EAAApB,QAAA4D,cAAA,WACIxC,EAAApB,QAAA4D,cAAA,QACIW,SAAU7C,KAAKG,OACfgC,UAAWH,GAEVI,EACD1C,EAAApB,QAAA4D,cAAA,SACIxC,EAAApB,QAAA4D,cAAAvC,EAAA6C,sBACIT,GAAG,kBACHU,eAAe,mUAGvB/C,EAAApB,QAAA4D,cAAA,SACIxC,EAAApB,QAAA4D,cAAAvC,EAAA6C,sBACIT,GAAG,kBACHU,eAAe,gHAGvB/C,EAAApB,QAAA4D,cAAA,OAAKC,UAAU,cACXzC,EAAApB,QAAA4D,cAAA,OAAKC,UAAU,aACXzC,EAAApB,QAAA4D,cAAA,OACIY,OAAQC,UAAW,KACnBC,IAAK,yBAA2BhD,KAAKK,MAAME,WAIvDb,EAAApB,QAAA4D,cAAA,WACAxC,EAAApB,QAAA4D,cAAA,OAAKC,UAAU,cACXzC,EAAApB,QAAA4D,cAAA,KAAGC,UAAU,aACTzC,EAAApB,QAAA4D,cAAAvC,EAAAsD,kBACIlB,GAAG,mBACHU,eAAe,mBACfC,QACIpC,OAAQN,KAAKK,MAAMC,YAKnCZ,EAAApB,QAAA4D,cAAA,SACIxC,EAAApB,QAAA4D,cAAAvC,EAAA6C,sBACIT,GAAG,kBACHU,eAAe,+EAGvB/C,EAAApB,QAAA4D,cAAA,SACIxC,EAAApB,QAAA4D,cAAA,SACIgB,IAAI,OACJf,UAAU,eACVgB,YAAa3D,EAAMqC,gBAAgB,iBAAkB,YACrDuB,WAAW,KAGlBnB,EACDvC,EAAApB,QAAA4D,cAAA,UACImB,KAAK,SACLlB,UAAU,mBAEVzC,EAAApB,QAAA4D,cAAAvC,EAAAsD,kBACIlB,GAAG,iBACHU,eAAe,gBD0FhC5C,GC5NwBH,EAAApB,QAAMgF,UD+NzC5F,GAAQY,QC/NauB,EA2IrBA,EAAM0D,gBAEN1D,EAAM2D,eDuFuBnF,KAAKX,EAASC,EAAoB","file":"29.df4b65be83babd7776f5.js","sourcesContent":["webpackJsonp([29],{\n\n/***/ 1719:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _getPrototypeOf = __webpack_require__(6);\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(2);\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(5);\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(4);\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(3);\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _user_actions = __webpack_require__(46);\n\nvar _user_store = __webpack_require__(15);\n\nvar _user_store2 = _interopRequireDefault(_user_store);\n\nvar _utils = __webpack_require__(11);\n\nvar Utils = _interopRequireWildcard(_utils);\n\nvar _react = __webpack_require__(1);\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactIntl = __webpack_require__(13);\n\nvar _es = __webpack_require__(37);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Copyright (c) 2016 Mattermost, Inc. All Rights Reserved.\n// See License.txt for license information.\n\nvar Setup = function (_React$Component) {\n    (0, _inherits3.default)(Setup, _React$Component);\n\n    function Setup(props) {\n        (0, _classCallCheck3.default)(this, Setup);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (Setup.__proto__ || (0, _getPrototypeOf2.default)(Setup)).call(this, props));\n\n        _this.submit = _this.submit.bind(_this);\n\n        _this.state = { secret: '', qrCode: '' };\n        return _this;\n    }\n\n    (0, _createClass3.default)(Setup, [{\n        key: 'componentDidMount',\n        value: function componentDidMount() {\n            var _this2 = this;\n\n            var user = _user_store2.default.getCurrentUser();\n            if (!user || user.mfa_active) {\n                _es.browserHistory.push('/');\n                return;\n            }\n\n            (0, _user_actions.generateMfaSecret)(function (data) {\n                return _this2.setState({ secret: data.secret, qrCode: data.qr_code });\n            }, function (err) {\n                return _this2.setState({ serverError: err.message });\n            });\n        }\n    }, {\n        key: 'submit',\n        value: function submit(e) {\n            var _this3 = this;\n\n            e.preventDefault();\n            var code = this.refs.code.value.replace(/\\s/g, '');\n            if (!code || code.length === 0) {\n                this.setState({ error: Utils.localizeMessage('mfa.setup.codeError', 'Please enter the code from Google Authenticator.') });\n                return;\n            }\n\n            this.setState({ error: null });\n\n            (0, _user_actions.activateMfa)(code, function () {\n                _es.browserHistory.push('/mfa/confirm');\n            }, function (err) {\n                if (err.id === 'ent.mfa.activate.authenticate.app_error') {\n                    _this3.setState({ error: Utils.localizeMessage('mfa.setup.badCode', 'Invalid code. If this issue persists, contact your System Administrator.') });\n                    return;\n                }\n                _this3.setState({ error: err.message });\n            });\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var formClass = 'form-group';\n            var errorContent = void 0;\n            if (this.state.error) {\n                errorContent = _react2.default.createElement(\n                    'div',\n                    { className: 'form-group has-error' },\n                    _react2.default.createElement(\n                        'label',\n                        { className: 'control-label' },\n                        this.state.error\n                    )\n                );\n                formClass += ' has-error';\n            }\n\n            var mfaRequired = void 0;\n            if (global.window.mm_config.EnforceMultifactorAuthentication === 'true') {\n                mfaRequired = _react2.default.createElement(\n                    'p',\n                    null,\n                    _react2.default.createElement(_reactIntl.FormattedHTMLMessage, {\n                        id: 'mfa.setup.required',\n                        defaultMessage: '<strong>Multi-factor authentication is required on {siteName}.</strong>',\n                        values: {\n                            siteName: global.window.mm_config.SiteName\n                        }\n                    })\n                );\n            }\n\n            return _react2.default.createElement(\n                'div',\n                null,\n                _react2.default.createElement(\n                    'form',\n                    {\n                        onSubmit: this.submit,\n                        className: formClass\n                    },\n                    mfaRequired,\n                    _react2.default.createElement(\n                        'p',\n                        null,\n                        _react2.default.createElement(_reactIntl.FormattedHTMLMessage, {\n                            id: 'mfa.setup.step1',\n                            defaultMessage: '<strong>Step 1: </strong>On your phone, download Google Authenticator from <a target=\\'_blank\\' href=\\'https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8\\'>iTunes</a> or <a target=\\'_blank\\' href=\\'https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en\\'>Google Play</a>'\n                        })\n                    ),\n                    _react2.default.createElement(\n                        'p',\n                        null,\n                        _react2.default.createElement(_reactIntl.FormattedHTMLMessage, {\n                            id: 'mfa.setup.step2',\n                            defaultMessage: '<strong>Step 2: </strong>Use Google Authenticator to scan this QR code, or manually type in the secret key'\n                        })\n                    ),\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'form-group' },\n                        _react2.default.createElement(\n                            'div',\n                            { className: 'col-sm-12' },\n                            _react2.default.createElement('img', {\n                                style: { maxHeight: 170 },\n                                src: 'data:image/png;base64,' + this.state.qrCode\n                            })\n                        )\n                    ),\n                    _react2.default.createElement('br', null),\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'form-group' },\n                        _react2.default.createElement(\n                            'p',\n                            { className: 'col-sm-12' },\n                            _react2.default.createElement(_reactIntl.FormattedMessage, {\n                                id: 'mfa.setup.secret',\n                                defaultMessage: 'Secret: {secret}',\n                                values: {\n                                    secret: this.state.secret\n                                }\n                            })\n                        )\n                    ),\n                    _react2.default.createElement(\n                        'p',\n                        null,\n                        _react2.default.createElement(_reactIntl.FormattedHTMLMessage, {\n                            id: 'mfa.setup.step3',\n                            defaultMessage: '<strong>Step 3: </strong>Enter the code generated by Google Authenticator'\n                        })\n                    ),\n                    _react2.default.createElement(\n                        'p',\n                        null,\n                        _react2.default.createElement('input', {\n                            ref: 'code',\n                            className: 'form-control',\n                            placeholder: Utils.localizeMessage('mfa.setup.code', 'MFA Code'),\n                            autoFocus: true\n                        })\n                    ),\n                    errorContent,\n                    _react2.default.createElement(\n                        'button',\n                        {\n                            type: 'submit',\n                            className: 'btn btn-primary'\n                        },\n                        _react2.default.createElement(_reactIntl.FormattedMessage, {\n                            id: 'mfa.setup.save',\n                            defaultMessage: 'Save'\n                        })\n                    )\n                )\n            );\n        }\n    }]);\n    return Setup;\n}(_react2.default.Component);\n\nexports.default = Setup;\n\n\nSetup.defaultProps = {};\nSetup.propTypes = {};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(17)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// 29.df4b65be83babd7776f5.js","// Copyright (c) 2016 Mattermost, Inc. All Rights Reserved.\n// See License.txt for license information.\n\nimport {generateMfaSecret, activateMfa} from 'actions/user_actions.jsx';\n\nimport UserStore from 'stores/user_store.jsx';\n\nimport * as Utils from 'utils/utils.jsx';\n\nimport React from 'react';\nimport {FormattedMessage, FormattedHTMLMessage} from 'react-intl';\nimport {browserHistory} from 'react-router/es6';\n\nexport default class Setup extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.submit = this.submit.bind(this);\n\n        this.state = {secret: '', qrCode: ''};\n    }\n\n    componentDidMount() {\n        const user = UserStore.getCurrentUser();\n        if (!user || user.mfa_active) {\n            browserHistory.push('/');\n            return;\n        }\n\n        generateMfaSecret(\n            (data) => this.setState({secret: data.secret, qrCode: data.qr_code}),\n            (err) => this.setState({serverError: err.message})\n        );\n    }\n\n    submit(e) {\n        e.preventDefault();\n        const code = this.refs.code.value.replace(/\\s/g, '');\n        if (!code || code.length === 0) {\n            this.setState({error: Utils.localizeMessage('mfa.setup.codeError', 'Please enter the code from Google Authenticator.')});\n            return;\n        }\n\n        this.setState({error: null});\n\n        activateMfa(\n            code,\n            () => {\n                browserHistory.push('/mfa/confirm');\n            },\n            (err) => {\n                if (err.id === 'ent.mfa.activate.authenticate.app_error') {\n                    this.setState({error: Utils.localizeMessage('mfa.setup.badCode', 'Invalid code. If this issue persists, contact your System Administrator.')});\n                    return;\n                }\n                this.setState({error: err.message});\n            }\n        );\n    }\n\n    render() {\n        let formClass = 'form-group';\n        let errorContent;\n        if (this.state.error) {\n            errorContent = <div className='form-group has-error'><label className='control-label'>{this.state.error}</label></div>;\n            formClass += ' has-error';\n        }\n\n        let mfaRequired;\n        if (global.window.mm_config.EnforceMultifactorAuthentication === 'true') {\n            mfaRequired = (\n                <p>\n                    <FormattedHTMLMessage\n                        id='mfa.setup.required'\n                        defaultMessage='<strong>Multi-factor authentication is required on {siteName}.</strong>'\n                        values={{\n                            siteName: global.window.mm_config.SiteName\n                        }}\n                    />\n                </p>\n            );\n        }\n\n        return (\n            <div>\n                <form\n                    onSubmit={this.submit}\n                    className={formClass}\n                >\n                    {mfaRequired}\n                    <p>\n                        <FormattedHTMLMessage\n                            id='mfa.setup.step1'\n                            defaultMessage=\"<strong>Step 1: </strong>On your phone, download Google Authenticator from <a target='_blank' href='https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8'>iTunes</a> or <a target='_blank' href='https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en'>Google Play</a>\"\n                        />\n                    </p>\n                    <p>\n                        <FormattedHTMLMessage\n                            id='mfa.setup.step2'\n                            defaultMessage='<strong>Step 2: </strong>Use Google Authenticator to scan this QR code, or manually type in the secret key'\n                        />\n                    </p>\n                    <div className='form-group'>\n                        <div className='col-sm-12'>\n                            <img\n                                style={{maxHeight: 170}}\n                                src={'data:image/png;base64,' + this.state.qrCode}\n                            />\n                        </div>\n                    </div>\n                    <br/>\n                    <div className='form-group'>\n                        <p className='col-sm-12'>\n                            <FormattedMessage\n                                id='mfa.setup.secret'\n                                defaultMessage='Secret: {secret}'\n                                values={{\n                                    secret: this.state.secret\n                                }}\n                            />\n                        </p>\n                    </div>\n                    <p>\n                        <FormattedHTMLMessage\n                            id='mfa.setup.step3'\n                            defaultMessage='<strong>Step 3: </strong>Enter the code generated by Google Authenticator'\n                        />\n                    </p>\n                    <p>\n                        <input\n                            ref='code'\n                            className='form-control'\n                            placeholder={Utils.localizeMessage('mfa.setup.code', 'MFA Code')}\n                            autoFocus={true}\n                        />\n                    </p>\n                    {errorContent}\n                    <button\n                        type='submit'\n                        className='btn btn-primary'\n                    >\n                        <FormattedMessage\n                            id='mfa.setup.save'\n                            defaultMessage='Save'\n                        />\n                    </button>\n                </form>\n            </div>\n        );\n    }\n}\n\nSetup.defaultProps = {\n};\nSetup.propTypes = {\n};\n\n\n\n// WEBPACK FOOTER //\n// ./components/mfa/components/setup.jsx"],"sourceRoot":""}