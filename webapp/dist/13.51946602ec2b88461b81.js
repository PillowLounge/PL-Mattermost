webpackJsonp([13],{1681:function(e,t,a){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(6),i=n(l),o=a(2),r=n(o),u=a(5),d=n(u),f=a(4),c=n(f),h=a(3),p=n(h),S=a(0),_=n(S),E=a(1),T=n(E),g=a(1672),C=n(g),P=a(1674),y=n(P),A=a(1673),v=n(A),m=a(2025),L=n(m),I=a(24),D=n(I),N=a(11),M=s(N),O=function(e){function t(e){(0,r.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.getStateFromStores=a.getStateFromStores.bind(a),a.isStateValid=a.isStateValid.bind(a),a.updateState=a.updateState.bind(a),a.state=a.getStateFromStores(e),a}return(0,p.default)(t,e),(0,d.default)(t,[{key:"getStateFromStores",value:function(e){var t=D.default.getByName(e.params.channel);return{channelId:t?t.id:""}}},{key:"isStateValid",value:function(){return""!==this.state.channelId}},{key:"updateState",value:function(){this.setState(this.getStateFromStores(this.props))}},{key:"componentDidMount",value:function(){D.default.addChangeListener(this.updateState),(0,_.default)("body").addClass("app__body")}},{key:"componentWillUnmount",value:function(){D.default.removeChangeListener(this.updateState),(0,_.default)("body").removeClass("app__body")}},{key:"componentWillReceiveProps",value:function(e){this.setState(this.getStateFromStores(e))}},{key:"shouldComponentUpdate",value:function(e,t){return!M.areObjectsEqual(e.params,this.props.params)||t.channelId!==this.state.channelId}},{key:"render",value:function(){return T.default.createElement("div",{id:"app-content",className:"app__content"},T.default.createElement(y.default,{overlayType:"center"}),T.default.createElement(C.default,{channelId:this.state.channelId}),T.default.createElement(L.default,null),T.default.createElement("div",{className:"post-create__container",id:"post-create"},T.default.createElement(v.default,null)))}}]),t}(T.default.Component);t.default=O,O.defaultProps={},O.propTypes={params:T.default.PropTypes.object.isRequired}},2025:function(e,t,a){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(31),i=n(l),o=a(6),r=n(o),u=a(2),d=n(u),f=a(5),c=n(f),h=a(4),p=n(h),S=a(3),_=n(S),E=a(2026),T=n(E),g=a(24),C=n(g),P=a(15),y=n(P),A=a(20),v=s(A),m=a(1),L=n(m),I=5,D=function(e){function t(e){(0,d.default)(this,t);var a=(0,p.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));a.onChannelChange=a.onChannelChange.bind(a);var s=C.default.getCurrentId(),n=C.default.getCurrent();return a.state={currentChannelId:s,channels:n?[n]:[]},a}return(0,_.default)(t,e),(0,c.default)(t,[{key:"componentDidMount",value:function(){C.default.addChangeListener(this.onChannelChange)}},{key:"componentWillUnmount",value:function(){y.default.getCurrentUser()&&v.viewChannel("",this.state.currentChannelId||""),C.default.removeChangeListener(this.onChannelChange)}},{key:"onChannelChange",value:function(){var e=(0,i.default)([],this.state.channels),t=C.default.getCurrent();if(t&&t.id!==this.state.currentChannelId){e.length>I&&e.shift();var a=e.map(function(e){return e.id}).indexOf(t.id);-1!==a&&e.splice(a,1),e.push(t),this.setState({currentChannelId:t.id,channels:e})}}},{key:"render",value:function(){for(var e=this.state.channels,t=this.state.currentChannelId,a=[],s=0;s<e.length;s++)a.push(L.default.createElement(T.default,{key:"postviewcontroller_"+e[s].id,channel:e[s],active:e[s].id===t}));return L.default.createElement("div",{id:"post-list"},a)}}]),t}(L.default.Component);t.default=D},2026:function(e,t,a){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(71),i=n(l),o=a(31),r=n(o),u=a(6),d=n(u),f=a(2),c=n(f),h=a(5),p=n(h),S=a(4),_=n(S),E=a(3),T=n(E),g=a(1677),C=n(g),P=a(164),y=n(P),A=a(42),v=n(A),m=a(15),L=n(m),I=a(140),D=n(I),N=a(24),M=n(N),O=a(23),w=n(O),Y=a(334),G=n(Y),b=a(11),R=s(b),V=a(8),k=n(V),B=a(1),U=n(B),j=k.default.Preferences,F=k.default.ScrollTypes,J=function(e){function t(e){(0,c.default)(this,t);var a=(0,_.default)(this,(t.__proto__||(0,d.default)(t)).call(this,e));a.onPreferenceChange=a.onPreferenceChange.bind(a),a.onUserChange=a.onUserChange.bind(a),a.onPostsChange=a.onPostsChange.bind(a),a.onTeamChange=a.onTeamChange.bind(a),a.onStatusChange=a.onStatusChange.bind(a),a.onPostsViewJumpRequest=a.onPostsViewJumpRequest.bind(a),a.onSetNewMessageIndicator=a.onSetNewMessageIndicator.bind(a),a.onPostListScroll=a.onPostListScroll.bind(a),a.onActivate=a.onActivate.bind(a),a.onDeactivate=a.onDeactivate.bind(a),a.onBusy=a.onBusy.bind(a);var s=e.channel,n=L.default.getProfiles(),l=Number.MAX_VALUE,i=Number.MAX_VALUE,o=M.default.getMyMember(s.id);null!=o&&(l=o.last_viewed_at,i=o.last_viewed_at);var u=v.default.getBool(k.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"join_leave",!0),f=(0,r.default)({},L.default.getStatuses()),h=0===D.default.getLatestPostFromPageTime(s.id);return a.state={channel:s,postList:D.default.filterPosts(s.id,u),currentUser:L.default.getCurrentUser(),currentTeamId:w.default.getCurrentId(),isBusy:G.default.isBusy(),profiles:n,statuses:f,atTop:D.default.getVisibilityAtTop(s.id),lastViewed:l,lastViewedBottom:i,ownNewMessage:!1,loading:h,scrollType:F.NEW_MESSAGE,displayNameType:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,"name_format","false"),displayPostsInCenter:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,j.CHANNEL_DISPLAY_MODE,j.CHANNEL_DISPLAY_MODE_DEFAULT)===j.CHANNEL_DISPLAY_MODE_CENTERED,compactDisplay:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,j.MESSAGE_DISPLAY,j.MESSAGE_DISPLAY_DEFAULT)===j.MESSAGE_DISPLAY_COMPACT,previewsCollapsed:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,j.COLLAPSE_DISPLAY,"false"),useMilitaryTime:v.default.getBool(k.default.Preferences.CATEGORY_DISPLAY_SETTINGS,j.USE_MILITARY_TIME,!1),flaggedPosts:v.default.getCategory(k.default.Preferences.CATEGORY_FLAGGED_POST)},a}return(0,T.default)(t,e),(0,p.default)(t,[{key:"componentDidMount",value:function(){this.props.active&&this.onActivate()}},{key:"componentWillUnmount",value:function(){this.props.active&&this.onDeactivate()}},{key:"onPreferenceChange",value:function(e){var t="";e===j.CATEGORY_DISPLAY_SETTINGS&&(t="_"+R.generateId());var a=v.default.getBool(k.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"join_leave",!0);this.setState({postList:D.default.filterPosts(this.state.channel.id,a),displayNameType:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,"name_format","false"),displayPostsInCenter:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,j.CHANNEL_DISPLAY_MODE,j.CHANNEL_DISPLAY_MODE_DEFAULT)===j.CHANNEL_DISPLAY_MODE_CENTERED,compactDisplay:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,j.MESSAGE_DISPLAY,j.MESSAGE_DISPLAY_DEFAULT)===j.MESSAGE_DISPLAY_COMPACT,previewsCollapsed:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,j.COLLAPSE_DISPLAY,"false")+t,useMilitaryTime:v.default.getBool(k.default.Preferences.CATEGORY_DISPLAY_SETTINGS,j.USE_MILITARY_TIME,!1),flaggedPosts:v.default.getCategory(k.default.Preferences.CATEGORY_FLAGGED_POST)})}},{key:"onUserChange",value:function(){this.setState({currentUser:L.default.getCurrentUser(),profiles:JSON.parse((0,i.default)(L.default.getProfiles()))})}},{key:"onPostsChange",value:function(){var e=v.default.getBool(k.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"join_leave",!0),t=0===D.default.getLatestPostFromPageTime(this.state.channel.id),a={postList:D.default.filterPosts(this.state.channel.id,e),atTop:D.default.getVisibilityAtTop(this.state.channel.id),loading:t};this.state.loading&&!t&&(a.scrollType=F.NEW_MESSAGE),this.setState(a)}},{key:"onStatusChange",value:function(){this.setState({statuses:(0,r.default)({},L.default.getStatuses())})}},{key:"onTeamChange",value:function(){var e=w.default.getCurrentId();this.state.channel.type!==k.default.OPEN_CHANNEL&&this.state.channel.type!==k.default.PRIVATE_CHANNEL||this.state.channel.team_id===e||this.setState({currentTeamId:e,loading:!0})}},{key:"onActivate",value:function(){v.default.addChangeListener(this.onPreferenceChange),L.default.addChangeListener(this.onUserChange),w.default.addChangeListener(this.onTeamChange),L.default.addStatusesChangeListener(this.onStatusChange),D.default.addChangeListener(this.onPostsChange),D.default.addPostsViewJumpListener(this.onPostsViewJumpRequest),M.default.addLastViewedListener(this.onSetNewMessageIndicator),G.default.addBusyListener(this.onBusy)}},{key:"onDeactivate",value:function(){v.default.removeChangeListener(this.onPreferenceChange),L.default.removeChangeListener(this.onUserChange),w.default.removeChangeListener(this.onTeamChange),L.default.removeStatusesChangeListener(this.onStatusChange),D.default.removeChangeListener(this.onPostsChange),D.default.removePostsViewJumpListener(this.onPostsViewJumpRequest),M.default.removeLastViewedListener(this.onSetNewMessageIndicator),G.default.removeBusyListener(this.onBusy)}},{key:"componentWillReceiveProps",value:function(e){if(this.props.active&&!e.active)this.onDeactivate();else if(!this.props.active&&e.active){this.onActivate();var t=e.channel,a=Number.MAX_VALUE,s=M.default.getMyMember(t.id);null!=s&&(a=s.last_viewed_at);var n=L.default.getProfiles(),l=v.default.getBool(k.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"join_leave",!0),o=(0,r.default)({},L.default.getStatuses());this.setState({channel:t,lastViewed:a,ownNewMessage:!1,profiles:JSON.parse((0,i.default)(n)),statuses:o,postList:D.default.filterPosts(t.id,l),displayNameType:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,"name_format","false"),displayPostsInCenter:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,j.CHANNEL_DISPLAY_MODE,j.CHANNEL_DISPLAY_MODE_DEFAULT)===j.CHANNEL_DISPLAY_MODE_CENTERED,compactDisplay:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,j.MESSAGE_DISPLAY,j.MESSAGE_DISPLAY_DEFAULT)===j.MESSAGE_DISPLAY_COMPACT,previewsCollapsed:v.default.get(j.CATEGORY_DISPLAY_SETTINGS,j.COLLAPSE_DISPLAY,"false"),useMilitaryTime:v.default.getBool(k.default.Preferences.CATEGORY_DISPLAY_SETTINGS,j.USE_MILITARY_TIME,!1),scrollType:F.NEW_MESSAGE})}}},{key:"onPostsViewJumpRequest",value:function(e,t){switch(e){case k.default.PostsViewJumpTypes.BOTTOM:var a=void 0,s=D.default.getLatestPost(this.state.channel.id);a=s&&s.create_at?s.create_at:(new Date).getTime(),this.setState({scrollType:F.BOTTOM,lastViewedBottom:a});break;case k.default.PostsViewJumpTypes.POST:this.setState({scrollType:F.POST,scrollPostId:t});break;case k.default.PostsViewJumpTypes.SIDEBAR_OPEN:this.setState({scrollType:F.SIDEBAR_OPEN})}}},{key:"onSetNewMessageIndicator",value:function(){var e=Number.MAX_VALUE,t=M.default.getMyMember(this.props.channel.id);null!=t&&(e=t.last_viewed_at),this.setState({lastViewed:e})}},{key:"onPostListScroll",value:function(e){if(e){var t=void 0,a=D.default.getLatestPost(this.state.channel.id);t=a&&a.create_at?a.create_at:(new Date).getTime(),this.setState({scrollType:F.BOTTOM,lastViewedBottom:t})}else this.setState({scrollType:F.FREE})}},{key:"onBusy",value:function(e){this.setState({isBusy:e})}},{key:"shouldComponentUpdate",value:function(e,t){return e.active!==this.props.active||(t.loading!==this.state.loading||(t.atTop!==this.state.atTop||(t.displayNameType!==this.state.displayNameType||(t.displayPostsInCenter!==this.state.displayPostsInCenter||(t.compactDisplay!==this.state.compactDisplay||(t.previewsCollapsed!==this.state.previewsCollapsed||(t.useMilitaryTime!==this.state.useMilitaryTime||(!R.areObjectsEqual(t.flaggedPosts,this.state.flaggedPosts)||(t.lastViewed!==this.state.lastViewed||(t.ownNewMessage!==this.state.ownNewMessage||(t.showMoreMessagesTop!==this.state.showMoreMessagesTop||(t.scrollType!==this.state.scrollType||(t.scrollPostId!==this.state.scrollPostId||(e.channel.id!==this.props.channel.id||(!R.areObjectsEqual(t.currentUser,this.state.currentUser)||(!R.areObjectsEqual(t.statuses,this.state.statuses)||(!R.areObjectsEqual(t.postList,this.state.postList)||(!R.areObjectsEqual(t.profiles,this.state.profiles)||t.isBusy!==this.state.isBusy))))))))))))))))))}},{key:"render",value:function(){var e=void 0;e=null==this.state.postList||this.state.loading?U.default.createElement(y.default,{position:"absolute",key:"loading"}):U.default.createElement(C.default,{postList:this.state.postList,profiles:this.state.profiles,channel:this.state.channel,currentUser:this.state.currentUser,showMoreMessagesTop:!this.state.atTop,scrollType:this.state.scrollType,scrollPostId:this.state.scrollPostId,postListScrolled:this.onPostListScroll,displayNameType:this.state.displayNameType,displayPostsInCenter:this.state.displayPostsInCenter,compactDisplay:this.state.compactDisplay,previewsCollapsed:this.state.previewsCollapsed,useMilitaryTime:this.state.useMilitaryTime,flaggedPosts:this.state.flaggedPosts,lastViewed:this.state.lastViewed,lastViewedBottom:this.state.lastViewedBottom,ownNewMessage:this.state.ownNewMessage,statuses:this.state.statuses,isBusy:this.state.isBusy});var t="";return this.props.active||(t="inactive"),U.default.createElement("div",{className:t},e)}}]),t}(U.default.Component);t.default=J,J.propTypes={channel:U.default.PropTypes.object,active:U.default.PropTypes.bool}}});
//# sourceMappingURL=13.51946602ec2b88461b81.js.map