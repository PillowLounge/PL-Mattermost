webpackJsonp([6],{1721:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(1),g=r(p),v=a(0),b=r(v),y=a(37),E=a(11),_=n(E),w=a(20),S=n(w),C=a(23),T=r(C),M=a(15),k=r(M),P=a(42),D=r(P),I=a(24),N=r(I),L=a(140),O=r(L),R=a(41),A=n(R),F=a(142),x=a(186),U=a(46),j=a(8),H=r(j),B=a(1662),V=r(B),G=a(2042),z=r(G),W=a(2043),q=r(W),Y=a(2019),K=r(Y),J=a(2055),X=r(J),Z=a(2054),$=r(Z),Q=a(2007),ee=r(Q),te=a(2008),ae=r(te),ne=a(2009),re=r(ne),ie=a(2004),se=r(ie),oe=a(2003),le=r(oe),de=a(2048),ue=r(de),ce=a(2027),fe=r(ce),me=a(2052),he=r(me),pe=a(2015),ge=r(pe),ve=a(2016),be=r(ve),ye=a(2163),Ee=r(ye),_e=a(59),we=n(_e),Se=H.default.TutorialSteps,Ce=H.default.Preferences,Te=1e4,Me=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));a.onTeamChanged=a.onTeamChanged.bind(a),a.onPreferencesChanged=a.onPreferencesChanged.bind(a),a.blurTime=(new Date).getTime();var n=T.default.getCurrent();return a.state={team:n,theme:D.default.getTheme(n.id)},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"onTeamChanged",value:function(){var e=T.default.getCurrent();this.setState({team:e,theme:D.default.getTheme(e.id)})}},{key:"onPreferencesChanged",value:function(e){e&&e!==Ce.CATEGORY_THEME||this.setState({theme:D.default.getTheme(this.state.team.id)})}},{key:"componentWillMount",value:function(){D.default.getInt(Ce.TUTORIAL_STEP,k.default.getCurrentId(),999)<=Se.INTRO_SCREENS&&y.browserHistory.push(T.default.getCurrentTeamRelativeUrl()+"/tutorial")}},{key:"componentDidMount",value:function(){var e=this;T.default.addChangeListener(this.onTeamChanged),D.default.addChangeListener(this.onPreferencesChanged),A.viewLoggedIn(),(0,F.startPeriodicStatusUpdates)(),(0,x.startPeriodicSync)(),window.isActive=!0,(0,b.default)(window).on("focus",function(){S.viewChannel(),N.default.resetCounts(N.default.getCurrentId()),N.default.emitChange(),window.isActive=!0,(new Date).getTime()-e.blurTime>Te&&S.getMyChannelMembers().then(U.loadProfilesForSidebar)}),(0,b.default)(window).on("blur",function(){window.isActive=!1,e.blurTime=(new Date).getTime(),k.default.getCurrentUser()&&S.viewChannel("")}),_.applyTheme(this.state.theme),we.isIosSafari()&&Ee.default.enable()}},{key:"componentDidUpdate",value:function(e,t){_.areObjectsEqual(t.theme,this.state.theme)||_.applyTheme(this.state.theme)}},{key:"componentWillUnmount",value:function(){T.default.removeChangeListener(this.onTeamChanged),D.default.removeChangeListener(this.onPreferencesChanged),(0,b.default)(window).off("focus"),(0,b.default)(window).off("blur"),we.isIosSafari()&&Ee.default.disable(),(0,F.stopPeriodicStatusUpdates)(),(0,x.stopPeriodicSync)()}},{key:"render",value:function(){var e=[];this.props.children?e=this.props.children:(e.push(this.props.navbar),e.push(this.props.team_sidebar),e.push(this.props.sidebar),e.push(g.default.createElement("div",{key:"inner-wrap",className:"inner-wrap channel__wrap"},g.default.createElement("div",{className:"row header"},g.default.createElement("div",{id:"navbar"},g.default.createElement(K.default,null))),g.default.createElement("div",{className:"row main"},g.default.cloneElement(this.props.center,{user:this.props.user,team:this.state.team})))));var t=N.default.getByName(this.props.params.channel);if(null==t){var a=O.default.getFocusedPostId(),n=O.default.getEarliestPostFromPage(a);null!=n&&(t=N.default.get(n.channel_id))}return g.default.createElement("div",{className:"channel-view"},g.default.createElement(V.default,null),g.default.createElement($.default,null),g.default.createElement("div",{className:"container-fluid"},g.default.createElement(z.default,{channel:t}),g.default.createElement(q.default,{teamType:this.state.team.type}),g.default.createElement(X.default,null),e,g.default.createElement(ee.default,null),g.default.createElement(ae.default,null),g.default.createElement(re.default,null),g.default.createElement(ge.default,null),g.default.createElement(be.default,null),g.default.createElement(he.default,null),g.default.createElement(ue.default,null),g.default.createElement(se.default,null),g.default.createElement(le.default,null),g.default.createElement(fe.default,null)))}}]),t}(g.default.Component);t.default=Me,Me.propTypes={children:g.default.PropTypes.oneOfType([g.default.PropTypes.arrayOf(g.default.PropTypes.element),g.default.PropTypes.element]),navbar:g.default.PropTypes.element,sidebar:g.default.PropTypes.element,team_sidebar:g.default.PropTypes.element,center:g.default.PropTypes.element,params:g.default.PropTypes.object,user:g.default.PropTypes.object}},1743:function(e,t,a){var n=(a(0),a(0),!0),r={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,t,a){var n=e.match(t);return n&&n.length>=a&&parseInt(n[a],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!navigator.mediaDevices||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}return e},shimCreateObjectURL:function(){if("object"==typeof window&&window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){var e=URL.createObjectURL.bind(URL),t=URL.revokeObjectURL.bind(URL),a=new Map,n=0;URL.createObjectURL=function(t){if("getTracks"in t){var r="polyblob:"+ ++n;return a.set(r,t),console.log("URL.createObjectURL(stream) is deprecated! Use elem.srcObject = stream instead!"),r}return e(t)},URL.revokeObjectURL=function(e){t(e),a.delete(e)};var r=Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,"src");Object.defineProperty(window.HTMLMediaElement.prototype,"src",{get:function(){return r.get.apply(this)},set:function(e){return this.srcObject=a.get(e)||null,r.set.apply(this,[e])}});var i=HTMLMediaElement.prototype.setAttribute;HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=a.get(arguments[1])||null),i.apply(this,arguments)}}}};e.exports={log:r.log,disableLog:r.disableLog,browserDetails:r.detectBrowser(),extractVersion:r.extractVersion,shimCreateObjectURL:r.shimCreateObjectURL,detectBrowser:r.detectBrowser.bind(r)}},1763:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),i=n(r),s=a(2),o=n(s),l=a(5),d=n(l),u=a(4),c=n(u),f=a(3),m=n(f),h=a(1),p=n(h),g=a(13),v=a(27),b=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.onHide=a.onHide.bind(a),a.copyLink=a.copyLink.bind(a),a.state={copiedLink:!1},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"onHide",value:function(){this.setState({copiedLink:!1}),this.props.onHide()}},{key:"copyLink",value:function(){var e=this.refs.textarea;e.focus(),e.setSelectionRange(0,this.props.link.length);try{document.execCommand("copy")?this.setState({copiedLink:!0}):this.setState({copiedLink:!1})}catch(e){this.setState({copiedLink:!1})}}},{key:"render",value:function(){var e=null;this.props.helpText&&(e=p.default.createElement("p",null,this.props.helpText,p.default.createElement("br",null),p.default.createElement("br",null)));var t=null;document.queryCommandSupported("copy")&&(t=p.default.createElement("button",{"data-copy-btn":"true",type:"button",className:"btn btn-primary pull-left",onClick:this.copyLink},p.default.createElement(g.FormattedMessage,{id:"get_link.copy",defaultMessage:"Copy Link"})));var a=p.default.createElement("textarea",{className:"form-control no-resize min-height",ref:"textarea",value:this.props.link,onClick:this.copyLink,readOnly:!0}),n=null;return this.state.copiedLink&&(n=p.default.createElement("p",{className:"alert alert-success alert--confirm"},p.default.createElement("i",{className:"fa fa-check"}),p.default.createElement(g.FormattedMessage,{id:"get_link.clipboard",defaultMessage:" Link copied"}))),p.default.createElement(v.Modal,{show:this.props.show,onHide:this.onHide},p.default.createElement(v.Modal.Header,{closeButton:!0},p.default.createElement("h4",{className:"modal-title"},this.props.title)),p.default.createElement(v.Modal.Body,null,e,a),p.default.createElement(v.Modal.Footer,null,p.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.onHide},p.default.createElement(g.FormattedMessage,{id:"get_link.close",defaultMessage:"Close"})),t,n))}}]),t}(p.default.Component);t.default=b,b.propTypes={show:p.default.PropTypes.bool.isRequired,onHide:p.default.PropTypes.func.isRequired,title:p.default.PropTypes.string.isRequired,helpText:p.default.PropTypes.string,link:p.default.PropTypes.string.isRequired},b.defaultProps={helpText:null}},1777:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(59),g=n(p),v=a(2029),b=r(v),y=a(27),E=a(1),_=r(E),w=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.toggleDropdown=a.toggleDropdown.bind(a),a.state={showDropdown:!1},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"toggleDropdown",value:function(){var e=!this.state.showDropdown;if(g.isMobile()||g.isMobileApp()){var t=document.querySelector(".scrollbar--view");t.style.overflow=e?"hidden":"scroll"}this.setState({showDropdown:e})}},{key:"render",value:function(){return _.default.createElement(y.Dropdown,{id:"rhs_dropdown",open:this.state.showDropdown,onToggle:this.toggleDropdown},_.default.createElement("a",{href:"#",className:"post__dropdown dropdown-toggle",bsRole:"toggle",onClick:this.toggleDropdown}),_.default.createElement(b.default,null,this.props.dropdownContents))}}]),t}(_.default.Component);t.default=w,w.propTypes={dropdownContents:_.default.PropTypes.array.isRequired}},1778:function(e,t,a){e.exports=a.p+"files/a4a8b617d1f6c75ad4bf17bafc2aec6a.mp3"},1795:function(e,t,a){function n(e,t,a){var n=d[t];if(void 0===n&&(n=i(t)),n){if(void 0===a)return e.style[n];e.style[n]=u(n,a)}}function r(e,t){for(var a in t)t.hasOwnProperty(a)&&n(e,a,t[a])}function i(e){var t=l(e),a=o(t);return d[t]=d[e]=d[a]=a,a}function s(){2===arguments.length?"string"==typeof arguments[1]?arguments[0].style.cssText=arguments[1]:r(arguments[0],arguments[1]):n(arguments[0],arguments[1],arguments[2])}var o=(a(0),a(0),a(2170)),l=a(2199),d={float:"cssFloat"},u=a(2068);e.exports=s,e.exports.set=s,e.exports.get=function(e,t){return Array.isArray(t)?t.reduce(function(t,a){return t[a]=n(e,a||""),t},{}):n(e,t||"")}},2001:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(345),g=r(p),v=a(344),b=r(v),y=a(2044),E=r(y),_=a(13),w=a(27),S=a(47),C=a(24),T=r(C),M=a(15),k=r(M),P=a(8),D=r(P),I=a(11),N=n(I),L=a(1),O=r(L),R=a(0),A=r(R),F=function(e){function t(){(0,l.default)(this,t);var e=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return e.onChange=e.onChange.bind(e),e.onItemSelected=e.onItemSelected.bind(e),e.onShow=e.onShow.bind(e),e.onHide=e.onHide.bind(e),e.onExited=e.onExited.bind(e),e.handleKeyDown=e.handleKeyDown.bind(e),e.handleSubmit=e.handleSubmit.bind(e),e.switchToChannel=e.switchToChannel.bind(e),e.suggestionProviders=[new E.default],e.state={text:"",error:""},e}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.show&&!e.show){var t=this.refs.search.getTextbox();t.focus(),N.placeCaretAtEnd(t)}}},{key:"onShow",value:function(){this.setState({text:"",error:""})}},{key:"onHide",value:function(){this.setState({text:"",error:""}),this.props.onHide()}},{key:"onExited",value:function(){this.selected=null,setTimeout(function(){(0,A.default)("#post_textbox").get(0).focus()})}},{key:"onChange",value:function(e){this.setState({text:e.target.value}),this.selected=null}},{key:"onItemSelected",value:function(e){this.selected=e}},{key:"handleKeyDown",value:function(e){this.setState({error:""}),e.keyCode===D.default.KeyCodes.ENTER&&this.handleSubmit()}},{key:"handleSubmit",value:function(){var e=this,t=null;if(!this.selected)return void(""!==this.state.text&&this.setState({error:N.localizeMessage("channel_switch_modal.not_found","No matches found.")}));if(this.selected.type===D.default.DM_CHANNEL){var a=k.default.getProfileByUsername(this.selected.name);a&&(0,S.openDirectChannelToUser)(a.id,function(a){t=a,e.switchToChannel(t)},function(){t=null,e.switchToChannel(t)})}else t=T.default.get(this.selected.id),this.switchToChannel(t)}},{key:"switchToChannel",value:function(e){null!==e?((0,S.goToChannel)(e),this.onHide()):""!==this.state.text&&this.setState({error:N.localizeMessage("channel_switch_modal.failed_to_open","Failed to open channel.")})}},{key:"render",value:function(){var e=this.state.error;return O.default.createElement(w.Modal,{dialogClassName:"channel-switch-modal",ref:"modal",show:this.props.show,onHide:this.onHide,onExited:this.onExited},O.default.createElement(w.Modal.Header,{closeButton:!0},O.default.createElement(w.Modal.Title,null,O.default.createElement("span",null,O.default.createElement(_.FormattedMessage,{id:"channel_switch_modal.title",defaultMessage:"Switch Channels"})))),O.default.createElement(w.Modal.Body,null,O.default.createElement("div",{className:"modal__hint"},O.default.createElement(_.FormattedMessage,{id:"channel_switch_modal.help",defaultMessage:"Type channel name. Use ↑↓ to browse, TAB to select, ↵ to confirm, ESC to dismiss"})),O.default.createElement(b.default,{ref:"search",className:"form-control focused",type:"input",onChange:this.onChange,value:this.state.text,onKeyDown:this.handleKeyDown,onItemSelected:this.onItemSelected,listComponent:g.default,maxLength:"64",providers:this.suggestionProviders,listStyle:"bottom"})),O.default.createElement(w.Modal.Footer,null,O.default.createElement("div",{className:"modal__error"},e),O.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.onHide},O.default.createElement(_.FormattedMessage,{id:"edit_channel_header_modal.cancel",defaultMessage:"Cancel"})),O.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleSubmit},O.default.createElement(_.FormattedMessage,{id:"channel_switch_modal.submit",defaultMessage:"Switch"}))))}}]),t}(O.default.Component);t.default=F,F.propTypes={show:O.default.PropTypes.bool.isRequired,onHide:O.default.PropTypes.func.isRequired}},2002:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(0),g=r(p),v=a(30),b=r(v),y=a(16),E=r(y),_=a(47),w=n(_),S=a(80),C=r(S),T=a(15),M=r(T),k=a(596),P=r(k),D=a(140),I=r(D),N=a(42),L=r(N),O=a(580),R=r(O),A=a(579),F=r(A),x=a(594),U=r(x),j=a(590),H=r(j),B=a(589),V=r(B),G=a(337),z=r(G),W=a(11),q=n(W),Y=a(59),K=n(Y),J=a(41),X=n(J),Z=a(104),$=n(Z),Q=a(8),ee=r(Q),te=a(13),ae=a(37),ne=a(1673),re=a(1),ie=r(re),se=ee.default.ActionTypes,oe=ee.default.KeyCodes,le=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));a.lastTime=0,a.handleSubmit=a.handleSubmit.bind(a),a.handleSubmitPost=a.handleSubmitPost.bind(a),a.handleSubmitReaction=a.handleSubmitReaction.bind(a),a.commentMsgKeyPress=a.commentMsgKeyPress.bind(a),a.handleChange=a.handleChange.bind(a),a.handleKeyDown=a.handleKeyDown.bind(a),a.handleBlur=a.handleBlur.bind(a),a.handleFileUploadChange=a.handleFileUploadChange.bind(a),a.handleUploadStart=a.handleUploadStart.bind(a),a.handleFileUploadComplete=a.handleFileUploadComplete.bind(a),a.handleUploadError=a.handleUploadError.bind(a),a.removePreview=a.removePreview.bind(a),a.getFileCount=a.getFileCount.bind(a),a.getFileUploadTarget=a.getFileUploadTarget.bind(a),a.onPreferenceChange=a.onPreferenceChange.bind(a),a.focusTextbox=a.focusTextbox.bind(a),a.showPostDeletedModal=a.showPostDeletedModal.bind(a),a.hidePostDeletedModal=a.hidePostDeletedModal.bind(a),a.handlePostError=a.handlePostError.bind(a),a.handleEmojiPickerClick=a.handleEmojiPickerClick.bind(a),a.handleEmojiClick=a.handleEmojiClick.bind(a),a.onKeyPress=a.onKeyPress.bind(a),a.closeEmoji=a.closeEmoji.bind(a),I.default.clearCommentDraftUploads(),R.default.resetHistoryIndex("comment");var n=I.default.getCommentDraft(a.props.rootId),r=a.handleEnableAddButton(n.message,n.fileInfos);return a.state={message:n.message,uploadsInProgress:n.uploadsInProgress,fileInfos:n.fileInfos,submitting:!1,ctrlSend:L.default.getBool(ee.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),showPostDeletedModal:!1,enableAddButton:r,showEmojiPicker:!1,emojiOffset:0,emojiPickerEnabled:q.isFeatureEnabled(ee.default.PRE_RELEASE_FEATURES.EMOJI_PICKER_PREVIEW)},a.lastBlurAt=0,a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"closeEmoji",value:function(e){e&&e.srcElement&&""!==e.srcElement.className&&-1===e.srcElement.className.indexOf("emoji-rhs")&&this.state.showEmojiPicker&&this.setState({showEmojiPicker:!this.state.showEmojiPicker})}},{key:"handleEmojiPickerClick",value:function(){var e=document.getElementById("thread--root")?document.getElementById("thread--root").offsetHeight:0,t=document.querySelector("div.post-right-comments-container")?document.querySelector("div.post-right-comments-container").offsetHeight:0,a=e+t,n=0;n=a>361?-361:-1*a,this.setState({showEmojiPicker:!this.state.showEmojiPicker,emojiOffset:n})}},{key:"handleEmojiClick",value:function(e){var t=e.name||e.aliases[0];if(t){if(""===this.state.message)this.setState({message:":"+t+": ",showEmojiPicker:!1});else{var a=/\s+$/.test(this.state.message)?this.state.message+":"+t+": ":this.state.message+" :"+t+": ";this.setState({message:a,showEmojiPicker:!1})}this.focusTextbox()}}},{key:"componentDidMount",value:function(){L.default.addChangeListener(this.onPreferenceChange),document.addEventListener("keydown",this.onKeyPress),this.focusTextbox()}},{key:"componentWillUnmount",value:function(){L.default.removeChangeListener(this.onPreferenceChange),document.removeEventListener("keydown",this.onKeyPress)}},{key:"onKeyPress",value:function(e){e.which===ee.default.KeyCodes.ESCAPE&&!0===this.state.showEmojiPicker&&this.setState({showEmojiPicker:!this.state.showEmojiPicker})}},{key:"onPreferenceChange",value:function(){this.setState({ctrlSend:L.default.getBool(ee.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),emojiPickerEnabled:q.isFeatureEnabled(ee.default.PRE_RELEASE_FEATURES.EMOJI_PICKER_PREVIEW)})}},{key:"componentDidUpdate",value:function(e,t){t.uploadsInProgress<this.state.uploadsInProgress&&(0,g.default)(".post-right__scroll").scrollTop((0,g.default)(".post-right__scroll")[0].scrollHeight),e.rootId!==this.props.rootId&&this.focusTextbox()}},{key:"handlePostError",value:function(e){this.setState({postError:e})}},{key:"handleSubmit",value:function(e){var t=this;if(e.preventDefault(),!(this.state.uploadsInProgress.length>0||this.state.submitting)){var a=this.state.message;if(this.state.postError)return this.setState({errorClass:"animation--highlight"}),void setTimeout(function(){t.setState({errorClass:null})},ee.default.ANIMATION_TIMEOUT);if(R.default.storeMessageInHistory(a),0!==a.trim().length||0!==this.state.fileInfos.length){var n=ne.REACTION_PATTERN.exec(a);n&&C.default.has(n[2])?this.handleSubmitReaction(n):0===a.indexOf("/")?this.handleSubmitCommand(a):this.handleSubmitPost(a),this.setState({message:"",submitting:!1,postError:null,fileInfos:[],serverError:null,enableAddButton:!1});var r=150,i=Date.now()-this.lastBlurAt<r;this.focusTextbox(i)}}}},{key:"handleSubmitCommand",value:function(e){var t=this;I.default.storeCommentDraft(this.props.rootId,null),this.setState({message:"",postError:null,fileInfos:[],enableAddButton:!1});var a={};a.channel_id=this.props.channelId,a.root_id=this.props.rootId,a.parent_id=this.props.rootId,w.executeCommand(e,a,function(e){t.setState({submitting:!1}),e.goto_location&&e.goto_location.length>0&&ae.browserHistory.push(e.goto_location)},function(a){if(a.sendMessage)t.handleSubmitPost(e);else{var n={};n.serverError=a.message,n.submitting=!1,t.setState(n)}})}},{key:"handleSubmitPost",value:function(e){var t=this,a=M.default.getCurrentId(),n=q.getTimestamp(),r={};r.file_ids=[],r.message=e,r.channel_id=this.props.channelId,r.root_id=this.props.rootId,r.parent_id=this.props.rootId,r.file_ids=this.state.fileInfos.map(function(e){return e.id}),r.pending_post_id=a+":"+n,r.user_id=a,r.create_at=n,X.emitUserCommentedEvent(r);var i=r.message.match(ne.EMOJI_PATTERN);i&&i.forEach(function(e){$.emitEmojiPosted(e)}),$.queuePost(r,!1,null,function(e){"api.post.create_post.root_id.app_error"===e.id?(t.showPostDeletedModal(),I.default.removePendingPost(r.channel_id,r.pending_post_id),t.setState({message:r.message})):t.forceUpdate(),t.setState({submitting:!1})}),this.setState({message:"",submitting:!1,postError:null,fileInfos:[],serverError:null,enableAddButton:!1});var s=150,o=Date.now()-this.state.lastBlurAt<s;this.focusTextbox(o)}},{key:"handleSubmitReaction",value:function(e){var t=e[1],a=e[2],n=this.props.latestPostId;"+"===t?$.addReaction(this.props.channelId,n,a):"-"===t&&$.removeReaction(this.props.channelId,n,a),I.default.storeCommentDraft(this.props.rootId,null)}},{key:"commentMsgKeyPress",value:function(e){!K.isMobile()&&(this.state.ctrlSend&&e.ctrlKey||!this.state.ctrlSend)&&(e.which!==oe.ENTER||e.shiftKey||e.altKey||(e.preventDefault(),b.default.findDOMNode(this.refs.textbox).blur(),this.handleSubmit(e))),X.emitLocalUserTypingEvent(this.props.channelId,this.props.rootId)}},{key:"handleChange",value:function(e){var t=e.target.value,a=I.default.getCommentDraft(this.props.rootId);a.message=t,I.default.storeCommentDraft(this.props.rootId,a),(0,g.default)(".post-right__scroll").parent().scrollTop((0,g.default)(".post-right__scroll")[0].scrollHeight);var n=this.handleEnableAddButton(t,this.state.fileInfos);this.setState({message:t,enableAddButton:n})}},{key:"handleKeyDown",value:function(e){if(this.state.ctrlSend&&e.keyCode===oe.ENTER&&!0===e.ctrlKey)return void this.commentMsgKeyPress(e);if(!(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.keyCode!==oe.UP||""!==this.state.message)){e.preventDefault();var t=I.default.getCurrentUsersLatestPost(this.props.channelId,this.props.rootId);if(!t)return;E.default.handleViewAction({type:se.RECEIVED_EDIT_POST,refocusId:"#reply_textbox",title:q.localizeMessage("create_comment.commentTitle","Comment"),message:t.message,postId:t.id,channelId:t.channel_id,comments:I.default.getCommentCount(t)})}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&(e.keyCode===ee.default.KeyCodes.UP||e.keyCode===ee.default.KeyCodes.DOWN)){var a=R.default.nextMessageInHistory(e.keyCode,this.state.message,"comment");null!==a&&(e.preventDefault(),this.setState({message:a,enableAddButton:!0}))}}},{key:"handleFileUploadChange",value:function(){this.focusTextbox()}},{key:"handleUploadStart",value:function(e){var t=I.default.getCommentDraft(this.props.rootId);t.uploadsInProgress=t.uploadsInProgress.concat(e),I.default.storeCommentDraft(this.props.rootId,t),this.setState({uploadsInProgress:t.uploadsInProgress}),this.focusTextbox()}},{key:"handleFileUploadComplete",value:function(e,t){for(var a=I.default.getCommentDraft(this.props.rootId),n=0;n<t.length;n++){var r=a.uploadsInProgress.indexOf(t[n]);-1!==r&&a.uploadsInProgress.splice(r,1)}a.fileInfos=a.fileInfos.concat(e),I.default.storeCommentDraft(this.props.rootId,a),this.refs.preview.refs.container.scrollIntoView();var i=this.handleEnableAddButton(a.message,a.fileInfos);this.setState({uploadsInProgress:a.uploadsInProgress,fileInfos:a.fileInfos,enableAddButton:i})}},{key:"handleUploadError",value:function(e,t){if(-1===t)this.setState({serverError:e});else{var a=I.default.getCommentDraft(this.props.rootId),n=a.uploadsInProgress.indexOf(t);-1!==n&&a.uploadsInProgress.splice(n,1),I.default.storeCommentDraft(this.props.rootId,a),this.setState({uploadsInProgress:a.uploadsInProgress,serverError:e})}}},{key:"removePreview",value:function(e){var t=this.state.fileInfos,a=this.state.uploadsInProgress;this.handleUploadError(null);var n=t.findIndex(function(t){return t.id===e});-1===n?-1!==(n=a.indexOf(e))&&(a.splice(n,1),this.refs.fileUpload.getWrappedInstance().cancelUpload(e)):t.splice(n,1);var r=I.default.getCommentDraft(this.props.rootId);r.fileInfos=t,r.uploadsInProgress=a,I.default.storeCommentDraft(this.props.rootId,r),this.setState({fileInfos:t,uploadsInProgress:a}),this.handleFileUploadChange()}},{key:"componentWillReceiveProps",value:function(e){if(e.rootId!==this.props.rootId){var t=I.default.getCommentDraft(e.rootId),a=this.handleEnableAddButton(t.message,t.fileInfos);this.setState({message:t.message,uploadsInProgress:t.uploadsInProgress,fileInfos:t.fileInfos,enableAddButton:a})}}},{key:"getFileCount",value:function(){return this.state.fileInfos.length+this.state.uploadsInProgress.length}},{key:"getFileUploadTarget",value:function(){return this.refs.textbox}},{key:"focusTextbox",value:function(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&q.isMobile()||this.refs.textbox.focus()}},{key:"showPostDeletedModal",value:function(){this.setState({showPostDeletedModal:!0})}},{key:"hidePostDeletedModal",value:function(){this.setState({showPostDeletedModal:!1})}},{key:"handleBlur",value:function(){this.lastBlurAt=Date.now()}},{key:"handleEnableAddButton",value:function(e,t){return 0!==e.trim().length||0!==t.length}},{key:"render",value:function(){var e=null;this.state.serverError&&(e=ie.default.createElement("div",{className:"form-group has-error"},ie.default.createElement("label",{className:"control-label"},this.state.serverError)));var t=null;if(this.state.postError){var a="post-error"+(this.state.errorClass?" "+this.state.errorClass:"");t=ie.default.createElement("label",{className:a},this.state.postError)}var n=null;(this.state.fileInfos.length>0||this.state.uploadsInProgress.length>0)&&(n=ie.default.createElement(V.default,{fileInfos:this.state.fileInfos,onRemove:this.removePreview,uploadsInProgress:this.state.uploadsInProgress,ref:"preview"}));var r=null;this.state.uploadsInProgress.length>0&&(r=ie.default.createElement("span",{className:"pull-right post-right-comments-upload-in-progress"},1===this.state.uploadsInProgress.length?ie.default.createElement(te.FormattedMessage,{id:"create_comment.file",defaultMessage:"File uploading"}):ie.default.createElement(te.FormattedMessage,{id:"create_comment.files",defaultMessage:"Files uploading"})));var i="btn btn-primary comment-btn pull-right";this.state.enableAddButton||(i+=" disabled");var s=null;return this.state.showEmojiPicker&&(s=ie.default.createElement(z.default,{onEmojiClick:this.handleEmojiClick,pickerLocation:"bottom",emojiOffset:this.state.emojiOffset,outsideClick:this.closeEmoji})),ie.default.createElement("form",{onSubmit:this.handleSubmit},ie.default.createElement("div",{className:"post-create"},ie.default.createElement("div",{id:this.props.rootId,className:"post-create-body comment-create-body"},ie.default.createElement("div",{className:"post-body__cell"},ie.default.createElement(F.default,{onChange:this.handleChange,onKeyPress:this.commentMsgKeyPress,onKeyDown:this.handleKeyDown,handlePostError:this.handlePostError,value:this.state.message,onBlur:this.handleBlur,createMessage:q.localizeMessage("create_comment.addComment","Add a comment..."),emojiEnabled:this.state.emojiPickerEnabled,initialText:"",channelId:this.props.channelId,id:"reply_textbox",ref:"textbox"}),ie.default.createElement(H.default,{ref:"fileUpload",getFileCount:this.getFileCount,getTarget:this.getFileUploadTarget,onFileUploadChange:this.handleFileUploadChange,onUploadStart:this.handleUploadStart,onFileUpload:this.handleFileUploadComplete,onUploadError:this.handleUploadError,postType:"comment",channelId:this.props.channelId,onEmojiClick:this.handleEmojiPickerClick,emojiEnabled:this.state.emojiPickerEnabled,navBarName:"rhs"}),s)),ie.default.createElement(U.default,{channelId:this.props.channelId,parentId:this.props.rootId}),ie.default.createElement("div",{className:"post-create-footer"},ie.default.createElement("input",{type:"button",className:i,value:q.localizeMessage("create_comment.comment","Add Comment"),onClick:this.handleSubmit}),r,t,n,e)),ie.default.createElement(P.default,{show:this.state.showPostDeletedModal,onHide:this.hidePostDeletedModal}))}}]),t}(ie.default.Component);t.default=le,le.propTypes={channelId:ie.default.PropTypes.string.isRequired,rootId:ie.default.PropTypes.string.isRequired,latestPostId:ie.default.PropTypes.string}},2003:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),i=n(r),s=a(2),o=n(s),l=a(5),d=n(l),u=a(4),c=n(u),f=a(3),m=n(f),h=a(0),p=n(h),g=a(30),v=n(g),b=a(27),y=a(1661),E=n(y),_=a(104),w=a(8),S=n(w),C=a(13),T=a(1),M=n(T),k=S.default.ActionTypes,P=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleDelete=a.handleDelete.bind(a),a.handleToggle=a.handleToggle.bind(a),a.handleHide=a.handleHide.bind(a),a.state={show:!1,post:null,commentCount:0,error:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){E.default.addModalListener(k.TOGGLE_DELETE_POST_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){E.default.removeModalListener(k.TOGGLE_DELETE_POST_MODAL,this.handleToggle)}},{key:"componentDidUpdate",value:function(e,t){var a=this;this.state.show&&!t.show&&setTimeout(function(){(0,p.default)(v.default.findDOMNode(a.refs.deletePostBtn)).focus()},0)}},{key:"handleDelete",value:function(){var e=this;(0,_.deletePost)(this.state.post.channel_id,this.state.post,function(){e.handleHide()},function(t){e.setState({error:t.message})})}},{key:"handleToggle",value:function(e,t){this.setState({show:e,post:t.post,commentCount:t.commentCount,error:""})}},{key:"handleHide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){if(!this.state.post)return null;var e=null;this.state.error&&(e=M.default.createElement("div",{className:"form-group has-error"},M.default.createElement("label",{className:"control-label"},this.state.error)));var t="";this.state.commentCount>0&&(t=M.default.createElement(C.FormattedMessage,{id:"delete_post.warning",defaultMessage:"This post has {count} comment(s) on it.",values:{count:this.state.commentCount}}));var a=this.state.post.root_id?M.default.createElement(C.FormattedMessage,{id:"delete_post.comment",defaultMessage:"Comment"}):M.default.createElement(C.FormattedMessage,{id:"delete_post.post",defaultMessage:"Post"});return M.default.createElement(b.Modal,{show:this.state.show,onHide:this.handleHide},M.default.createElement(b.Modal.Header,{closeButton:!0},M.default.createElement(b.Modal.Title,null,M.default.createElement(C.FormattedMessage,{id:"delete_post.confirm",defaultMessage:"Confirm {term} Delete",values:{term:a}}))),M.default.createElement(b.Modal.Body,null,M.default.createElement(C.FormattedMessage,{id:"delete_post.question",defaultMessage:"Are you sure you want to delete this {term}?",values:{term:a}}),M.default.createElement("br",null),M.default.createElement("br",null),t,e),M.default.createElement(b.Modal.Footer,null,M.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide},M.default.createElement(C.FormattedMessage,{id:"delete_post.cancel",defaultMessage:"Cancel"})),M.default.createElement("button",{ref:"deletePostBtn",type:"button",className:"btn btn-danger",onClick:this.handleDelete},M.default.createElement(C.FormattedMessage,{id:"delete_post.del",defaultMessage:"Delete"}))))}}]),t}(M.default.Component);t.default=P},2004:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(92),s=r(i),o=a(6),l=r(o),d=a(2),u=r(d),c=a(5),f=r(c),m=a(4),h=r(m),p=a(3),g=r(p),v=a(579),b=r(v),y=a(79),E=r(y),_=a(140),w=r(_),S=a(580),C=r(S),T=a(42),M=r(T),k=a(41),P=n(k),D=a(104),I=a(59),N=n(I),L=a(11),O=n(L),R=a(8),A=r(R),F=a(0),x=r(F),U=a(1),j=r(U),H=a(30),B=r(H),V=a(13),G=A.default.KeyCodes,z=function(t){function a(e){(0,u.default)(this,a);var t=(0,h.default)(this,(a.__proto__||(0,l.default)(a)).call(this,e));return t.handleEdit=t.handleEdit.bind(t),t.handleEditKeyPress=t.handleEditKeyPress.bind(t),t.handleEditPostEvent=t.handleEditPostEvent.bind(t),t.handleKeyDown=t.handleKeyDown.bind(t),t.handleChange=t.handleChange.bind(t),t.onPreferenceChange=t.onPreferenceChange.bind(t),t.onModalHidden=t.onModalHidden.bind(t),t.onModalShow=t.onModalShow.bind(t),t.onModalShown=t.onModalShown.bind(t),t.onModalHide=t.onModalHide.bind(t),t.onModalKeyDown=t.onModalKeyDown.bind(t),t.handlePostError=t.handlePostError.bind(t),t.state={editText:"",originalText:"",title:"",post_id:"",channel_id:"",comments:0,refocusId:"",ctrlSend:M.default.getBool(A.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),postError:""},t}return(0,g.default)(a,t),(0,f.default)(a,[{key:"handlePostError",value:function(e){this.state.postError!==e&&this.setState({postError:e})}},{key:"handleEdit",value:function(){var e=this,t={message:this.state.editText,id:this.state.post_id,channel_id:this.state.channel_id};if(this.state.postError)return this.setState({errorClass:"animation--highlight"}),void setTimeout(function(){e.setState({errorClass:null})},A.default.ANIMATION_TIMEOUT);if(t.message===this.state.originalText)return void(0,x.default)("#edit_post").modal("hide");if(C.default.storeMessageInHistory(t.message),0===t.message.trim().length){var a=this.state;return(0,s.default)(a,"editText"),E.default.setItem("edit_state_transfer",a),(0,x.default)("#edit_post").modal("hide"),void P.showDeletePostModal(w.default.getPost(this.state.channel_id,this.state.post_id),this.state.comments)}(0,D.updatePost)(t,function(){window.scrollTo(0,0)},Boolean(w.default.getFocusedPostId())),(0,x.default)("#edit_post").modal("hide")}},{key:"handleChange",value:function(e){var t=e.target.value;this.setState({editText:t})}},{key:"handleEditKeyPress",value:function(e){N.isMobile()||this.state.ctrlSend||e.which!==G.ENTER||e.shiftKey||e.altKey?this.state.ctrlSend&&e.ctrlKey&&e.which===G.ENTER&&(e.preventDefault(),B.default.findDOMNode(this.refs.editbox).blur(),this.handleEdit()):(e.preventDefault(),B.default.findDOMNode(this.refs.editbox).blur(),this.handleEdit())}},{key:"handleEditPostEvent",value:function(t){var a=w.default.getPost(t.channelId,t.postId);if("true"===e.window.mm_license.IsLicensed){if(e.window.mm_config.AllowEditPost===A.default.ALLOW_EDIT_POST_NEVER)return;if(e.window.mm_config.AllowEditPost===A.default.ALLOW_EDIT_POST_TIME_LIMIT&&a.create_at+1e3*e.window.mm_config.PostEditTimeLimit<O.getTimestamp())return}this.setState({editText:t.message||"",originalText:t.message||"",title:t.title||"",post_id:t.postId||"",channel_id:t.channelId||"",comments:t.comments||0,refocusId:t.refocusId||""}),(0,x.default)(B.default.findDOMNode(this.refs.modal)).modal("show")}},{key:"handleKeyDown",value:function(e){this.state.ctrlSend&&e.keyCode===G.ENTER&&!0===e.ctrlKey&&this.handleEdit()}},{key:"onPreferenceChange",value:function(){this.setState({ctrlSend:M.default.getBool(A.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter")})}},{key:"onModalHidden",value:function(){this.setState({editText:"",originalText:"",title:"",channel_id:"",post_id:"",comments:0,refocusId:"",error:"",typing:!1})}},{key:"onModalShow",value:function(e){var t=e.relatedTarget;t&&this.setState({editText:(0,x.default)(t).attr("data-message"),originalText:(0,x.default)(t).attr("data-message"),title:(0,x.default)(t).attr("data-title"),channel_id:(0,x.default)(t).attr("data-channelid"),post_id:(0,x.default)(t).attr("data-postid"),comments:(0,x.default)(t).attr("data-comments"),refocusId:(0,x.default)(t).attr("data-refocusid"),typing:!1})}},{key:"onModalShown",value:function(){this.refs.editbox.focus(),this.refs.editbox.recalculateSize()}},{key:"onModalHide",value:function(){var e=this;this.refs.editbox.hidePreview(),""!==this.state.refocusId&&setTimeout(function(){var t=(0,x.default)(e.state.refocusId).get(0);t&&t.focus()})}},{key:"onModalKeyDown",value:function(e){e.which===A.default.KeyCodes.ESCAPE&&e.stopPropagation()}},{key:"componentDidMount",value:function(){(0,x.default)(this.refs.modal).on("hidden.bs.modal",this.onModalHidden),(0,x.default)(this.refs.modal).on("show.bs.modal",this.onModalShow),(0,x.default)(this.refs.modal).on("shown.bs.modal",this.onModalShown),(0,x.default)(this.refs.modal).on("hide.bs.modal",this.onModalHide),(0,x.default)(this.refs.modal).on("keydown",this.onModalKeyDown),w.default.addEditPostListener(this.handleEditPostEvent),M.default.addChangeListener(this.onPreferenceChange)}},{key:"componentWillUnmount",value:function(){(0,x.default)(this.refs.modal).off("hidden.bs.modal",this.onModalHidden),(0,x.default)(this.refs.modal).off("show.bs.modal",this.onModalShow),(0,x.default)(this.refs.modal).off("shown.bs.modal",this.onModalShown),(0,x.default)(this.refs.modal).off("hide.bs.modal",this.onModalHide),(0,x.default)(this.refs.modal).off("keydown",this.onModalKeyDown),w.default.removeEditPostListner(this.handleEditPostEvent),M.default.removeChangeListener(this.onPreferenceChange)}},{key:"render",value:function(){var e="edit-post-footer"+(this.state.postError?" has-error":""),t=null;if(this.state.postError){var a="post-error"+(this.state.errorClass?" "+this.state.errorClass:"");t=j.default.createElement("label",{className:a},this.state.postError)}return j.default.createElement("div",{className:"modal fade edit-modal",ref:"modal",id:"edit_post",role:"dialog",tabIndex:"-1","aria-hidden":"true"},j.default.createElement("div",{className:"modal-dialog modal-push-down modal-xl"},j.default.createElement("div",{className:"modal-content"},j.default.createElement("div",{className:"modal-header"},j.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},j.default.createElement("span",{"aria-hidden":"true"},"×")),j.default.createElement("h4",{className:"modal-title"},j.default.createElement(V.FormattedMessage,{id:"edit_post.edit",defaultMessage:"Edit {title}",values:{title:this.state.title}}))),j.default.createElement("div",{className:"edit-modal-body modal-body"},j.default.createElement(b.default,{onChange:this.handleChange,onKeyPress:this.handleEditKeyPress,onKeyDown:this.handleKeyDown,handlePostError:this.handlePostError,value:this.state.editText,channelId:this.state.channel_id,createMessage:O.localizeMessage("edit_post.editPost","Edit the post..."),supportsCommands:!1,suggestionListStyle:"bottom",id:"edit_textbox",ref:"editbox"}),j.default.createElement("div",{className:e},t)),j.default.createElement("div",{className:"modal-footer"},j.default.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal"},j.default.createElement(V.FormattedMessage,{id:"edit_post.cancel",defaultMessage:"Cancel"})),j.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleEdit},j.default.createElement(V.FormattedMessage,{id:"edit_post.save",defaultMessage:"Save"}))))))}}]),a}(j.default.Component);t.default=z}).call(t,a(17))},2007:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(1763),g=r(p),v=a(1661),b=r(v),y=a(23),E=r(y),_=a(11),w=n(_),S=a(8),C=r(S),T=a(1),M=r(T),k=a(245),P=r(k),D=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.handleToggle=a.handleToggle.bind(a),a.hide=a.hide.bind(a),a.shouldComponentUpdate=P.default.shouldComponentUpdate.bind(a),a.state={show:!1,post:{}},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){b.default.addModalListener(C.default.ActionTypes.TOGGLE_GET_POST_LINK_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){b.default.removeModalListener(C.default.ActionTypes.TOGGLE_GET_POST_LINK_MODAL,this.handleToggle)}},{key:"handleToggle",value:function(e,t){this.setState({show:e,post:t.post})}},{key:"hide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){return M.default.createElement(g.default,{show:this.state.show,onHide:this.hide,title:w.localizeMessage("get_post_link_modal.title","Copy Permalink"),helpText:w.localizeMessage("get_post_link_modal.help","The link below allows authorized users to see your post."),link:E.default.getCurrentTeamUrl()+"/pl/"+this.state.post.id})}}]),t}(M.default.Component);t.default=D},2008:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(1),g=r(p),v=a(20),b=n(v),y=a(8),E=r(y),_=a(1661),w=r(_),S=a(245),C=r(S),T=a(11),M=n(T),k=a(1763),P=r(k),D=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.handlePublicLink=a.handlePublicLink.bind(a),a.handleToggle=a.handleToggle.bind(a),a.hide=a.hide.bind(a),a.shouldComponentUpdate=C.default.shouldComponentUpdate.bind(a),a.state={show:!1,fileId:"",link:""},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){w.default.addModalListener(E.default.ActionTypes.TOGGLE_GET_PUBLIC_LINK_MODAL,this.handleToggle)}},{key:"componentDidUpdate",value:function(e,t){this.state.show&&!t.show&&b.getPublicLink(this.state.fileId,this.handlePublicLink)}},{key:"componentWillUnmount",value:function(){w.default.removeModalListener(E.default.ActionTypes.TOGGLE_GET_PUBLIC_LINK_MODAL,this.handleToggle)}},{key:"handlePublicLink",value:function(e){this.setState({link:e})}},{key:"handleToggle",value:function(e,t){this.setState({show:e,fileId:t.fileId,link:""})}},{key:"hide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){return g.default.createElement(P.default,{show:this.state.show,onHide:this.hide,title:M.localizeMessage("get_public_link_modal.title","Copy Public Link"),helpText:M.localizeMessage("get_public_link_modal.help","The link below allows anyone to see this file without being registered on this server."),link:this.state.link})}}]),t}(g.default.Component);t.default=D},2009:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(1763),g=r(p),v=a(1661),b=r(v),y=a(23),E=r(y),_=a(11),w=n(_),S=a(8),C=r(S),T=a(1),M=r(T),k=a(245),P=r(k),D=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,s.default)(a)).call(this,e));return t.handleToggle=t.handleToggle.bind(t),t.shouldComponentUpdate=P.default.shouldComponentUpdate.bind(t),t.state={show:!1},t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){b.default.addModalListener(C.default.ActionTypes.TOGGLE_GET_TEAM_INVITE_LINK_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){b.default.removeModalListener(C.default.ActionTypes.TOGGLE_GET_TEAM_INVITE_LINK_MODAL,this.handleToggle)}},{key:"handleToggle",value:function(e){this.setState({show:e})}},{key:"render",value:function(){var t=this,a=void 0;return a="true"===e.window.mm_config.EnableUserCreation?w.localizeMessage("get_team_invite_link_modal.help","Send teammates the link below for them to sign-up to this team site. The Team Invite Link can be shared with multiple teammates as it does not change unless it's regenerated in Team Settings by a Team Admin."):w.localizeMessage("get_team_invite_link_modal.helpDisabled","User creation has been disabled for your team. Please ask your team administrator for details."),M.default.createElement(g.default,{show:this.state.show,onHide:function(){return t.setState({show:!1})},title:w.localizeMessage("get_team_invite_link_modal.title","Team Invite Link"),helpText:a,link:E.default.getCurrentInviteLink()})}}]),a}(M.default.Component);t.default=D}).call(t,a(17))},2015:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(30),g=r(p),v=a(11),b=n(v),y=a(8),E=r(y),_=a(41),w=n(_),S=a(1661),C=r(S),T=a(15),M=r(T),k=a(24),P=r(k),D=a(23),I=r(D),N=a(242),L=r(N),O=a(333),R=a(13),A=a(27),F=a(1),x=r(F),U=E.default.ActionTypes,j=(0,R.defineMessages)({emailError:{id:"invite_member.emailError",defaultMessage:"Please enter a valid email address"},firstname:{id:"invite_member.firstname",defaultMessage:"First name"},lastname:{id:"invite_member.lastname",defaultMessage:"Last name"},modalTitle:{id:"invite_member.modalTitle",defaultMessage:"Discard Invitations?"},modalMessage:{id:"invite_member.modalMessage",defaultMessage:"You have unsent invitations, are you sure you want to discard them?"},modalButton:{id:"invite_member.modalButton",defaultMessage:"Yes, Discard"}}),H=function(t){function a(t){(0,l.default)(this,a);var n=(0,f.default)(this,(a.__proto__||(0,s.default)(a)).call(this,t));n.teamChange=n.teamChange.bind(n),n.handleToggle=n.handleToggle.bind(n),n.handleSubmit=n.handleSubmit.bind(n),n.handleHide=n.handleHide.bind(n),n.addInviteFields=n.addInviteFields.bind(n),n.clearFields=n.clearFields.bind(n),n.removeInviteFields=n.removeInviteFields.bind(n),n.showGetTeamInviteLinkModal=n.showGetTeamInviteLinkModal.bind(n),n.handleKeyDown=n.handleKeyDown.bind(n);var r=I.default.getCurrent();return n.state={show:!1,inviteIds:[0],idCount:0,emailErrors:{},firstNameErrors:{},lastNameErrors:{},emailEnabled:"true"===e.window.mm_config.SendEmailNotifications,userCreationEnabled:"true"===e.window.mm_config.EnableUserCreation,showConfirmModal:!1,isSendingEmails:!1,teamType:r?r.type:null},n}return(0,h.default)(a,t),(0,u.default)(a,[{key:"teamChange",value:function(){var e=I.default.getCurrent(),t=e?e.type:null;this.setState({teamType:t})}},{key:"componentDidMount",value:function(){C.default.addModalListener(U.TOGGLE_INVITE_MEMBER_MODAL,this.handleToggle),I.default.addChangeListener(this.teamChange)}},{key:"componentWillUnmount",value:function(){C.default.removeModalListener(U.TOGGLE_INVITE_MEMBER_MODAL,this.handleToggle),I.default.removeChangeListener(this.teamChange)}},{key:"handleToggle",value:function(e){this.setState({show:e})}},{key:"handleSubmit",value:function(){var e=this;if(this.state.emailEnabled){for(var t=this.state.inviteIds,a=t.length,n=[],r=this.state.emailErrors,i=this.state.firstNameErrors,s=this.state.lastNameErrors,o=!0,l=0;l<a;l++){var d=t[l],u={};u.email=g.default.findDOMNode(this.refs["email"+d]).value.trim(),u.email&&b.isEmail(u.email)?r[d]="":(r[d]=this.props.intl.formatMessage(j.emailError),o=!1),u.firstName=g.default.findDOMNode(this.refs["first_name"+d]).value.trim(),u.lastName=g.default.findDOMNode(this.refs["last_name"+d]).value.trim(),n.push(u)}if(this.setState({emailErrors:r,firstNameErrors:i,lastNameErrors:s}),o&&0!==n.length){var c={};c.invites=n,this.setState({isSendingEmails:!0}),(0,O.inviteMembers)(c,function(){e.handleHide(!1),e.setState({isSendingEmails:!1})},function(t){"api.team.invite_members.already.app_error"===t.id?(r[t.detailed_error]=t.message,e.setState({emailErrors:r})):e.setState({serverError:t.message}),e.setState({isSendingEmails:!1})})}}}},{key:"handleHide",value:function(e){if(e){for(var t=!1,a=0;a<this.state.inviteIds.length;a++){var n=this.state.inviteIds[a];if(""!==g.default.findDOMNode(this.refs["email"+n]).value.trim()){t=!0;break}}if(t)return void this.setState({showConfirmModal:!0})}this.clearFields(),this.setState({show:!1,showConfirmModal:!1})}},{key:"addInviteFields",value:function(){var e=this.state.idCount+1,t=this.state.inviteIds;t.push(e),this.setState({inviteIds:t,idCount:e})}},{key:"clearFields",value:function(){for(var e=this.state.inviteIds,t=0;t<e.length;t++){var a=e[t];g.default.findDOMNode(this.refs["email"+a]).value="",g.default.findDOMNode(this.refs["first_name"+a]).value="",g.default.findDOMNode(this.refs["last_name"+a]).value=""}this.setState({inviteIds:[0],idCount:0,emailErrors:{},firstNameErrors:{},lastNameErrors:{}})}},{key:"removeInviteFields",value:function(e){var t=this.state.idCount,a=this.state.inviteIds,n=a.indexOf(e);n>-1&&a.splice(n,1),a.length||a.push(++t),this.setState({inviteIds:a,idCount:t})}},{key:"showGetTeamInviteLinkModal",value:function(){this.handleHide(!1),w.showGetTeamInviteLinkModal()}},{key:"handleKeyDown",value:function(e){e.keyCode===E.default.KeyCodes.ENTER&&(e.preventDefault(),this.handleSubmit())}},{key:"render",value:function(){var e=this,t=M.default.getCurrentUser(),a=this.props.intl.formatMessage;if(null!=t&&null!=this.state.teamType){for(var n=[],r=this.state.inviteIds,i=0;i<r.length;i++){var s=r[i],o=null;this.state.emailErrors[s]&&(o=x.default.createElement("label",{className:"control-label"},this.state.emailErrors[s]));var l=null;this.state.firstNameErrors[s]&&(l=x.default.createElement("label",{className:"control-label"},this.state.firstNameErrors[s]));var d=null;this.state.lastNameErrors[s]&&(d=x.default.createElement("label",{className:"control-label"},this.state.lastNameErrors[s]));var u=null;s&&(u=x.default.createElement("div",null,x.default.createElement("button",{type:"button",className:"btn btn-link remove__member",onClick:this.removeInviteFields.bind(this,s)},x.default.createElement("span",{className:"fa fa-trash"}))));var c="form-group invite";o&&(c+=" has-error");var f=null,m="form-group";l&&(m+=" has-error");var h="form-group";d&&(h+=" has-error"),f=x.default.createElement("div",{className:"row row--invite"},x.default.createElement("div",{className:"col-sm-6"},x.default.createElement("div",{className:m},x.default.createElement("input",{onKeyDown:this.handleKeyDown,type:"text",className:"form-control",ref:"first_name"+s,placeholder:a(j.firstname),maxLength:"64",disabled:!this.state.emailEnabled||!this.state.userCreationEnabled,spellCheck:"false"}),l)),x.default.createElement("div",{className:"col-sm-6"},x.default.createElement("div",{className:h},x.default.createElement("input",{onKeyDown:this.handleKeyDown,type:"text",className:"form-control",ref:"last_name"+s,placeholder:a(j.lastname),maxLength:"64",disabled:!this.state.emailEnabled||!this.state.userCreationEnabled,spellCheck:"false"}),d))),n[s]=x.default.createElement("div",{key:"key"+s},u,x.default.createElement("div",{className:c},x.default.createElement("input",{onKeyUp:this.displayNameKeyUp,onKeyDown:this.handleKeyDown,type:"text",ref:"email"+s,className:"form-control",placeholder:"email@domain.com",maxLength:"64",disabled:!this.state.emailEnabled||!this.state.userCreationEnabled,spellCheck:"false"}),o),f)}var p=null;this.state.serverError&&(p=x.default.createElement("div",{className:"form-group has-error"},x.default.createElement("label",{className:"control-label"},this.state.serverError)));var g=null,v=null,b="";if(P.default.getByName(E.default.DEFAULT_CHANNEL)&&(b=P.default.getByName(E.default.DEFAULT_CHANNEL).display_name),this.state.emailEnabled&&this.state.userCreationEnabled){g=x.default.createElement("div",null,p,x.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.addInviteFields},x.default.createElement(R.FormattedMessage,{id:"invite_member.addAnother",defaultMessage:"Add another"})),x.default.createElement("br",null),x.default.createElement("br",null),x.default.createElement("span",null,x.default.createElement(R.FormattedHTMLMessage,{id:"invite_member.autoJoin",defaultMessage:"People invited automatically join the <strong>{channel}</strong> channel.",values:{channel:b}})));var y=x.default.createElement(R.FormattedMessage,{id:"invite_member.send",defaultMessage:"Send Invitation"});this.state.isSendingEmails?y=x.default.createElement("span",null,x.default.createElement("i",{className:"fa fa-spinner fa-spin"}),x.default.createElement(R.FormattedMessage,{id:"invite_member.sending",defaultMessage:" Sending"})):this.state.inviteIds.length>1&&(y=x.default.createElement(R.FormattedMessage,{id:"invite_member.send2",defaultMessage:"Send Invitations"})),v=x.default.createElement("button",{onClick:this.handleSubmit,type:"button",className:"btn btn-primary",disabled:this.state.isSendingEmails},y)}else if(this.state.userCreationEnabled){var _=null;if(t&&"O"===this.state.teamType){var w=x.default.createElement("a",{href:"#",onClick:this.showGetTeamInviteLinkModal},x.default.createElement(R.FormattedMessage,{id:"invite_member.inviteLink",defaultMessage:"Team Invite Link"}));_=x.default.createElement("p",null,x.default.createElement(R.FormattedMessage,{id:"invite_member.teamInviteLink",defaultMessage:"You can also invite people using the {link}.",values:{link:w}}))}g=x.default.createElement("div",null,x.default.createElement("p",null,x.default.createElement(R.FormattedMessage,{id:"invite_member.content",defaultMessage:"Email is currently disabled for your team, and email invitations cannot be sent. Contact your System Administrator to enable email and email invitations."})),_)}else g=x.default.createElement("div",null,x.default.createElement("p",null,x.default.createElement(R.FormattedMessage,{id:"invite_member.disabled",defaultMessage:"User creation has been disabled for your team. Please ask your Team Administrator for details."})));return x.default.createElement("div",null,x.default.createElement(A.Modal,{dialogClassName:"modal-invite-member",show:this.state.show,onHide:this.handleHide.bind(this,!0),enforceFocus:!this.state.showConfirmModal,backdrop:!this.state.isSendingEmails||"static"},x.default.createElement(A.Modal.Header,{closeButton:!this.state.isSendingEmails},x.default.createElement(A.Modal.Title,null,x.default.createElement(R.FormattedMessage,{id:"invite_member.newMember",defaultMessage:"Send Email Invite"}))),x.default.createElement(A.Modal.Body,{ref:"modalBody"},x.default.createElement("form",{role:"form"},n),g),x.default.createElement(A.Modal.Footer,null,x.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide.bind(this,!0),disabled:this.state.isSendingEmails},x.default.createElement(R.FormattedMessage,{id:"invite_member.cancel",defaultMessage:"Cancel"})),v)),x.default.createElement(L.default,{title:a(j.modalTitle),message:a(j.modalMessage),confirmButton:a(j.modalButton),show:this.state.showConfirmModal,onConfirm:this.handleHide.bind(this,!1),onCancel:function(){return e.setState({showConfirmModal:!1})}}))}return null}}]),a}(x.default.Component);H.propTypes={intl:R.intlShape.isRequired},t.default=(0,R.injectIntl)(H)}).call(t,a(17))},2016:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(8),g=a(41),v=n(g),b=a(1661),y=r(b),E=a(15),_=r(E),w=a(334),S=r(w),C=a(13),T=a(27),M=a(1),k=r(M),P=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.handleToggle=a.handleToggle.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.handleHide=a.handleHide.bind(a),a.state={show:!1},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){y.default.addModalListener(p.ActionTypes.TOGGLE_LEAVE_TEAM_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){y.default.removeModalListener(p.ActionTypes.TOGGLE_LEAVE_TEAM_MODAL,this.handleToggle)}},{key:"handleToggle",value:function(e){this.setState({show:e})}},{key:"handleSubmit",value:function(e){if(this.setState({show:!1}),S.default.isBusy())return S.default.emitChanged({action:p.WebrtcActionTypes.IN_PROGRESS}),void e.preventDefault();v.emitLeaveTeam()}},{key:"handleHide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){return null!=_.default.getCurrentUser()?k.default.createElement(T.Modal,{className:"modal-confirm",show:this.state.show,onHide:this.handleHide},k.default.createElement(T.Modal.Header,{closeButton:!1},k.default.createElement(T.Modal.Title,null,k.default.createElement(C.FormattedMessage,{id:"leave_team_modal.title",defaultMessage:"Leave the team?"}))),k.default.createElement(T.Modal.Body,null,k.default.createElement(C.FormattedMessage,{id:"leave_team_modal.desc",defaultMessage:"You will be removed from all public and private channels.  If the team is private you will not be able to rejoin the team.  Are you sure?"})),k.default.createElement(T.Modal.Footer,null,k.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide},k.default.createElement(C.FormattedMessage,{id:"leave_team_modal.no",defaultMessage:"No"})),k.default.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.handleSubmit},k.default.createElement(C.FormattedMessage,{id:"leave_team_modal.yes",defaultMessage:"Yes"})))):null}}]),t}(k.default.Component);P.propTypes={intl:C.intlShape.isRequired},t.default=(0,C.injectIntl)(P)},2019:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(0),g=r(p),v=a(342),b=r(v),y=a(588),E=r(y),_=a(593),w=r(_),S=a(2022),C=r(S),T=a(584),M=r(T),k=a(249),P=r(k),D=a(341),I=r(D),N=a(585),L=r(N),O=a(586),R=r(O),A=a(600),F=r(A),x=a(248),U=r(x),j=a(577),H=r(j),B=a(15),V=r(B),G=a(24),z=r(G),W=a(23),q=r(W),Y=a(42),K=r(Y),J=a(244),X=r(J),Z=a(2001),$=r(Z),Q=a(11),ee=n(Q),te=a(81),ae=n(te),ne=a(47),re=n(ne),ie=a(41),se=n(ie),oe=a(104),le=a(8),de=r(le),ue=a(16),ce=r(ue),fe=a(13),me=a(27),he=a(37),pe=a(1),ge=r(pe),ve=de.default.ActionTypes,be=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));a.toggleFavorite=function(e){e.preventDefault(),a.state.isFavorite?re.unmarkFavorite(a.state.channel.id):re.markFavorite(a.state.channel.id)},a.onChange=a.onChange.bind(a),a.handleLeave=a.handleLeave.bind(a),a.showSearch=a.showSearch.bind(a),a.showEditChannelHeaderModal=a.showEditChannelHeaderModal.bind(a),a.showRenameChannelModal=a.showRenameChannelModal.bind(a),a.hideRenameChannelModal=a.hideRenameChannelModal.bind(a),a.isStateValid=a.isStateValid.bind(a),a.createCollapseButtons=a.createCollapseButtons.bind(a),a.createDropdown=a.createDropdown.bind(a),a.showMembersModal=a.showMembersModal.bind(a),a.hideMembersModal=a.hideMembersModal.bind(a),a.showChannelSwitchModal=a.showChannelSwitchModal.bind(a),a.hideChannelSwitchModal=a.hideChannelSwitchModal.bind(a),a.openDirectMessageModal=a.openDirectMessageModal.bind(a),a.getPinnedPosts=a.getPinnedPosts.bind(a);var n=a.getStateFromStores();return n.showEditChannelPurposeModal=!1,n.showEditChannelHeaderModal=!1,n.showMembersModal=!1,n.showRenameChannelModal=!1,n.showChannelSwitchModal=!1,a.state=n,a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"getStateFromStores",value:function(){var e=z.default.getCurrent();return{channel:e,member:z.default.getCurrentMember(),users:[],userCount:z.default.getCurrentStats().member_count,currentUser:V.default.getCurrentUser(),isFavorite:e&&ae.isFavoriteChannel(e)}}},{key:"isStateValid",value:function(){return this.state.channel&&this.state.member&&this.state.users&&this.state.currentUser}},{key:"componentDidMount",value:function(){z.default.addChangeListener(this.onChange),z.default.addStatsChangeListener(this.onChange),V.default.addStatusesChangeListener(this.onChange),V.default.addChangeListener(this.onChange),K.default.addChangeListener(this.onChange),(0,g.default)(".inner-wrap").click(this.hideSidebars),document.addEventListener("keydown",this.showChannelSwitchModal)}},{key:"componentWillUnmount",value:function(){z.default.removeChangeListener(this.onChange),z.default.removeStatsChangeListener(this.onChange),V.default.removeStatusesChangeListener(this.onChange),V.default.removeChangeListener(this.onChange),K.default.removeChangeListener(this.onChange),document.removeEventListener("keydown",this.showChannelSwitchModal)}},{key:"handleSubmit",value:function(e){e.preventDefault()}},{key:"handleLeave",value:function(){re.leaveChannel(this.state.channel.id)}},{key:"hideSidebars",value:function(e){(0,g.default)(window).outerWidth()<=768&&(ce.default.handleServerAction({type:ve.RECEIVED_SEARCH,results:null}),ce.default.handleServerAction({type:ve.RECEIVED_POST_SELECTED,postId:null}),"navbar-toggle"!==e.target.className&&"icon-bar"!==e.target.className&&((0,g.default)(".app__body .inner-wrap").removeClass("move--right move--left move--left-small"),(0,g.default)(".app__body .sidebar--left").removeClass("move--right"),(0,g.default)(".multi-teams .team-sidebar").removeClass("move--right"),(0,g.default)(".app__body .sidebar--right").removeClass("move--left"),(0,g.default)(".app__body .sidebar--menu").removeClass("move--left")))}},{key:"toggleLeftSidebar",value:function(){(0,g.default)(".app__body .inner-wrap").toggleClass("move--right"),(0,g.default)(".app__body .sidebar--left").toggleClass("move--right"),(0,g.default)(".multi-teams .team-sidebar").toggleClass("move--right")}},{key:"toggleRightSidebar",value:function(){(0,g.default)(".app__body .inner-wrap").toggleClass("move--left-small"),(0,g.default)(".app__body .sidebar--menu").toggleClass("move--left")}},{key:"showSearch",value:function(){ce.default.handleServerAction({type:ve.SHOW_SEARCH})}},{key:"onChange",value:function(){this.setState(this.getStateFromStores())}},{key:"showEditChannelHeaderModal",value:function(){this.refs.headerOverlay&&this.refs.headerOverlay.hide(),this.setState({showEditChannelHeaderModal:!0})}},{key:"showRenameChannelModal",value:function(e){e.preventDefault(),this.setState({showRenameChannelModal:!0})}},{key:"hideRenameChannelModal",value:function(){this.setState({showRenameChannelModal:!1})}},{key:"showMembersModal",value:function(e){e.preventDefault(),this.setState({showMembersModal:!0})}},{key:"hideMembersModal",value:function(){this.setState({showMembersModal:!1})}},{key:"showChannelSwitchModal",value:function(e){ee.cmdOrCtrlPressed(e)&&e.keyCode===de.default.KeyCodes.K&&(e.preventDefault(),this.setState({showChannelSwitchModal:!this.state.showChannelSwitchModal}))}},{key:"hideChannelSwitchModal",value:function(){this.setState({showChannelSwitchModal:!1})}},{key:"openDirectMessageModal",value:function(){ce.default.handleViewAction({type:ve.TOGGLE_DM_MODAL,value:!0,startingUsers:V.default.getProfileListInChannel(this.state.channel.id,!0)})}},{key:"getPinnedPosts",value:function(e){e.preventDefault(),X.default.isPinnedPosts?se.toggleSideBarAction(!1):(0,oe.getPinnedPosts)(this.state.channel.id)}},{key:"createDropdown",value:function(e,t,a,n,r,i,s,o){var l=this;if(e){var d=void 0,u=void 0,c=void 0,f=void 0,m=void 0,h=void 0,p=void 0,g=void 0,v=void 0,b=void 0;if(i)m=ge.default.createElement("li",{role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showEditChannelHeaderModal},ge.default.createElement(fe.FormattedMessage,{id:"channel_header.channelHeader",defaultMessage:"Set Channel Header..."})));else if(s)m=ge.default.createElement("li",{role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showEditChannelHeaderModal},ge.default.createElement(fe.FormattedMessage,{id:"channel_header.channelHeader",defaultMessage:"Set Channel Header..."}))),p=ge.default.createElement("li",{role:"presentation"},ge.default.createElement(U.default,{role:"menuitem",dialogType:L.default,dialogProps:{channel:e,channelMember:this.state.member,currentUser:this.state.currentUser}},ge.default.createElement(fe.FormattedMessage,{id:"navbar.preferences",defaultMessage:"Notification Preferences"}))),c=ge.default.createElement("li",{role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:this.openDirectMessageModal},ge.default.createElement(fe.FormattedMessage,{id:"navbar.addMembers",defaultMessage:"Add Members"})));else{d=ge.default.createElement("li",{role:"presentation"},ge.default.createElement(U.default,{role:"menuitem",dialogType:M.default,dialogProps:{channel:e}},ge.default.createElement(fe.FormattedMessage,{id:"navbar.viewInfo",defaultMessage:"View Info"}))),u=ge.default.createElement("li",{role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:this.getPinnedPosts},ge.default.createElement(fe.FormattedMessage,{id:"navbar.viewPinnedPosts",defaultMessage:"View Pinned Posts"}))),z.default.isDefault(e)||(c=ge.default.createElement("li",{role:"presentation"},ge.default.createElement(U.default,{ref:"channelInviteModalButton",role:"menuitem",dialogType:P.default,dialogProps:{channel:e,currentUser:this.state.currentUser}},ge.default.createElement(fe.FormattedMessage,{id:"navbar.addMembers",defaultMessage:"Add Members"}))),f=a?ge.default.createElement("li",{key:"manage_members",role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showMembersModal},ge.default.createElement(fe.FormattedMessage,{id:"channel_header.manageMembers",defaultMessage:"Manage Members"}))):ge.default.createElement("li",{key:"view_members",role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showMembersModal},ge.default.createElement(fe.FormattedMessage,{id:"channel_header.viewMembers",defaultMessage:"View Members"})))),p=ge.default.createElement("li",{role:"presentation"},ge.default.createElement(U.default,{role:"menuitem",dialogType:L.default,dialogProps:{channel:e,channelMember:this.state.member,currentUser:this.state.currentUser}},ge.default.createElement(fe.FormattedMessage,{id:"navbar.preferences",defaultMessage:"Notification Preferences"}))),ae.showManagementOptions(e,a,n,r)&&(m=ge.default.createElement("li",{role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showEditChannelHeaderModal},ge.default.createElement(fe.FormattedMessage,{id:"channel_header.setHeader",defaultMessage:"Edit Channel Header"}))),h=ge.default.createElement("li",{role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:function(){return l.setState({showEditChannelPurposeModal:!0})}},ge.default.createElement(fe.FormattedMessage,{id:"channel_header.setPurpose",defaultMessage:"Edit Channel Purpose"}))),g=ge.default.createElement("li",{role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showRenameChannelModal},ge.default.createElement(fe.FormattedMessage,{id:"channel_header.rename",defaultMessage:"Rename Channel"})))),(ae.showDeleteOption(e,a,n,r)||1===this.state.userCount)&&(z.default.isDefault(e)||(v=ge.default.createElement("li",{role:"presentation"},ge.default.createElement(U.default,{role:"menuitem",dialogType:R.default,dialogProps:{channel:e}},ge.default.createElement(fe.FormattedMessage,{id:"channel_header.delete",defaultMessage:"Delete Channel"})))));var y=e.type!==de.default.PRIVATE_CHANNEL||this.state.userCount>1;!z.default.isDefault(e)&&y&&(b=ge.default.createElement("li",{role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:this.handleLeave},ge.default.createElement(fe.FormattedMessage,{id:"channel_header.leave",defaultMessage:"Leave Channel"}))))}var E=ge.default.createElement("li",{key:"toggle_favorite",role:"presentation"},ge.default.createElement("a",{role:"menuitem",href:"#",onClick:this.toggleFavorite},this.state.isFavorite?ge.default.createElement(fe.FormattedMessage,{id:"channelHeader.removeFromFavorites",defaultMessage:"Remove from Favorites"}):ge.default.createElement(fe.FormattedMessage,{id:"channelHeader.addToFavorites",defaultMessage:"Add to Favorites"})));return ge.default.createElement("div",{className:"navbar-brand"},ge.default.createElement("div",{className:"dropdown"},ge.default.createElement(me.OverlayTrigger,{ref:"headerOverlay",trigger:"click",placement:"bottom",overlay:o,className:"description",rootClose:!0},ge.default.createElement("div",{className:"pull-right description info-popover"})),ge.default.createElement("a",{href:"#",className:"dropdown-toggle theme",type:"button","data-toggle":"dropdown","aria-expanded":"true"},ge.default.createElement("span",{className:"heading"},ge.default.createElement(H.default,{status:this.getTeammateStatus()}),t," "),ge.default.createElement("span",{className:"fa fa-chevron-down header-dropdown__icon"})),ge.default.createElement("ul",{className:"dropdown-menu",role:"menu"},d,u,p,c,f,m,h,g,v,b,E,ge.default.createElement("div",{className:"close visible-xs-block",onClick:function(){return l.refs.headerOverlay.hide()}},"×"))))}return ge.default.createElement("div",{className:"navbar-brand"},ge.default.createElement(he.Link,{to:q.default.getCurrentTeamUrl()+"/channels/town-square",className:"heading"},t))}},{key:"createCollapseButtons",value:function(e){var t=[];return null==e?t.push(ge.default.createElement("button",{key:"navbar-toggle-collapse",type:"button",className:"navbar-toggle","data-toggle":"collapse","data-target":"#navbar-collapse-1"},ge.default.createElement("span",{className:"sr-only"},ge.default.createElement(fe.FormattedMessage,{id:"navbar.toggle1",defaultMessage:"Toggle sidebar"})),ge.default.createElement("span",{className:"icon-bar"}),ge.default.createElement("span",{className:"icon-bar"}),ge.default.createElement("span",{className:"icon-bar"}))):(t.push(ge.default.createElement("button",{key:"navbar-toggle-sidebar",type:"button",className:"navbar-toggle","data-toggle":"collapse","data-target":"#sidebar-nav",onClick:this.toggleLeftSidebar},ge.default.createElement("span",{className:"sr-only"},ge.default.createElement(fe.FormattedMessage,{id:"navbar.toggle2",defaultMessage:"Toggle sidebar"})),ge.default.createElement("span",{className:"icon-bar"}),ge.default.createElement("span",{className:"icon-bar"}),ge.default.createElement("span",{className:"icon-bar"}),ge.default.createElement(C.default,null))),t.push(ge.default.createElement("button",{key:"navbar-toggle-menu",type:"button",className:"navbar-toggle menu-toggle pull-right","data-toggle":"collapse","data-target":"#sidebar-nav",onClick:this.toggleRightSidebar},ge.default.createElement("span",{dangerouslySetInnerHTML:{__html:de.default.MENU_ICON}})))),t}},{key:"getTeammateStatus",value:function(){if("D"===this.state.channel.type){var e=this.state.currentUser.id,t=this.state.users.find(function(t){return t.id!==e});if(t)return V.default.getStatus(t.id)}return null}},{key:"render",value:function(){var e=this;if(!this.isStateValid())return null;var t,a=this.state.currentUser.id,n=this.state.channel,r=this.props.teamDisplayName,i=!1,s=!1,o=!1,l=!1,d=!1,u=null,c=null,f=null,m=null,h=null;if(n){if(t=ge.default.createElement(me.Popover,{bsStyle:"info",placement:"bottom",id:"header-popover"},ge.default.createElement(w.default,{message:n.header,options:{singleline:!0,mentionHighlight:!1}}),ge.default.createElement("div",{className:"close visible-xs-block",onClick:function(){return e.refs.headerOverlay.hide()}},"×")),i=q.default.isTeamAdminForCurrentTeam()||V.default.isSystemAdminForCurrentUser(),s=V.default.isSystemAdminForCurrentUser(),o=z.default.isChannelAdminForCurrentChannel(),"O"===n.type)r=n.display_name;else if("P"===n.type)r=n.display_name;else if("D"===n.type){l=!0;var p=ee.getUserIdFromChannelName(n);r=ee.displayUsername(p)}else n.type===de.default.GM_CHANNEL&&(d=!0,r=ae.buildGroupChannelName(n.id));if(0===n.header.length){var g=ge.default.createElement("a",{href:"#",onClick:this.showEditChannelHeaderModal},ge.default.createElement(fe.FormattedMessage,{id:"navbar.click",defaultMessage:"Click here"}));t=ge.default.createElement(me.Popover,{bsStyle:"info",placement:"bottom",id:"header-popover"},ge.default.createElement("div",null,ge.default.createElement(fe.FormattedMessage,{id:"navbar.noHeader",defaultMessage:"No channel header yet.{newline}{link} to add one.",values:{newline:ge.default.createElement("br",null),link:g}})),ge.default.createElement("div",{className:"close visible-xs-block",onClick:function(){return e.refs.headerOverlay.hide()}},"×"))}this.state.showEditChannelHeaderModal&&(u=ge.default.createElement(b.default,{onHide:function(){return e.setState({showEditChannelHeaderModal:!1})},channel:n})),this.state.showEditChannelPurposeModal&&(c=ge.default.createElement(E.default,{onModalDismissed:function(){return e.setState({showEditChannelPurposeModal:!1})},channel:n})),f=ge.default.createElement(F.default,{show:this.state.showRenameChannelModal,onHide:this.hideRenameChannelModal,channel:n}),this.state.showMembersModal&&(m=ge.default.createElement(I.default,{show:!0,onModalDismissed:this.hideMembersModal,showInviteModal:function(){return e.refs.channelInviteModalButton.show()},channel:n,isAdmin:i})),h=ge.default.createElement($.default,{show:this.state.showChannelSwitchModal,onHide:this.hideChannelSwitchModal})}var v=this.createCollapseButtons(a),y=ge.default.createElement("button",{type:"button",className:"navbar-toggle pull-right",onClick:this.showSearch},ge.default.createElement("span",{className:"fa fa-search icon-search icon--white"})),_=this.createDropdown(n,r,i,s,o,l,d,t);return ge.default.createElement("div",null,ge.default.createElement("nav",{className:"navbar navbar-default navbar-fixed-top",role:"navigation"},ge.default.createElement("div",{className:"container-fluid theme"},ge.default.createElement("div",{className:"navbar-header"},v,y,_))),u,c,f,m,h)}}]),t}(ge.default.Component);t.default=be,be.defaultProps={teamDisplayName:""},be.propTypes={teamDisplayName:ge.default.PropTypes.string}},2022:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function i(){var e=0,t=0,a=_.default.getMyTeamMembers(),n=y.default.getAll(),r=y.default.getMyMembers();return a.forEach(function(a){a.team_id!==_.default.getCurrentId()&&(e+=a.mention_count||0,t+=a.msg_count||0)}),n.forEach(function(a){var n=r[a.id];null!=n&&("D"===a.type?e+=a.total_msg_count-n.msg_count:n.mention_count>0&&(e+=n.mention_count),"mention"!==n.notify_props.mark_unread&&a.total_msg_count-n.msg_count>0&&(t+=1))}),{mentionCount:e,messageCount:t}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),o=r(s),l=a(2),d=r(l),u=a(5),c=r(u),f=a(4),m=r(f),h=a(3),p=r(h),g=a(11),v=n(g),b=a(24),y=r(b),E=a(23),_=r(E),w=a(1),S=r(w),C=function(e){function t(e){(0,d.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return a.onListenerChange=a.onListenerChange.bind(a),a.state=i(),a.mounted=!1,a}return(0,p.default)(t,e),(0,c.default)(t,[{key:"componentDidMount",value:function(){this.mounted=!0,y.default.addChangeListener(this.onListenerChange),_.default.addChangeListener(this.onListenerChange)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,y.default.removeChangeListener(this.onListenerChange),_.default.removeChangeListener(this.onListenerChange)}},{key:"onListenerChange",value:function(){if(this.mounted){var e=i();v.areObjectsEqual(e,this.state)||this.setState(e)}}},{key:"render",value:function(){return this.state.mentionCount?S.default.createElement("span",{className:"badge badge-notify"},this.state.mentionCount):this.state.messageCount?S.default.createElement("span",{className:"badge badge-notify"},"•"):null}}]),t}(S.default.Component);t.default=C},2023:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),i=n(r),s=a(2),o=n(s),l=a(5),d=n(l),u=a(4),c=n(u),f=a(3),m=n(f),h=a(1),p=n(h),g=a(13),v=function(e){function t(){return(0,o.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){return p.default.createElement("div",{className:"date-separator"},p.default.createElement("hr",{className:"separator__hr"}),p.default.createElement("div",{className:"separator__text"},p.default.createElement(g.FormattedDate,{value:this.props.date,weekday:"short",month:"short",day:"2-digit",year:"numeric"})))}}]),t}(p.default.Component);t.default=v,v.propTypes={date:p.default.PropTypes.instanceOf(Date)}},2027:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),i=n(r),s=a(2),o=n(s),l=a(5),d=n(l),u=a(4),c=n(u),f=a(3),m=n(f),h=a(0),p=n(h),g=a(30),v=n(g),b=a(24),y=n(b),E=a(23),_=n(E),w=a(15),S=n(w),C=a(79),T=n(C),M=a(13),k=a(37),P=a(1),D=n(P),I=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleShow=a.handleShow.bind(a),a.handleClose=a.handleClose.bind(a),a.state={channelName:"",remover:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"handleShow",value:function(){var e={};T.default.getItem("channel-removed-state")&&(e=T.default.getItem("channel-removed-state"),T.default.removeItem("channel-removed-state"));var t=y.default.getByName("town-square");setTimeout(function(){k.browserHistory.push(_.default.getCurrentTeamRelativeUrl()+"/channels/"+t.name)},1),this.setState(e)}},{key:"handleClose",value:function(){this.setState({channelName:"",remover:""})}},{key:"componentDidMount",value:function(){(0,p.default)(v.default.findDOMNode(this)).on("show.bs.modal",this.handleShow),(0,p.default)(v.default.findDOMNode(this)).on("hidden.bs.modal",this.handleClose)}},{key:"componentWillUnmount",value:function(){(0,p.default)(v.default.findDOMNode(this)).off("show.bs.modal",this.handleShow),(0,p.default)(v.default.findDOMNode(this)).off("hidden.bs.modal",this.handleClose)}},{key:"render",value:function(){var e=S.default.getCurrentUser(),t=D.default.createElement(M.FormattedMessage,{id:"removed_channel.channelName",defaultMessage:"the channel"});this.state.channelName&&(t=this.state.channelName);var a=D.default.createElement(M.FormattedMessage,{id:"removed_channel.someone",defaultMessage:"Someone"});return this.state.remover&&(a=this.state.remover),null!=e?D.default.createElement("div",{className:"modal fade",ref:"modal",id:"removed_from_channel",tabIndex:"-1",role:"dialog","aria-hidden":"true"},D.default.createElement("div",{className:"modal-dialog"},D.default.createElement("div",{className:"modal-content"},D.default.createElement("div",{className:"modal-header"},D.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},D.default.createElement("span",{"aria-hidden":"true"},"×")),D.default.createElement("h4",{className:"modal-title"},D.default.createElement(M.FormattedMessage,{id:"removed_channel.from",defaultMessage:"Removed from "}),D.default.createElement("span",{className:"name"},t))),D.default.createElement("div",{className:"modal-body"},D.default.createElement("p",null,D.default.createElement(M.FormattedMessage,{id:"removed_channel.remover",defaultMessage:"{remover} removed you from {channel}",values:{remover:a,channel:t}}))),D.default.createElement("div",{className:"modal-footer"},D.default.createElement("button",{type:"button",className:"btn btn-primary","data-dismiss":"modal"},D.default.createElement(M.FormattedMessage,{id:"removed_channel.okay",defaultMessage:"Okay"})))))):D.default.createElement("div",null)}}]),t}(D.default.Component);t.default=I},2028:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(338),g=r(p),v=a(571),b=r(v),y=a(598),E=r(y),_=a(572),w=r(_),S=a(166),C=r(S),T=a(575),M=r(T),k=a(1777),P=r(k),D=a(41),I=n(D),N=a(104),L=a(23),O=r(L),R=a(11),A=n(R),F=a(105),x=n(F),U=a(8),j=r(U),H=a(246),B=r(H),V=a(27),G=a(13),z=a(337),W=r(z),q=a(30),Y=r(q),K=a(121),J=r(K),X=a(1),Z=r(X),$=a(37),Q=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,s.default)(a)).call(this,e));return t.handlePermalink=t.handlePermalink.bind(t),t.removePost=t.removePost.bind(t),t.flagPost=t.flagPost.bind(t),t.unflagPost=t.unflagPost.bind(t),t.pinPost=t.pinPost.bind(t),t.unpinPost=t.unpinPost.bind(t),t.reactEmojiClick=t.reactEmojiClick.bind(t),t.emojiPickerClick=t.emojiPickerClick.bind(t),t.canEdit=!1,t.canDelete=!1,t.editDisableAction=new B.default(t.handleEditDisable),t.state={currentTeamDisplayName:O.default.getCurrent().name,width:"",height:"",showReactEmojiPicker:!1,reactPickerOffset:15},t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(){A.updateWindowDimensions(e)})}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("resize",function(){A.updateWindowDimensions(e)})}},{key:"handlePermalink",value:function(e){e.preventDefault(),I.showGetPostLinkModal(this.props.post)}},{key:"handleEditDisable",value:function(){this.canEdit=!1}},{key:"removePost",value:function(){I.emitRemovePost(this.props.post)}},{key:"createRemovePostButton",value:function(){return Z.default.createElement("a",{href:"#",className:"post__remove theme",type:"button",onClick:this.removePost},"×")}},{key:"shouldComponentUpdate",value:function(e,t){return e.status!==this.props.status||(e.isBusy!==this.props.isBusy||(e.compactDisplay!==this.props.compactDisplay||(e.useMilitaryTime!==this.props.useMilitaryTime||(e.isFlagged!==this.props.isFlagged||(!A.areObjectsEqual(e.post,this.props.post)||(!A.areObjectsEqual(e.currentUser,this.props.currentUser)||this.state.showReactEmojiPicker!==t.showReactEmojiPicker))))))}},{key:"flagPost",value:function(e){e.preventDefault(),(0,N.flagPost)(this.props.post.id)}},{key:"unflagPost",value:function(e){e.preventDefault(),(0,N.unflagPost)(this.props.post.id)}},{key:"pinPost",value:function(e){e.preventDefault(),(0,N.pinPost)(this.props.post.channel_id,this.props.post.id)}},{key:"unpinPost",value:function(e){e.preventDefault(),(0,N.unpinPost)(this.props.post.channel_id,this.props.post.id)}},{key:"createDropdown",value:function(e){var t=this.props.post;if(t.state===j.default.POST_FAILED||t.state===j.default.POST_LOADING)return"";this.canDelete=x.canDeletePost(t),this.canEdit=x.canEditPost(t,this.editDisableAction);var a=[];return A.isMobile()&&(this.props.isFlagged?a.push(Z.default.createElement("li",{key:"mobileFlag",role:"presentation"},Z.default.createElement("a",{href:"#",onClick:this.unflagPost},Z.default.createElement(G.FormattedMessage,{id:"rhs_root.mobile.unflag",defaultMessage:"Unflag"})))):a.push(Z.default.createElement("li",{key:"mobileFlag",role:"presentation"},Z.default.createElement("a",{href:"#",onClick:this.flagPost},Z.default.createElement(G.FormattedMessage,{id:"rhs_root.mobile.flag",defaultMessage:"Flag"}))))),e||(a.push(Z.default.createElement("li",{key:"rhs-root-permalink",role:"presentation"},Z.default.createElement("a",{href:"#",onClick:this.handlePermalink},Z.default.createElement(G.FormattedMessage,{id:"rhs_comment.permalink",defaultMessage:"Permalink"})))),t.is_pinned?a.push(Z.default.createElement("li",{key:"rhs-comment-unpin",role:"presentation"},Z.default.createElement("a",{href:"#",onClick:this.unpinPost},Z.default.createElement(G.FormattedMessage,{id:"rhs_root.unpin",defaultMessage:"Un-pin from channel"})))):a.push(Z.default.createElement("li",{key:"rhs-comment-pin",role:"presentation"},Z.default.createElement("a",{href:"#",onClick:this.pinPost},Z.default.createElement(G.FormattedMessage,{id:"rhs_root.pin",defaultMessage:"Pin to channel"}))))),this.canDelete&&a.push(Z.default.createElement("li",{role:"presentation",key:"delete-button"},Z.default.createElement("a",{href:"#",role:"menuitem",onClick:function(e){e.preventDefault(),I.showDeletePostModal(t,0)}},Z.default.createElement(G.FormattedMessage,{id:"rhs_comment.del",defaultMessage:"Delete"})))),this.canEdit&&a.push(Z.default.createElement("li",{role:"presentation",key:"edit-button",className:this.canEdit?"":"hide"},Z.default.createElement("a",{href:"#",role:"menuitem","data-toggle":"modal","data-target":"#edit_post","data-refocusid":"#reply_textbox","data-title":A.localizeMessage("rhs_comment.comment","Comment"),"data-message":t.message,"data-postid":t.id,"data-channelid":t.channel_id},Z.default.createElement(G.FormattedMessage,{id:"rhs_comment.edit",defaultMessage:"Edit"})))),0===a.length?"":Z.default.createElement(P.default,{dropdownContents:a})}},{key:"timeTag",value:function(e,t){return Z.default.createElement("time",{className:"post__time",dateTime:A.getDateForUnixTicks(e.create_at).toISOString()},A.getDateForUnixTicks(e.create_at).toLocaleString("en",t))}},{key:"renderTimeTag",value:function(e,t){return A.isMobile()?this.timeTag(e,t):Z.default.createElement($.Link,{to:"/"+this.state.currentTeamDisplayName+"/pl/"+e.id,target:"_blank",className:"post__permalink"},this.timeTag(e,t))}},{key:"emojiPickerClick",value:function(){var e=15,t=360,a=Y.default.findDOMNode(this).getBoundingClientRect().top,n=700,r=n-a;r<t&&(e=r-t),this.setState({showReactEmojiPicker:!this.state.showReactEmojiPicker,reactPickerOffset:e})}},{key:"reactEmojiClick",value:function(e){this.setState({showReactEmojiPicker:!1});var t=e.name||e.aliases[0];(0,N.addReaction)(this.props.post.channel_id,this.props.post.id,t)}},{key:"render",value:function(){var t=this,a=this.props.post,n=j.default.FLAG_ICON_SVG,r=j.default.MATTERMOST_ICON_SVG,i=A.isPostEphemeral(a),s=a.state===j.default.POST_FAILED||a.state===j.default.POST_LOADING,o=x.isSystemMessage(a),l="";this.props.currentUser.id===a.user_id&&(l="current--user");var d=this.props.currentUser.last_picture_update,u=this.props.status;a.props&&"true"===a.props.from_webhook&&(u=null);var c=void 0,f=Z.default.createElement(g.default,{user:this.props.user,status:u,isBusy:this.props.isBusy});a.props&&a.props.from_webhook?(f=a.props.override_username&&"true"===e.window.mm_config.EnablePostUsernameOverride?Z.default.createElement(g.default,{user:this.props.user,overwriteName:a.props.override_username,disablePopover:!0}):Z.default.createElement(g.default,{user:this.props.user,disablePopover:!0}),c=Z.default.createElement("li",{className:"col col__name bot-indicator"},"BOT")):o&&(f=Z.default.createElement(g.default,{user:{},overwriteName:Z.default.createElement(G.FormattedMessage,{id:"post_info.system",defaultMessage:"System"}),overwriteImage:j.default.SYSTEM_MESSAGE_PROFILE_IMAGE,disablePopover:!0}));var m=void 0,h="";a.state===j.default.POST_FAILED?(h+=" post-fail",m=Z.default.createElement(E.default,{post:this.props.post})):a.state===j.default.POST_LOADING&&(h+=" post-waiting",m=Z.default.createElement("img",{className:"post-loading-gif pull-right",src:J.default})),x.isEdited(this.props.post)&&(h+=" post--edited");var p="";o&&(p="post--system");var v=Z.default.createElement(C.default,{src:x.getProfilePicSrcForPost(a,d),status:u,width:"36",height:"36",user:this.props.user,isBusy:this.props.isBusy});a.props&&a.props.from_webhook&&(v=Z.default.createElement(C.default,{src:x.getProfilePicSrcForPost(a,d),width:"36",height:"36"})),o&&(v=Z.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:r}}));var y="";this.props.compactDisplay&&(y="post--compact",v=a.props&&a.props.from_webhook?Z.default.createElement(C.default,{src:""}):Z.default.createElement(C.default,{src:"",status:u,user:this.props.user,isBusy:this.props.isBusy}));var _=Z.default.createElement("div",{className:"post__img"},v),S=null;a.file_ids&&a.file_ids.length>0&&(S=Z.default.createElement(b.default,{post:a,compactDisplay:this.props.compactDisplay}));var T=void 0,k=void 0,P="",D=Z.default.createElement(V.Tooltip,{id:"flagTooltip"},Z.default.createElement(G.FormattedMessage,{id:"flag_post.flag",defaultMessage:"Flag for follow up"}));this.props.isFlagged?(P="visible",T=Z.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:n}}),k=this.unflagPost,D=Z.default.createElement(V.Tooltip,{id:"flagTooltip"},Z.default.createElement(G.FormattedMessage,{id:"flag_post.unflag",defaultMessage:"Unflag"}))):(T=Z.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:n}}),k=this.flagPost);var I=void 0;i||(I=Z.default.createElement(V.OverlayTrigger,{key:"commentflagtooltipkey"+P,delayShow:j.default.OVERLAY_TIME_DELAY,placement:"top",overlay:D},Z.default.createElement("a",{href:"#",className:"flag-icon__container "+P,onClick:k},T)));var N=void 0,L=void 0;i||s||o||!A.isFeatureEnabled(j.default.PRE_RELEASE_FEATURES.EMOJI_PICKER_PREVIEW)||(N=Z.default.createElement("span",null,Z.default.createElement("a",{href:"#",className:"reacticon__container reaction",onClick:this.emojiPickerClick,ref:"rhs_reacticon_"+a.id},Z.default.createElement("i",{className:"fa fa-smile-o"}))),L=Z.default.createElement(V.Overlay,{id:"rhs_react_overlay_"+a.id,show:this.state.showReactEmojiPicker,placement:"top",rootClose:!0,container:this.refs["post_body_"+a.id],onHide:function(){return t.setState({showReactEmojiPicker:!1})},target:function(){return Y.default.findDOMNode(t.refs["rhs_reacticon_"+a.id])}},Z.default.createElement(W.default,{onEmojiClick:this.reactEmojiClick,pickerLocation:"react-rhs-comment",emojiOffset:this.state.reactPickerOffset})));var O=void 0;i?O=Z.default.createElement("li",{className:"col col__remove"},this.createRemovePostButton()):o||(O=Z.default.createElement("li",{className:"col col__reply"},L,this.createDropdown(o),N));var R=void 0;a.is_pinned&&(R=Z.default.createElement("span",{className:"post__pinned-badge"},Z.default.createElement(G.FormattedMessage,{id:"post_info.pinned",defaultMessage:"Pinned"})));var F={hour:"2-digit",minute:"2-digit",hour12:!this.props.useMilitaryTime};return Z.default.createElement("div",{ref:"post_body_"+a.id,className:"post post--thread "+l+" "+y+" "+p},Z.default.createElement("div",{className:"post__content"},_,Z.default.createElement("div",null,Z.default.createElement("ul",{className:"post__header"},Z.default.createElement("li",{className:"col col__name"},Z.default.createElement("strong",null,f)),c,Z.default.createElement("li",{className:"col"},this.renderTimeTag(a,F),R,I),O),Z.default.createElement("div",{className:"post__body"},Z.default.createElement("div",{className:h},m,Z.default.createElement(w.default,{post:a})),S,Z.default.createElement(M.default,{post:a})))))}}]),a}(Z.default.Component);t.default=Q,Q.propTypes={post:Z.default.PropTypes.object,user:Z.default.PropTypes.object.isRequired,currentUser:Z.default.PropTypes.object.isRequired,compactDisplay:Z.default.PropTypes.bool,useMilitaryTime:Z.default.PropTypes.bool.isRequired,isFlagged:Z.default.PropTypes.bool,status:Z.default.PropTypes.string,isBusy:Z.default.PropTypes.bool}}).call(t,a(17))},2029:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),i=n(r),s=a(2),o=n(s),l=a(5),d=n(l),u=a(4),c=n(u),f=a(581),m=n(f),h=a(3),p=n(h),g=a(27),v=a(1),b=n(v),y=function(e){function t(e){return(0,o.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,p.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){return b.default.createElement("div",{className:"dropdown-menu__content",onClick:this.props.onClose},(0,m.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"render",this).call(this))}}]),t}(g.Dropdown.Menu);t.default=y},2030:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(16),g=r(p),v=a(8),b=r(v),y=a(27),E=a(41),_=n(E),w=a(104),S=a(13),C=a(1),T=r(C),M=b.default.ActionTypes,k=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.handleClose=a.handleClose.bind(a),a.toggleSize=a.toggleSize.bind(a),a.handleBack=a.handleBack.bind(a),a.state={},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"handleClose",value:function(e){e.preventDefault(),_.emitCloseRightHandSide(),this.props.shrink()}},{key:"toggleSize",value:function(e){e.preventDefault(),this.props.toggleSize()}},{key:"handleBack",value:function(e){e.preventDefault(),this.props.fromSearch||this.props.isWebrtc?(g.default.handleServerAction({type:M.RECEIVED_SEARCH_TERM,term:this.props.fromSearch,do_search:!0,is_mention_search:this.props.isMentionSearch}),g.default.handleServerAction({type:M.RECEIVED_POST_SELECTED,postId:null})):this.props.fromFlaggedPosts&&(0,w.getFlaggedPosts)()}},{key:"render",value:function(){var e=void 0,t=T.default.createElement(y.Tooltip,{id:"closeSidebarTooltip"},T.default.createElement(S.FormattedMessage,{id:"rhs_header.closeSidebarTooltip",defaultMessage:"Close Sidebar"})),a=void 0;this.props.fromSearch?a=T.default.createElement(y.Tooltip,{id:"backToResultsTooltip"},T.default.createElement(S.FormattedMessage,{id:"rhs_header.backToResultsTooltip",defaultMessage:"Back to Search Results"})):this.props.fromFlaggedPosts?a=T.default.createElement(y.Tooltip,{id:"backToResultsTooltip"},T.default.createElement(S.FormattedMessage,{id:"rhs_header.backToFlaggedTooltip",defaultMessage:"Back to Flagged Posts"})):this.props.isWebrtc&&(a=T.default.createElement(y.Tooltip,{id:"backToResultsTooltip"},T.default.createElement(S.FormattedMessage,{id:"rhs_header.backToCallTooltip",defaultMessage:"Back to Call"})));var n=T.default.createElement(y.Tooltip,{id:"expandSidebarTooltip"},T.default.createElement(S.FormattedMessage,{id:"rhs_header.expandSidebarTooltip",defaultMessage:"Expand Sidebar"})),r=T.default.createElement(y.Tooltip,{id:"shrinkSidebarTooltip"},T.default.createElement(S.FormattedMessage,{id:"rhs_header.shrinkSidebarTooltip",defaultMessage:"Shrink Sidebar"}));return(this.props.fromSearch||this.props.fromFlaggedPosts||this.props.isWebrtc)&&(e=T.default.createElement("a",{href:"#",onClick:this.handleBack,className:"sidebar--right__back"},T.default.createElement(y.OverlayTrigger,{delayShow:b.default.OVERLAY_TIME_DELAY,placement:"top",overlay:a},T.default.createElement("i",{className:"fa fa-angle-left"})))),T.default.createElement("div",{className:"sidebar--right__header"},T.default.createElement("span",{className:"sidebar--right__title"},e,T.default.createElement(S.FormattedMessage,{id:"rhs_header.details",defaultMessage:"Message Details"})),T.default.createElement("div",{className:"pull-right"},T.default.createElement("button",{type:"button",className:"sidebar--right__expand","aria-label":"Expand",onClick:this.toggleSize},T.default.createElement(y.OverlayTrigger,{delayShow:b.default.OVERLAY_TIME_DELAY,placement:"top",overlay:n},T.default.createElement("i",{className:"fa fa-expand"})),T.default.createElement(y.OverlayTrigger,{delayShow:b.default.OVERLAY_TIME_DELAY,placement:"top",overlay:r},T.default.createElement("i",{className:"fa fa-compress"}))),T.default.createElement("button",{type:"button",className:"sidebar--right__close","aria-label":"Close",onClick:this.handleClose},T.default.createElement(y.OverlayTrigger,{delayShow:b.default.OVERLAY_TIME_DELAY,placement:"top",overlay:t},T.default.createElement("i",{className:"fa fa-sign-out"})))))}}]),t}(T.default.Component);t.default=k,k.defaultProps={isMentionSearch:!1,fromSearch:""},k.propTypes={isMentionSearch:T.default.PropTypes.bool,isWebrtc:T.default.PropTypes.bool,fromSearch:T.default.PropTypes.string,fromFlaggedPosts:T.default.PropTypes.bool,toggleSize:T.default.PropTypes.func,shrink:T.default.PropTypes.func}},2031:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(338),g=r(p),v=a(599),b=r(v),y=a(572),E=r(y),_=a(571),w=r(_),S=a(166),C=r(S),T=a(575),M=r(T),k=a(1777),P=r(k),D=a(24),I=r(D),N=a(15),L=r(N),O=a(23),R=r(O),A=a(41),F=n(A),x=a(104),U=a(11),j=n(U),H=a(105),B=n(H),V=a(337),G=r(V),z=a(30),W=r(z),q=a(8),Y=r(q),K=a(246),J=r(K),X=a(27),Z=a(13),$=a(1),Q=r($),ee=a(37),te=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,s.default)(a)).call(this,e));return t.handlePermalink=t.handlePermalink.bind(t),t.flagPost=t.flagPost.bind(t),t.unflagPost=t.unflagPost.bind(t),t.pinPost=t.pinPost.bind(t),t.unpinPost=t.unpinPost.bind(t),t.reactEmojiClick=t.reactEmojiClick.bind(t),t.emojiPickerClick=t.emojiPickerClick.bind(t),t.canEdit=!1,t.canDelete=!1,t.editDisableAction=new J.default(t.handleEditDisable),t.state={currentTeamDisplayName:R.default.getCurrent().name,width:"",height:"",showRHSEmojiPicker:!1,testStateObj:!0},t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(){j.updateWindowDimensions(e)})}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("resize",function(){j.updateWindowDimensions(e)})}},{key:"handlePermalink",value:function(e){e.preventDefault(),F.showGetPostLinkModal(this.props.post)}},{key:"handleEditDisable",value:function(){this.canEdit=!1}},{key:"shouldComponentUpdate",value:function(e,t){return e.status!==this.props.status||(e.isBusy!==this.props.isBusy||(e.compactDisplay!==this.props.compactDisplay||(e.useMilitaryTime!==this.props.useMilitaryTime||(e.isFlagged!==this.props.isFlagged||(e.previewCollapsed!==this.props.previewCollapsed||(!j.areObjectsEqual(e.post,this.props.post)||(!j.areObjectsEqual(e.user,this.props.user)||(!j.areObjectsEqual(e.currentUser,this.props.currentUser)||this.state.showRHSEmojiPicker!==t.showRHSEmojiPicker))))))))}},{key:"flagPost",value:function(e){e.preventDefault(),(0,x.flagPost)(this.props.post.id)}},{key:"unflagPost",value:function(e){e.preventDefault(),(0,x.unflagPost)(this.props.post.id)}},{key:"timeTag",value:function(e,t){return Q.default.createElement("time",{className:"post__time",dateTime:j.getDateForUnixTicks(e.create_at).toISOString()},j.getDateForUnixTicks(e.create_at).toLocaleString("en",t))}},{key:"renderTimeTag",value:function(e,t){return j.isMobile()?this.timeTag(e,t):Q.default.createElement(ee.Link,{to:"/"+this.state.currentTeamDisplayName+"/pl/"+e.id,target:"_blank",className:"post__permalink"},this.timeTag(e,t))}},{key:"pinPost",value:function(e){e.preventDefault(),(0,x.pinPost)(this.props.post.channel_id,this.props.post.id)}},{key:"unpinPost",value:function(e){e.preventDefault(),(0,x.unpinPost)(this.props.post.channel_id,this.props.post.id)}},{key:"emojiPickerClick",value:function(){this.setState({showRHSEmojiPicker:!this.state.showRHSEmojiPicker})}},{key:"reactEmojiClick",value:function(e){var t=e.name||e.aliases[0];(0,x.addReaction)(this.props.post.channel_id,this.props.post.id,t),this.setState({showRHSEmojiPicker:!1})}},{key:"render",value:function(){var t=this,a=this.props.post,n=this.props.user,r=Y.default.MATTERMOST_ICON_SVG,i=n?n.last_picture_update:0,s=I.default.get(a.channel_id),o=Y.default.FLAG_ICON_SVG;this.canDelete=B.canDeletePost(a),this.canEdit=B.canEditPost(a,this.editDisableAction);var l=j.isPostEphemeral(a),d=a.state===Y.default.POST_FAILED||a.state===Y.default.POST_LOADING,u=B.isSystemMessage(a),c="Post";a.root_id.length>0&&(c="Comment");var f="";L.default.getCurrentId()===a.user_id&&(f="current--user");var m="";u&&(m="post--system");var h;s&&(h="D"===s.type?Q.default.createElement(Z.FormattedMessage,{id:"rhs_root.direct",defaultMessage:"Direct Message"}):s.display_name);var p=void 0,v=void 0;l||d||u||!j.isFeatureEnabled(Y.default.PRE_RELEASE_FEATURES.EMOJI_PICKER_PREVIEW)||(p=Q.default.createElement("span",null,Q.default.createElement("a",{href:"#",className:"reacticon__container reaction",onClick:this.emojiPickerClick,ref:"rhs_root_reacticon"},Q.default.createElement("i",{className:"fa fa-smile-o"}))),v=Q.default.createElement(X.Overlay,{id:"rhs_react_overlay",show:this.state.showRHSEmojiPicker,placement:"bottom",rootClose:!0,container:this,onHide:function(){return t.setState({showRHSEmojiPicker:!1})},target:function(){return W.default.findDOMNode(t.refs.rhs_root_reacticon)}},Q.default.createElement(G.default,{onEmojiClick:this.reactEmojiClick,pickerLocation:"react"})));var y=[];j.isMobile()&&(this.props.isFlagged?y.push(Q.default.createElement("li",{key:"mobileFlag",role:"presentation"},Q.default.createElement("a",{href:"#",onClick:this.unflagPost},Q.default.createElement(Z.FormattedMessage,{id:"rhs_root.mobile.unflag",defaultMessage:"Unflag"})))):y.push(Q.default.createElement("li",{key:"mobileFlag",role:"presentation"},Q.default.createElement("a",{href:"#",onClick:this.flagPost},Q.default.createElement(Z.FormattedMessage,{id:"rhs_root.mobile.flag",defaultMessage:"Flag"}))))),u||(y.push(Q.default.createElement("li",{key:"rhs-root-permalink",role:"presentation"},Q.default.createElement("a",{href:"#",onClick:this.handlePermalink},Q.default.createElement(Z.FormattedMessage,{id:"rhs_root.permalink",defaultMessage:"Permalink"})))),a.is_pinned?y.push(Q.default.createElement("li",{key:"rhs-root-unpin",role:"presentation"},Q.default.createElement("a",{href:"#",onClick:this.unpinPost},Q.default.createElement(Z.FormattedMessage,{id:"rhs_root.unpin",defaultMessage:"Un-pin from channel"})))):y.push(Q.default.createElement("li",{key:"rhs-root-pin",role:"presentation"},Q.default.createElement("a",{href:"#",onClick:this.pinPost},Q.default.createElement(Z.FormattedMessage,{id:"rhs_root.pin",defaultMessage:"Pin to channel"}))))),this.canDelete&&y.push(Q.default.createElement("li",{key:"rhs-root-delete",role:"presentation"},Q.default.createElement("a",{href:"#",role:"menuitem",onClick:function(){return F.showDeletePostModal(a,t.props.commentCount)}},Q.default.createElement(Z.FormattedMessage,{id:"rhs_root.del",defaultMessage:"Delete"})))),this.canEdit&&y.push(Q.default.createElement("li",{key:"rhs-root-edit",role:"presentation",className:this.canEdit?"":"hide"},Q.default.createElement("a",{href:"#",role:"menuitem","data-toggle":"modal","data-target":"#edit_post","data-refocusid":"#reply_textbox","data-title":c,"data-message":a.message,"data-postid":a.id,"data-channelid":a.channel_id},Q.default.createElement(Z.FormattedMessage,{id:"rhs_root.edit",defaultMessage:"Edit"}))));var _="";y.length>0&&(_=Q.default.createElement(P.default,{dropdownContents:y}));var S=null;a.file_ids&&a.file_ids.length>0&&(S=Q.default.createElement(w.default,{post:a,compactDisplay:this.props.compactDisplay}));var T=Q.default.createElement(g.default,{user:n,status:this.props.status,isBusy:this.props.isBusy}),k=void 0;a.props&&a.props.from_webhook?(T=a.props.override_username&&"true"===e.window.mm_config.EnablePostUsernameOverride?Q.default.createElement(g.default,{user:n,overwriteName:a.props.override_username,disablePopover:!0}):Q.default.createElement(g.default,{user:n,disablePopover:!0}),k=Q.default.createElement("li",{className:"col col__name bot-indicator"},"BOT")):u&&(T=Q.default.createElement(g.default,{user:{},overwriteName:Q.default.createElement(Z.FormattedMessage,{id:"post_info.system",defaultMessage:"System"}),overwriteImage:Y.default.SYSTEM_MESSAGE_PROFILE_IMAGE,disablePopover:!0}));var D=this.props.status;a.props&&"true"===a.props.from_webhook&&(D=null);var N=Q.default.createElement(C.default,{src:B.getProfilePicSrcForPost(a,i),status:D,width:"36",height:"36",user:this.props.user,isBusy:this.props.isBusy});a.props&&a.props.from_webhook&&(N=Q.default.createElement(C.default,{src:B.getProfilePicSrcForPost(a,i),width:"36",height:"36"})),u&&(N=Q.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:r}}));var O="",R="";this.props.compactDisplay&&(O="post--compact",N=a.props&&a.props.from_webhook?Q.default.createElement(C.default,{src:""}):Q.default.createElement(C.default,{src:"",status:D,user:this.props.user,isBusy:this.props.isBusy})),B.isEdited(this.props.post)&&(R+=" post--edited");var A=Q.default.createElement("div",{className:"post__img"},N),x=void 0,U=void 0,H="",V=Q.default.createElement(X.Tooltip,{id:"flagTooltip"},Q.default.createElement(Z.FormattedMessage,{id:"flag_post.flag",defaultMessage:"Flag for follow up"}));this.props.isFlagged?(H="visible",x=Q.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:o}}),U=this.unflagPost,V=Q.default.createElement(X.Tooltip,{id:"flagTooltip"},Q.default.createElement(Z.FormattedMessage,{id:"flag_post.unflag",defaultMessage:"Unflag"}))):(x=Q.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:o}}),U=this.flagPost);var z=void 0;a.is_pinned&&(z=Q.default.createElement("span",{className:"post__pinned-badge"},Q.default.createElement(Z.FormattedMessage,{id:"post_info.pinned",defaultMessage:"Pinned"})));var q={hour:"2-digit",minute:"2-digit",hour12:!this.props.useMilitaryTime};return Q.default.createElement("div",{id:"thread--root",className:"post post--root post--thread "+f+" "+m+" "+O},Q.default.createElement("div",{className:"post-right-channel__name"},h),Q.default.createElement("div",{className:"post__content"},A,Q.default.createElement("div",null,Q.default.createElement("ul",{className:"post__header"},Q.default.createElement("li",{className:"col__name"},T),k,Q.default.createElement("li",{className:"col"},this.renderTimeTag(a,q),z,Q.default.createElement(X.OverlayTrigger,{key:"rootpostflagtooltipkey"+H,delayShow:Y.default.OVERLAY_TIME_DELAY,placement:"top",overlay:V},Q.default.createElement("a",{href:"#",className:"flag-icon__container "+H,onClick:U},x))),Q.default.createElement("li",{className:"col col__reply"},v,_,p)),Q.default.createElement("div",{className:"post__body"},Q.default.createElement("div",{className:R},Q.default.createElement(b.default,{post:a,message:Q.default.createElement(E.default,{post:a}),previewCollapsed:this.props.previewCollapsed})),S,Q.default.createElement(M.default,{post:a})))))}}]),a}(Q.default.Component);t.default=te,te.defaultProps={commentCount:0},te.propTypes={post:Q.default.PropTypes.object.isRequired,user:Q.default.PropTypes.object.isRequired,currentUser:Q.default.PropTypes.object.isRequired,commentCount:Q.default.PropTypes.number,compactDisplay:Q.default.PropTypes.bool,useMilitaryTime:Q.default.PropTypes.bool.isRequired,isFlagged:Q.default.PropTypes.bool,status:Q.default.PropTypes.string,previewCollapsed:Q.default.PropTypes.string,isBusy:Q.default.PropTypes.bool}}).call(t,a(17))},2032:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return Q.default.createElement("div",(0,S.default)({},e,{className:"scrollbar--view"}))}function s(e){return Q.default.createElement("div",(0,S.default)({},e,{className:"scrollbar--horizontal"}))}function o(e){return Q.default.createElement("div",(0,S.default)({},e,{className:"scrollbar--vertical"}))}Object.defineProperty(t,"__esModule",{value:!0});var l=a(31),d=r(l),u=a(71),c=r(u),f=a(6),m=r(f),h=a(2),p=r(h),g=a(5),v=r(g),b=a(4),y=r(b),E=a(3),_=r(E),w=a(9),S=r(w);t.renderView=i,t.renderThumbHorizontal=s,t.renderThumbVertical=o;var C=a(2002),T=r(C),M=a(2030),k=r(M),P=a(2031),D=r(P),I=a(2028),N=r(I),L=a(597),O=r(L),R=a(2023),A=r(R),F=a(140),x=r(F),U=a(15),j=r(U),H=a(42),B=r(H),V=a(334),G=r(V),z=a(11),W=n(z),q=a(246),Y=r(q),K=a(8),J=r(K),X=a(0),Z=r(X),$=a(1),Q=r($),ee=a(2178),te=r(ee),ae=J.default.Preferences,ne=function(e){function t(e){(0,p.default)(this,t);var a=(0,y.default)(this,(t.__proto__||(0,m.default)(t)).call(this,e));a.mounted=!1,a.onPostChange=a.onPostChange.bind(a),a.onUserChange=a.onUserChange.bind(a),a.forceUpdateInfo=a.forceUpdateInfo.bind(a),a.onPreferenceChange=a.onPreferenceChange.bind(a),a.onStatusChange=a.onStatusChange.bind(a),a.onBusy=a.onBusy.bind(a),a.handleResize=a.handleResize.bind(a),a.handleScroll=a.handleScroll.bind(a),a.handleScrollStop=a.handleScrollStop.bind(a),a.scrollStopAction=new Y.default(a.handleScrollStop);var n=a.getPosts();return n.windowWidth=W.windowWidth(),n.windowHeight=W.windowHeight(),n.profiles=JSON.parse((0,c.default)(j.default.getProfiles())),n.compactDisplay=B.default.get(ae.CATEGORY_DISPLAY_SETTINGS,ae.MESSAGE_DISPLAY,ae.MESSAGE_DISPLAY_DEFAULT)===ae.MESSAGE_DISPLAY_COMPACT,n.flaggedPosts=B.default.getCategory(J.default.Preferences.CATEGORY_FLAGGED_POST),n.statuses=(0,d.default)({},j.default.getStatuses()),n.previewsCollapsed=B.default.get(ae.CATEGORY_DISPLAY_SETTINGS,ae.COLLAPSE_DISPLAY,"false"),n.isBusy=G.default.isBusy(),a.state=(0,S.default)({},n,{isScrolling:!1,topRhsPostCreateAt:0}),a}return(0,_.default)(t,e),(0,v.default)(t,[{key:"componentDidMount",value:function(){x.default.addSelectedPostChangeListener(this.onPostChange),x.default.addChangeListener(this.onPostChange),B.default.addChangeListener(this.onPreferenceChange),j.default.addChangeListener(this.onUserChange),j.default.addStatusesChangeListener(this.onStatusChange),G.default.addBusyListener(this.onBusy),this.scrollToBottom(),window.addEventListener("resize",this.handleResize),this.mounted=!0}},{key:"componentWillUnmount",value:function(){x.default.removeSelectedPostChangeListener(this.onPostChange),x.default.removeChangeListener(this.onPostChange),B.default.removeChangeListener(this.onPreferenceChange),j.default.removeChangeListener(this.onUserChange),j.default.removeStatusesChangeListener(this.onStatusChange),G.default.removeBusyListener(this.onBusy),window.removeEventListener("resize",this.handleResize),this.mounted=!1}},{key:"componentDidUpdate",value:function(e,t){var a=t.postsArray||[],n=this.state.postsArray||[];if(!(a.length>=n.length)){n[n.length-1].user_id===j.default.getCurrentId()&&this.scrollToBottom()}}},{key:"shouldComponentUpdate",value:function(e,t){return!W.areObjectsEqual(t.statuses,this.state.statuses)||(!W.areObjectsEqual(t.postsArray,this.state.postsArray)||(!W.areObjectsEqual(t.selected,this.state.selected)||(t.compactDisplay!==this.state.compactDisplay||(e.useMilitaryTime!==this.props.useMilitaryTime||(t.previewsCollapsed!==this.state.previewsCollapsed||(!W.areObjectsEqual(t.flaggedPosts,this.state.flaggedPosts)||(!W.areObjectsEqual(t.profiles,this.state.profiles)||(!W.areObjectsEqual(e.currentUser,this.props.currentUser)||(t.isBusy!==this.state.isBusy||(t.isScrolling!==this.state.isScrolling||t.topRhsPostCreateAt!==this.state.topRhsPostCreateAt))))))))))}},{key:"forceUpdateInfo",value:function(){if(this.state.postList)for(var e in this.state.postList.posts)this.refs[e]&&this.refs[e].forceUpdate()}},{key:"handleResize",value:function(){this.setState({windowWidth:W.windowWidth(),windowHeight:W.windowHeight()})}},{key:"onPreferenceChange",value:function(e){var t="";e===ae.CATEGORY_DISPLAY_SETTINGS&&(t="_"+W.generateId()),this.setState({compactDisplay:B.default.get(ae.CATEGORY_DISPLAY_SETTINGS,ae.MESSAGE_DISPLAY,ae.MESSAGE_DISPLAY_DEFAULT)===ae.MESSAGE_DISPLAY_COMPACT,flaggedPosts:B.default.getCategory(J.default.Preferences.CATEGORY_FLAGGED_POST),previewsCollapsed:B.default.get(ae.CATEGORY_DISPLAY_SETTINGS,ae.COLLAPSE_DISPLAY,"false")+t}),this.forceUpdateInfo()}},{key:"onPostChange",value:function(){this.mounted&&this.setState(this.getPosts())}},{key:"onStatusChange",value:function(){this.setState({statuses:(0,d.default)({},j.default.getStatuses())})}},{key:"onBusy",value:function(e){this.setState({isBusy:e})}},{key:"getPosts",value:function(){var e=x.default.getSelectedPost(),t=x.default.getSelectedPostThread(),a=[];for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r.root_id===e.id&&a.push(r)}return a.sort(function(e,t){return e.state!==J.default.POST_LOADING&&e.state!==J.default.POST_FAILED||t.state===J.default.POST_LOADING||t.state===J.default.POST_FAILED?e.state===J.default.POST_LOADING||e.state===J.default.POST_FAILED||t.state!==J.default.POST_LOADING&&t.state!==J.default.POST_FAILED?e.state===J.default.POST_LOADING&&t.state===J.default.POST_FAILED?-1:e.state===J.default.POST_FAILED&&t.state===J.default.POST_LOADING?1:e.create_at<t.create_at?-1:e.create_at>t.create_at?1:0:-1:1}),{postsArray:a,selected:e}}},{key:"onUserChange",value:function(){var e=JSON.parse((0,c.default)(j.default.getProfiles()));this.setState({profiles:e})}},{key:"scrollToBottom",value:function(){(0,Z.default)(".post-right__scroll")[0]&&(0,Z.default)(".post-right__scroll").parent().scrollTop((0,Z.default)(".post-right__scroll")[0].scrollHeight)}},{key:"updateFloatingTimestamp",value:function(){if(W.isMobile()&&this.state.postsArray){for(var e=this.refs.rhspostlist.childNodes,t=this.refs.rhspostlist.getBoundingClientRect(),a=0,n=100,r=0;r<e.length;r++)if(e[r].offsetTop+t.top-n>0){a=this.state.postsArray[r].create_at;break}a!==this.state.topRhsPostCreateAt&&this.setState({topRhsPostCreateAt:a})}}},{key:"handleScroll",value:function(){this.updateFloatingTimestamp(),this.state.isScrolling||this.setState({isScrolling:!0}),this.scrollStopAction.fireAfter(J.default.SCROLL_DELAY)}},{key:"handleScrollStop",value:function(){this.setState({isScrolling:!1})}},{key:"render",value:function(){var e=this.state.postsArray,t=this.state.selected,a=this.state.profiles||{},n=W.getDateForUnixTicks(t.create_at),r=n;if(null==e||null==t)return Q.default.createElement("div",null);var l=void 0;l=j.default.getCurrentId()===t.user_id?this.props.currentUser:a[t.user_id];var d=!1;this.state.flaggedPosts&&(d="true"===this.state.flaggedPosts.get(t.id));var u="offline";this.state.statuses&&(u=this.state.statuses[t.user_id]||"offline");for(var c=[],f=0;f<e.length;f++){var m=e[f],h=void 0;h=j.default.getCurrentId()===m.user_id?j.default.getCurrentUser():a[m.user_id];var p=!1;this.state.flaggedPosts&&(p="true"===this.state.flaggedPosts.get(m.id));var g="offline";this.state.statuses&&h&&h.id&&(g=this.state.statuses[h.id]||"offline");var v=m.id?m.id:m.pending_post_id,b=W.getDateForUnixTicks(m.create_at);b.toDateString()!==r.toDateString()&&(r=b,c.push(Q.default.createElement(A.default,{date:b}))),c.push(Q.default.createElement("div",{key:v+"commentKey"},Q.default.createElement(N.default,{ref:m.id,post:m,user:h,currentUser:this.props.currentUser,compactDisplay:this.state.compactDisplay,useMilitaryTime:this.props.useMilitaryTime,isFlagged:p,status:g,isBusy:this.state.isBusy})))}return Q.default.createElement("div",{className:"sidebar-right__body"},Q.default.createElement(O.default,{isScrolling:this.state.isScrolling,isMobile:W.isMobile(),createAt:this.state.topRhsPostCreateAt,isRhsPost:!0}),Q.default.createElement(k.default,{fromFlaggedPosts:this.props.fromFlaggedPosts,fromSearch:this.props.fromSearch,isWebrtc:this.props.isWebrtc,isMentionSearch:this.props.isMentionSearch,toggleSize:this.props.toggleSize,shrink:this.props.shrink}),Q.default.createElement(te.default,{autoHide:!0,autoHideTimeout:500,autoHideDuration:500,renderThumbHorizontal:s,renderThumbVertical:o,renderView:i,onScroll:this.handleScroll},Q.default.createElement("div",{ref:"post-right__scroll",className:"post-right__scroll"},Q.default.createElement(A.default,{date:n.toDateString()}),Q.default.createElement(D.default,{ref:t.id,post:t,commentCount:e.length,user:l,currentUser:this.props.currentUser,compactDisplay:this.state.compactDisplay,useMilitaryTime:this.props.useMilitaryTime,isFlagged:d,status:u,previewCollapsed:this.state.previewsCollapsed,isBusy:this.state.isBusy}),Q.default.createElement("div",{ref:"rhspostlist",className:"post-right-comments-container"},c),Q.default.createElement("div",{className:"post-create__container"},Q.default.createElement(T.default,{channelId:t.channel_id,rootId:t.id,latestPostId:e.length>0?e[e.length-1].id:t.id})))))}}]),t}(Q.default.Component);t.default=ne,ne.defaultProps={fromSearch:"",isMentionSearch:!1},ne.propTypes={fromSearch:Q.default.PropTypes.string,fromFlaggedPosts:Q.default.PropTypes.bool,isWebrtc:Q.default.PropTypes.bool,isMentionSearch:Q.default.PropTypes.bool,currentUser:Q.default.PropTypes.object.isRequired,useMilitaryTime:Q.default.PropTypes.bool.isRequired,toggleSize:Q.default.PropTypes.func,shrink:Q.default.PropTypes.func}},2033:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function i(){var e=JSON.parse((0,S.default)(N.default.getSearchResults())),t=new _.default;if(e&&e.order){var a=e.order.map(function(t){return e.posts[t].channel_id}),n=!0,r=!1,i=void 0;try{for(var s,o=(0,y.default)(a);!(n=(s=o.next()).done);n=!0){var l=s.value;t.has(l)||t.set(l,D.default.get(l))}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}}return{results:e,channels:t,searchTerm:N.default.getSearchTerm(),flaggedPosts:A.default.getCategory(B.default.Preferences.CATEGORY_FLAGGED_POST)}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(31),o=r(s),l=a(6),d=r(l),u=a(2),c=r(u),f=a(5),m=r(f),h=a(4),p=r(h),g=a(3),v=r(g),b=a(36),y=r(b),E=a(72),_=r(E),w=a(71),S=r(w),C=a(2034),T=r(C),M=a(2035),k=r(M),P=a(24),D=r(P),I=a(244),N=r(I),L=a(15),O=r(L),R=a(42),A=r(R),F=a(334),x=r(F),U=a(11),j=n(U),H=a(8),B=r(H),V=a(0),G=r(V),z=a(1),W=r(z),q=a(13),Y=B.default.Preferences,K=function(e){function t(e){(0,c.default)(this,t);var a=(0,p.default)(this,(t.__proto__||(0,d.default)(t)).call(this,e));a.mounted=!1,a.onChange=a.onChange.bind(a),a.onUserChange=a.onUserChange.bind(a),a.onPreferenceChange=a.onPreferenceChange.bind(a),a.onBusy=a.onBusy.bind(a),a.resize=a.resize.bind(a),a.onPreferenceChange=a.onPreferenceChange.bind(a),a.onStatusChange=a.onStatusChange.bind(a),a.handleResize=a.handleResize.bind(a);var n=i();return n.windowWidth=j.windowWidth(),n.windowHeight=j.windowHeight(),n.profiles=JSON.parse((0,S.default)(O.default.getProfiles())),n.compactDisplay=A.default.get(Y.CATEGORY_DISPLAY_SETTINGS,Y.MESSAGE_DISPLAY,Y.MESSAGE_DISPLAY_DEFAULT)===Y.MESSAGE_DISPLAY_COMPACT,n.isBusy=x.default.isBusy(),n.statuses=(0,o.default)({},O.default.getStatuses()),a.state=n,a}return(0,v.default)(t,e),(0,m.default)(t,[{key:"componentDidMount",value:function(){this.mounted=!0,N.default.addSearchChangeListener(this.onChange),D.default.addChangeListener(this.onChange),A.default.addChangeListener(this.onPreferenceChange),O.default.addChangeListener(this.onUserChange),O.default.addStatusesChangeListener(this.onStatusChange),A.default.addChangeListener(this.onPreferenceChange),x.default.addBusyListener(this.onBusy),this.resize(),window.addEventListener("resize",this.handleResize),j.isMobile()||(0,G.default)(".sidebar--right .search-items-container").perfectScrollbar()}},{key:"shouldComponentUpdate",value:function(e,t){return!j.areObjectsEqual(t.statuses,this.state.statuses)||(!j.areObjectsEqual(this.props,e)||(!j.areObjectsEqual(this.state,t)||(t.compactDisplay!==this.state.compactDisplay||t.isBusy!==this.state.isBusy)))}},{key:"componentWillUnmount",value:function(){this.mounted=!1,N.default.removeSearchChangeListener(this.onChange),D.default.removeChangeListener(this.onChange),A.default.removeChangeListener(this.onPreferenceChange),O.default.removeChangeListener(this.onUserChange),O.default.removeStatusesChangeListener(this.onStatusChange),A.default.removeChangeListener(this.onPreferenceChange),x.default.removeBusyListener(this.onBusy),window.removeEventListener("resize",this.handleResize)}},{key:"componentDidUpdate",value:function(e,t){this.state.searchTerm!==t.searchTerm&&this.resize()}},{key:"handleResize",value:function(){this.setState({windowWidth:j.windowWidth(),windowHeight:j.windowHeight()})}},{key:"onPreferenceChange",value:function(){this.setState({compactDisplay:A.default.get(Y.CATEGORY_DISPLAY_SETTINGS,Y.MESSAGE_DISPLAY,Y.MESSAGE_DISPLAY_DEFAULT)===Y.MESSAGE_DISPLAY_COMPACT,flaggedPosts:A.default.getCategory(B.default.Preferences.CATEGORY_FLAGGED_POST)})}},{key:"onChange",value:function(){this.mounted&&this.setState(i())}},{key:"onUserChange",value:function(){this.setState({profiles:JSON.parse((0,S.default)(O.default.getProfiles()))})}},{key:"onBusy",value:function(e){this.setState({isBusy:e})}},{key:"onStatusChange",value:function(){this.setState({statuses:(0,o.default)({},O.default.getStatuses())})}},{key:"resize",value:function(){(0,G.default)("#search-items-container").scrollTop(0)}},{key:"render",value:function(){var e=this.state.results,t=!e||!e.order||!e.order.length,a=this.state.searchTerm,n=this.state.profiles||{},r=B.default.FLAG_ICON_SVG,i=null;return i=this.props.isFlaggedPosts&&t?W.default.createElement("div",{className:"sidebar--right__subheader"},W.default.createElement("ul",null,W.default.createElement("li",null,W.default.createElement(q.FormattedHTMLMessage,{id:"search_results.usageFlag1",defaultMessage:"You haven't flagged any messages yet."})),W.default.createElement("li",null,W.default.createElement(q.FormattedHTMLMessage,{id:"search_results.usageFlag2",defaultMessage:"You can add a flag to messages and comments by clicking the "}),W.default.createElement("span",{className:"usage__icon",dangerouslySetInnerHTML:{__html:r}}),W.default.createElement(q.FormattedHTMLMessage,{id:"search_results.usageFlag3",defaultMessage:" icon next to the timestamp."})),W.default.createElement("li",null,W.default.createElement(q.FormattedHTMLMessage,{id:"search_results.usageFlag4",defaultMessage:"Flags are a way to mark messages for follow up. Your flags are personal, and cannot be seen by other users."})))):this.props.isPinnedPosts&&t?W.default.createElement("div",{className:"sidebar--right__subheader"},W.default.createElement("ul",null,W.default.createElement("li",null,W.default.createElement(q.FormattedHTMLMessage,{id:"search_results.usagePin1",defaultMessage:"There are no pinned messages yet."})),W.default.createElement("li",null,W.default.createElement(q.FormattedHTMLMessage,{id:"search_results.usagePin2",defaultMessage:"All members of this channel can pin important or useful messages."})),W.default.createElement("li",null,W.default.createElement(q.FormattedHTMLMessage,{id:"search_results.usagePin3",defaultMessage:"Pinned messages are visible to all channel members."})),W.default.createElement("li",null,W.default.createElement(q.FormattedHTMLMessage,{id:"search_results.usagePin4",defaultMessage:'To pin a message: Go to the message that you want to pin and click [...] > "Pin to channel".'})))):!a&&t?W.default.createElement("div",{className:"sidebar--right__subheader"},W.default.createElement(q.FormattedHTMLMessage,{id:"search_results.usage",defaultMessage:'<ul><li>Use <b>"quotation marks"</b> to search for phrases</li><li>Use <b>from:</b> to find posts from specific users and <b>in:</b> to find posts in specific channels</li></ul>'})):t?W.default.createElement("div",{className:"sidebar--right__subheader"},W.default.createElement("h4",null,W.default.createElement(q.FormattedMessage,{id:"search_results.noResults",defaultMessage:"No results found. Try again?"})),W.default.createElement(q.FormattedHTMLMessage,{id:"search_results.because",defaultMessage:'<ul> <li>If you\'re searching a partial phrase (ex. searching "rea", looking for "reach" or "reaction"), append a * to your search term.</li> <li>Two letter searches and common words like "this", "a" and "is" won\'t appear in search results, due to the excessive results returned.</li> </ul>'})):e.order.map(function(t){var r=e.posts[t],i=void 0;i=O.default.getCurrentId()===r.user_id?O.default.getCurrentUser():n[r.user_id];var s="offline";this.state.statuses&&(s=this.state.statuses[r.user_id]||"offline");var o=!1;return this.state.flaggedPosts&&(o="true"===this.state.flaggedPosts.get(r.id)),W.default.createElement(k.default,{key:r.id,channel:this.state.channels.get(r.channel_id),compactDisplay:this.state.compactDisplay,post:r,user:i,term:a,isMentionSearch:this.props.isMentionSearch,isFlaggedSearch:this.props.isFlaggedPosts,useMilitaryTime:this.props.useMilitaryTime,shrink:this.props.shrink,isFlagged:o,isBusy:this.state.isBusy,status:s})},this),W.default.createElement("div",{className:"sidebar-right__body"},W.default.createElement(T.default,{isMentionSearch:this.props.isMentionSearch,toggleSize:this.props.toggleSize,shrink:this.props.shrink,isFlaggedPosts:this.props.isFlaggedPosts,isPinnedPosts:this.props.isPinnedPosts,channelDisplayName:this.props.channelDisplayName}),W.default.createElement("div",{id:"search-items-container",className:"search-items-container"},i))}}]),t}(W.default.Component);t.default=K,K.propTypes={isMentionSearch:W.default.PropTypes.bool,useMilitaryTime:W.default.PropTypes.bool.isRequired,toggleSize:W.default.PropTypes.func,shrink:W.default.PropTypes.func,isFlaggedPosts:W.default.PropTypes.bool,isPinnedPosts:W.default.PropTypes.bool,channelDisplayName:W.default.PropTypes.string.isRequired}},2034:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(8),g=r(p),v=a(27),b=a(41),y=n(b),E=a(13),_=a(1),w=r(_),S=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.handleClose=a.handleClose.bind(a),a.toggleSize=a.toggleSize.bind(a),a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"handleClose",value:function(e){e.preventDefault(),y.toggleSideBarAction(!1),this.props.shrink()}},{key:"toggleSize",value:function(e){e.preventDefault(),this.props.toggleSize()}},{key:"render",value:function(){var e=w.default.createElement(E.FormattedMessage,{id:"search_header.results",defaultMessage:"Search Results"}),t=w.default.createElement(v.Tooltip,{id:"closeSidebarTooltip"},w.default.createElement(E.FormattedMessage,{id:"rhs_header.closeSidebarTooltip",defaultMessage:"Close Sidebar"})),a=w.default.createElement(v.Tooltip,{id:"expandSidebarTooltip"},w.default.createElement(E.FormattedMessage,{id:"rhs_header.expandSidebarTooltip",defaultMessage:"Expand Sidebar"})),n=w.default.createElement(v.Tooltip,{id:"shrinkSidebarTooltip"},w.default.createElement(E.FormattedMessage,{id:"rhs_header.shrinkSidebarTooltip",defaultMessage:"Shrink Sidebar"}));return this.props.isMentionSearch?e=w.default.createElement(E.FormattedMessage,{id:"search_header.title2",defaultMessage:"Recent Mentions"}):this.props.isFlaggedPosts?e=w.default.createElement(E.FormattedMessage,{id:"search_header.title3",defaultMessage:"Flagged Posts"}):this.props.isPinnedPosts&&(e=w.default.createElement(E.FormattedMessage,{id:"search_header.title4",defaultMessage:"Pinned posts in {channelDisplayName}",values:{channelDisplayName:this.props.channelDisplayName}})),w.default.createElement("div",{className:"sidebar--right__header"},w.default.createElement("span",{className:"sidebar--right__title"},e),w.default.createElement("div",{className:"pull-right"},w.default.createElement("button",{type:"button",className:"sidebar--right__expand","aria-label":"Expand",onClick:this.toggleSize},w.default.createElement(v.OverlayTrigger,{delayShow:g.default.OVERLAY_TIME_DELAY,placement:"top",overlay:a},w.default.createElement("i",{className:"fa fa-expand"})),w.default.createElement(v.OverlayTrigger,{delayShow:g.default.OVERLAY_TIME_DELAY,placement:"top",overlay:n},w.default.createElement("i",{className:"fa fa-compress"}))),w.default.createElement("button",{type:"button",className:"sidebar--right__close","aria-label":"Close",title:"Close",onClick:this.handleClose},w.default.createElement(v.OverlayTrigger,{delayShow:g.default.OVERLAY_TIME_DELAY,placement:"top",overlay:t},w.default.createElement("i",{className:"fa fa-sign-out"})))))}}]),t}(w.default.Component);t.default=S,S.propTypes={isMentionSearch:w.default.PropTypes.bool,toggleSize:w.default.PropTypes.func,shrink:w.default.PropTypes.func,isFlaggedPosts:w.default.PropTypes.bool,isPinnedPosts:w.default.PropTypes.bool,channelDisplayName:w.default.PropTypes.string.isRequired}},2035:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(0),g=r(p),v=a(572),b=r(v),y=a(338),E=r(y),_=a(571),w=r(_),S=a(166),C=r(S),T=a(23),M=r(T),k=a(15),P=r(k),D=a(16),I=r(D),N=a(41),L=n(N),O=a(104),R=a(11),A=n(R),F=a(105),x=n(F),U=a(8),j=r(U),H=a(27),B=a(1),V=r(B),G=a(13),z=a(37),W=j.default.ActionTypes,q=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,s.default)(a)).call(this,e));return t.handleFocusRHSClick=t.handleFocusRHSClick.bind(t),t.shrinkSidebar=t.shrinkSidebar.bind(t),t.unflagPost=t.unflagPost.bind(t),t.flagPost=t.flagPost.bind(t),t.state={currentTeamDisplayName:M.default.getCurrent().name,width:"",height:""},t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(){A.updateWindowDimensions(e)})}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("resize",function(){A.updateWindowDimensions(e)})}},{key:"hideSidebar",value:function(){(0,g.default)(".sidebar--right").removeClass("move--left")}},{key:"shrinkSidebar",value:function(){var e=this;setTimeout(function(){e.props.shrink()})}},{key:"handleFocusRHSClick",value:function(e){e.preventDefault(),L.emitPostFocusRightHandSideFromSearch(this.props.post,this.props.isMentionSearch)}},{key:"flagPost",value:function(e){e.preventDefault(),(0,O.flagPost)(this.props.post.id)}},{key:"unflagPost",value:function(e){e.preventDefault(),(0,O.unflagPost)(this.props.post.id)}},{key:"timeTag",value:function(e){return V.default.createElement("time",{className:"search-item-time",dateTime:A.getDateForUnixTicks(e.create_at).toISOString()},V.default.createElement(G.FormattedDate,{value:e.create_at,hour12:!this.props.useMilitaryTime,hour:"2-digit",minute:"2-digit"}))}},{key:"renderTimeTag",value:function(e){return A.isMobile()?this.timeTag(e):V.default.createElement(z.Link,{to:"/"+this.state.currentTeamDisplayName+"/pl/"+e.id,target:"_blank",className:"post__permalink"},this.timeTag(e))}},{key:"render",value:function(){var t=this,a=null,n=this.props.channel,r=P.default.getCurrentUser().last_picture_update,i=this.props.user||{},s=this.props.post,o=j.default.FLAG_ICON_SVG;n&&(a=n.display_name,"D"===n.type&&(a=V.default.createElement(G.FormattedMessage,{id:"search_item.direct",defaultMessage:"Direct Message (with {username})",values:{username:A.displayUsernameForUser(A.getDirectTeammate(n.id))}})));var l=void 0,d=!1;s.props&&s.props.from_webhook&&s.props.override_username&&"true"===e.window.mm_config.EnablePostUsernameOverride&&(l=s.props.override_username,d=!0);var u=void 0;s.props&&s.props.from_webhook&&(u=V.default.createElement("li",{className:"bot-indicator"},j.default.BOT_NAME));var c=V.default.createElement(C.default,{src:x.getProfilePicSrcForPost(s,r),user:this.props.user,status:this.props.status,isBusy:this.props.isBusy}),f="",m=V.default.createElement("div",{className:"post__img"},c);this.props.compactDisplay&&(f="post--compact");var h=null;s.file_ids&&s.file_ids.length>0&&(h=V.default.createElement(w.default,{post:s,compactDisplay:this.props.compactDisplay}));var p=void 0,g=void 0,v=void 0;if(s.state===j.default.POST_DELETED)p=V.default.createElement("p",null,V.default.createElement(G.FormattedMessage,{id:"post_body.deleted",defaultMessage:"(message deleted)"}));else{var y=void 0,_=void 0,S="",T=V.default.createElement(H.Tooltip,{id:"flagTooltip"},V.default.createElement(G.FormattedMessage,{id:"flag_post.flag",defaultMessage:"Flag for follow up"}));this.props.isFlagged?(S="visible",T=V.default.createElement(H.Tooltip,{id:"flagTooltip"},V.default.createElement(G.FormattedMessage,{id:"flag_post.unflag",defaultMessage:"Unflag"})),_=this.unflagPost,y=V.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:o}})):(y=V.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:o}}),_=this.flagPost),g=V.default.createElement(H.OverlayTrigger,{delayShow:j.default.OVERLAY_TIME_DELAY,placement:"top",overlay:T},V.default.createElement("a",{href:"#",className:"flag-icon__container "+S,onClick:_},y)),v=V.default.createElement("li",{className:"col__controls"},V.default.createElement("a",{href:"#",className:"comment-icon__container search-item__comment",onClick:this.handleFocusRHSClick},V.default.createElement("span",{className:"comment-icon",dangerouslySetInnerHTML:{__html:j.default.REPLY_ICON}})),V.default.createElement("a",{onClick:function(){A.isMobile()&&(I.default.handleServerAction({type:W.RECEIVED_SEARCH,results:null}),I.default.handleServerAction({type:W.RECEIVED_SEARCH_TERM,term:null,do_search:!1,is_mention_search:!1}),I.default.handleServerAction({type:W.RECEIVED_POST_SELECTED,postId:null}),t.hideSidebar()),t.shrinkSidebar(),z.browserHistory.push(M.default.getCurrentTeamRelativeUrl()+"/pl/"+s.id)},className:"search-item__jump"},V.default.createElement(G.FormattedMessage,{id:"search_item.jump",defaultMessage:"Jump"}))),p=V.default.createElement(b.default,{post:s,options:{searchTerm:this.props.term,mentionHighlight:this.props.isMentionSearch}})}var k=void 0;return s.is_pinned&&(k=V.default.createElement("span",{className:"post__pinned-badge"},V.default.createElement(G.FormattedMessage,{id:"post_info.pinned",defaultMessage:"Pinned"}))),V.default.createElement("div",{className:"search-item__container"},V.default.createElement("div",{className:"date-separator"},V.default.createElement("hr",{className:"separator__hr"}),V.default.createElement("div",{className:"separator__text"},V.default.createElement(G.FormattedDate,{value:s.create_at,day:"numeric",month:"long",year:"numeric"}))),V.default.createElement("div",{className:"post post--thread "+f},V.default.createElement("div",{className:"search-channel__name"},a),V.default.createElement("div",{className:"post__content"},m,V.default.createElement("div",null,V.default.createElement("ul",{className:"post__header"},V.default.createElement("li",{className:"col col__name"},V.default.createElement("strong",null,V.default.createElement(E.default,{user:i,overwriteName:l,disablePopover:d,status:this.props.status,isBusy:this.props.isBusy}))),u,V.default.createElement("li",{className:"col"},this.renderTimeTag(s),k,g),v),V.default.createElement("div",{className:"search-item-snippet post__body"},p,h)))))}}]),a}(V.default.Component);t.default=q,q.propTypes={post:V.default.PropTypes.object,user:V.default.PropTypes.object,channel:V.default.PropTypes.object,compactDisplay:V.default.PropTypes.bool,isMentionSearch:V.default.PropTypes.bool,isFlaggedSearch:V.default.PropTypes.bool,term:V.default.PropTypes.string,useMilitaryTime:V.default.PropTypes.bool.isRequired,shrink:V.default.PropTypes.func,isFlagged:V.default.PropTypes.bool,isBusy:V.default.PropTypes.bool,status:V.default.PropTypes.string}}).call(t,a(17))},2038:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),i=n(r),s=a(2),o=n(s),l=a(5),d=n(l),u=a(4),c=n(u),f=a(3),m=n(f),h=a(0),p=n(h),g=a(30),v=n(g),b=a(13),y=a(1),E=n(y),_=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.doFileSelect=a.doFileSelect.bind(a),a.doSubmit=a.doSubmit.bind(a),a.state={clientError:a.props.clientError,serverError:a.props.serverError,filename:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentWillReceiveProps",value:function(){this.setState({clientError:this.props.clientError,serverError:this.props.serverError})}},{key:"doFileSelect",value:function(e){e.preventDefault();var t=(0,p.default)(e.target).val();"fakepath"===t.substring(3,11)&&(t=t.substring(12)),this.setState({clientError:"",serverError:"",filename:t})}},{key:"doSubmit",value:function(e){e.preventDefault();var t=v.default.findDOMNode(this.refs.uploadinput);t.files&&t.files[0]?this.props.submit(t.files[0]):this.setState({clientError:!0})}},{key:"render",value:function(){var e=null;this.state.clientError&&(e=E.default.createElement("div",{className:"file-status"},E.default.createElement(b.FormattedMessage,{id:"setting_upload.noFile",defaultMessage:"No file selected."})));var t=null;this.state.serverError&&(t=E.default.createElement("div",{className:"file-status"},this.state.serverError));var a=null,n="btn btn-sm btn-primary disabled";return this.state.filename&&(a=E.default.createElement("div",{className:"file-status file-name"},this.state.filename),n="btn btn-sm btn-primary"),E.default.createElement("ul",{className:"section-max"},E.default.createElement("li",{className:"col-sm-12 section-title"},this.props.title),E.default.createElement("li",{className:"col-sm-offset-3 col-sm-9"},this.props.helpText),E.default.createElement("li",{className:"col-sm-offset-3 col-sm-9"},E.default.createElement("ul",{className:"setting-list"},E.default.createElement("li",{className:"setting-list-item"},E.default.createElement("span",{className:"btn btn-sm btn-primary btn-file sel-btn"},E.default.createElement(b.FormattedMessage,{id:"setting_upload.select",defaultMessage:"Select file"}),E.default.createElement("input",{ref:"uploadinput",accept:this.props.fileTypesAccepted,type:"file",onChange:this.doFileSelect})),E.default.createElement("a",{className:n,onClick:this.doSubmit},E.default.createElement(b.FormattedMessage,{id:"setting_upload.import",defaultMessage:"Import"})),a,t,e))))}}]),t}(E.default.Component);t.default=_,_.propTypes={title:E.default.PropTypes.string.isRequired,submit:E.default.PropTypes.func.isRequired,fileTypesAccepted:E.default.PropTypes.string.isRequired,clientError:E.default.PropTypes.string,serverError:E.default.PropTypes.string,helpText:E.default.PropTypes.object}},2042:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(0),g=r(p),v=a(2033),b=r(v),y=a(2032),E=r(y),_=a(576),w=r(_),S=a(1674),C=r(S),T=a(244),M=r(T),k=a(140),P=r(k),D=a(15),I=r(D),N=a(42),L=r(N),O=a(334),R=r(O),A=a(104),F=a(165),x=a(11),U=n(x),j=a(8),H=r(j),B=a(1),V=r(B),G=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.plScrolledToBottom=!0,a.onPreferenceChange=a.onPreferenceChange.bind(a),a.onSelectedChange=a.onSelectedChange.bind(a),a.onPostPinnedChange=a.onPostPinnedChange.bind(a),a.onSearchChange=a.onSearchChange.bind(a),a.onUserChange=a.onUserChange.bind(a),a.onShowSearch=a.onShowSearch.bind(a),a.onShrink=a.onShrink.bind(a),a.toggleSize=a.toggleSize.bind(a),a.doStrangeThings=a.doStrangeThings.bind(a),a.state={searchVisible:null!==M.default.getSearchResults(),isMentionSearch:M.default.getIsMentionSearch(),isFlaggedPosts:M.default.getIsFlaggedPosts(),isPinnedPosts:M.default.getIsPinnedPosts(),postRightVisible:Boolean(P.default.getSelectedPost()),expanded:!1,fromSearch:!1,currentUser:I.default.getCurrentUser(),useMilitaryTime:L.default.getBool(H.default.Preferences.CATEGORY_DISPLAY_SETTINGS,H.default.Preferences.USE_MILITARY_TIME,!1)},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){M.default.addSearchChangeListener(this.onSearchChange),P.default.addSelectedPostChangeListener(this.onSelectedChange),P.default.addPostPinnedChangeListener(this.onPostPinnedChange),M.default.addShowSearchListener(this.onShowSearch),I.default.addChangeListener(this.onUserChange),L.default.addChangeListener(this.onPreferenceChange),this.doStrangeThings()}},{key:"componentWillUnmount",value:function(){M.default.removeSearchChangeListener(this.onSearchChange),P.default.removeSelectedPostChangeListener(this.onSelectedChange),P.default.removePostPinnedChangeListener(this.onPostPinnedChange),M.default.removeShowSearchListener(this.onShowSearch),I.default.removeChangeListener(this.onUserChange),L.default.removeChangeListener(this.onPreferenceChange)}},{key:"shouldComponentUpdate",value:function(e,t){return!U.areObjectsEqual(t,this.state)}},{key:"componentWillUpdate",value:function(e,t){var a=this.state.searchVisible||this.state.postRightVisible,n=t.searchVisible||t.postRightVisible;!a&&n&&(0,F.trackEvent)("ui","ui_rhs_opened"),a!==n&&P.default.jumpPostsViewSidebarOpen(),!a&&n&&this.setState({expanded:!1})}},{key:"doStrangeThings",value:function(){return(0,g.default)(".app__body .inner-wrap").removeClass(".move--right"),(0,g.default)(".app__body .inner-wrap").addClass("move--left"),(0,g.default)(".app__body .sidebar--left").removeClass("move--right"),(0,g.default)(".multi-teams .team-sidebar").removeClass("move--right"),(0,g.default)(".app__body .sidebar--right").addClass("move--left"),this.state.searchVisible||this.state.postRightVisible?null:((0,g.default)(".app__body .inner-wrap").removeClass("move--left").removeClass("move--right"),(0,g.default)(".app__body .sidebar--right").removeClass("move--left"),V.default.createElement("div",null))}},{key:"componentDidUpdate",value:function(){var e=this.state.searchVisible||this.state.postRightVisible;R.default.emitRhsChanged(e),this.doStrangeThings()}},{key:"onPreferenceChange",value:function(){this.state.isFlaggedPosts&&(0,A.getFlaggedPosts)(),this.setState({useMilitaryTime:L.default.getBool(H.default.Preferences.CATEGORY_DISPLAY_SETTINGS,H.default.Preferences.USE_MILITARY_TIME,!1)})}},{key:"onSelectedChange",value:function(e,t){this.setState({postRightVisible:Boolean(P.default.getSelectedPost()),fromSearch:e,fromFlaggedPosts:t})}},{key:"onPostPinnedChange",value:function(){this.props.channel&&this.state.isPinnedPosts&&(0,A.getPinnedPosts)(this.props.channel.id)}},{key:"onShrink",value:function(){this.setState({expanded:!1})}},{key:"onSearchChange",value:function(){this.setState({searchVisible:null!==M.default.getSearchResults(),isMentionSearch:M.default.getIsMentionSearch(),isFlaggedPosts:M.default.getIsFlaggedPosts(),isPinnedPosts:M.default.getIsPinnedPosts()})}},{key:"onUserChange",value:function(){this.setState({currentUser:I.default.getCurrentUser()})}},{key:"onShowSearch",value:function(){this.state.searchVisible||this.setState({searchVisible:!0})}},{key:"toggleSize",value:function(){this.setState({expanded:!this.state.expanded})}},{key:"render",value:function(){var e=null,t="";this.state.expanded&&(t="sidebar--right--expanded");var a=I.default.getCurrentId(),n=null;a&&(n=V.default.createElement(w.default,{isFocus:this.state.searchVisible&&U.isMobile()}));var r=this.props.channel,i="";return r&&(i=r.type===H.default.DM_CHANNEL||r.type===H.default.GM_CHANNEL?U.localizeMessage("rhs_root.direct","Direct Message"):r.display_name),this.state.searchVisible?e=V.default.createElement("div",{className:"sidebar--right__content"},V.default.createElement("div",{className:"search-bar__container sidebar--right__search-header"},n),V.default.createElement(b.default,{isMentionSearch:this.state.isMentionSearch,isFlaggedPosts:this.state.isFlaggedPosts,isPinnedPosts:this.state.isPinnedPosts,useMilitaryTime:this.state.useMilitaryTime,toggleSize:this.toggleSize,shrink:this.onShrink,channelDisplayName:i})):this.state.postRightVisible&&(e=V.default.createElement("div",{className:"post-right__container"},V.default.createElement(C.default,{overlayType:"right"}),V.default.createElement("div",{className:"search-bar__container sidebar--right__search-header"},n),V.default.createElement(E.default,{fromFlaggedPosts:this.state.fromFlaggedPosts,fromSearch:this.state.fromSearch,isWebrtc:R.default.isBusy(),isMentionSearch:this.state.isMentionSearch,currentUser:this.state.currentUser,useMilitaryTime:this.state.useMilitaryTime,toggleSize:this.toggleSize,shrink:this.onShrink}))),e||(t=""),V.default.createElement("div",{className:"sidebar--right "+t,id:"sidebar-right"},V.default.createElement("div",{onClick:this.onShrink,className:"sidebar--right__bg"}),V.default.createElement("div",{className:"sidebar-right-container"},e))}}]),t}(V.default.Component);t.default=G,G.propTypes={channel:B.PropTypes.object}},2043:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(16),g=r(p),v=a(578),b=r(v),y=a(248),E=r(y),_=a(1678),w=r(_),S=a(1670),C=r(S),T=a(1671),M=r(T),k=a(15),P=r(k),D=a(23),I=r(D),N=a(244),L=r(N),O=a(42),R=r(O),A=a(334),F=r(A),x=a(41),U=n(x),j=a(104),H=a(59),B=n(H),V=a(11),G=n(V),z=a(8),W=a(13),q=a(37),Y=a(573),K=a(1),J=r(K),X=z.Constants.ActionTypes,Z=z.Constants.Preferences,$=z.Constants.TutorialSteps,Q=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,s.default)(a)).call(this,e));t.onChange=t.onChange.bind(t),t.handleClick=t.handleClick.bind(t),t.handleAboutModal=t.handleAboutModal.bind(t),t.showAddUsersToTeamModal=t.showAddUsersToTeamModal.bind(t),t.hideAddUsersToTeamModal=t.hideAddUsersToTeamModal.bind(t),t.searchMentions=t.searchMentions.bind(t),t.aboutModalDismissed=t.aboutModalDismissed.bind(t),t.getFlagged=t.getFlagged.bind(t);var n=t.getStateFromStores();return n.showUserSettingsModal=!1,n.showAboutModal=!1,n.showAddUsersToTeamModal=!1,t.state=n,t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"handleClick",value:function(e){F.default.isBusy()&&(F.default.emitChanged({action:z.WebrtcActionTypes.IN_PROGRESS}),e.preventDefault())}},{key:"handleAboutModal",value:function(){this.setState({showAboutModal:!0})}},{key:"aboutModalDismissed",value:function(){this.setState({showAboutModal:!1})}},{key:"showAddUsersToTeamModal",value:function(e){e.preventDefault(),this.setState({showAddUsersToTeamModal:!0,showDropdown:!1})}},{key:"hideAddUsersToTeamModal",value:function(){this.setState({showAddUsersToTeamModal:!1})}},{key:"getFlagged",value:function(e){e.preventDefault(),(0,j.getFlaggedPosts)(),this.hideSidebars()}},{key:"componentDidMount",value:function(){I.default.addChangeListener(this.onChange),R.default.addChangeListener(this.onChange)}},{key:"componentWillUnmount",value:function(){I.default.removeChangeListener(this.onChange),R.default.removeChangeListener(this.onChange)}},{key:"getStateFromStores",value:function(){var e=R.default.getInt(Z.TUTORIAL_STEP,P.default.getCurrentId(),999);return{currentUser:P.default.getCurrentUser(),teamMembers:I.default.getMyTeamMembers(),teamListings:I.default.getTeamListings(),showTutorialTip:e===$.MENU_POPOVER&&G.isMobile()}}},{key:"onChange",value:function(){this.setState(this.getStateFromStores())}},{key:"searchMentions",value:function(e){e.preventDefault();var t=this.state.currentUser;L.default.isMentionSearch?U.toggleSideBarAction(!1):(U.emitSearchMentionsEvent(t),this.hideSidebars())}},{key:"closeLeftSidebar",value:function(){G.isMobile()&&setTimeout(function(){document.querySelector(".app__body .inner-wrap").classList.remove("move--right"),document.querySelector(".app__body .sidebar--left").classList.remove("move--right")})}},{key:"openRightSidebar",value:function(){G.isMobile()&&setTimeout(function(){document.querySelector(".app__body .inner-wrap").classList.add("move--left-small"),document.querySelector(".app__body .sidebar--menu").classList.add("move--left")})}},{key:"hideSidebars",value:function(){G.isMobile()&&(g.default.handleServerAction({type:X.RECEIVED_SEARCH,results:null}),g.default.handleServerAction({type:X.RECEIVED_POST_SELECTED,postId:null}),document.querySelector(".app__body .inner-wrap").classList.remove("move--right","move--left","move--left-small"),document.querySelector(".app__body .sidebar--left").classList.remove("move--right"),document.querySelector(".app__body .sidebar--right").classList.remove("move--left"),document.querySelector(".app__body .sidebar--menu").classList.remove("move--left"))}},{key:"render",value:function(){var t=this,a=P.default.getCurrentUser(),n=void 0,r=void 0,i=void 0,s=void 0,o=void 0,l=void 0,d=void 0,u=!1,c=!1;if(null!=a){u=I.default.isTeamAdminForCurrentTeam()||P.default.isSystemAdminForCurrentUser(),c=P.default.isSystemAdminForCurrentUser(),r=J.default.createElement("li",null,J.default.createElement("a",{href:"#",onClick:U.showInviteMemberModal},J.default.createElement("i",{className:"icon fa fa-user-plus"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.inviteNew",defaultMessage:"Send Email Invite"}))),i=J.default.createElement("li",null,J.default.createElement("a",{id:"addUsersToTeam",href:"#",onClick:this.showAddUsersToTeamModal},J.default.createElement("i",{className:"icon fa fa-user-plus"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.addMemberToTeam",defaultMessage:"Add Members to Team"}))),"O"===this.props.teamType&&(n=J.default.createElement("li",null,J.default.createElement("a",{href:"#",onClick:U.showGetTeamInviteLinkModal},J.default.createElement("i",{className:"icon fa fa-link"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.teamLink",defaultMessage:"Get Team Invite Link"})))),"true"===e.window.mm_license.IsLicensed&&(e.window.mm_config.RestrictTeamInvite!==z.Constants.PERMISSIONS_SYSTEM_ADMIN||c?e.window.mm_config.RestrictTeamInvite!==z.Constants.PERMISSIONS_TEAM_ADMIN||u||(n=null,r=null,i=null):(n=null,r=null,i=null));var f=!1,m=this.state.teamMembers.reduce(function(e,t){return e[t.team_id]=!0,e},{});for(var h in this.state.teamListings)if(this.state.teamListings.hasOwnProperty(h)&&!m[h]){f=!0;break}f&&(d=J.default.createElement("li",{key:"joinTeam_li"},J.default.createElement(q.Link,{to:"/select_team"},J.default.createElement("i",{className:"icon fa fa-plus-square"}),J.default.createElement(W.FormattedMessage,{id:"navbar_dropdown.join",defaultMessage:"Join Another Team"}))))}o=J.default.createElement("li",null,J.default.createElement(E.default,{dialogType:b.default},J.default.createElement("i",{className:"icon fa fa-users"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.viewMembers",defaultMessage:"View Members"}))),u&&(s=J.default.createElement("li",null,J.default.createElement("a",{href:"#","data-toggle":"modal","data-target":"#team_settings"},J.default.createElement("i",{className:"icon fa fa-globe"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.teamSettings",defaultMessage:"Team Settings"}))),o=J.default.createElement("li",null,J.default.createElement(E.default,{dialogType:b.default,dialogProps:{isAdmin:u}},J.default.createElement("i",{className:"icon fa fa-users"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.manageMembers",defaultMessage:"Manage Members"})))),c&&!G.isMobile()&&(l=J.default.createElement("li",null,J.default.createElement(q.Link,{to:"/admin_console",onClick:this.handleClick},J.default.createElement("i",{className:"icon fa fa-wrench"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.console",defaultMessage:"System Console"}))));var p="";null!=e.window.mm_config.SiteName&&(p=e.window.mm_config.SiteName);var g=p;this.props.teamDisplayName&&(g=this.props.teamDisplayName);var v=null;e.window.mm_config.HelpLink&&(v=J.default.createElement("li",null,J.default.createElement(q.Link,{target:"_blank",rel:"noopener noreferrer",to:e.window.mm_config.HelpLink},J.default.createElement("i",{className:"icon fa fa-question"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.help",defaultMessage:"Help"}))));var y=null;e.window.mm_config.ReportAProblemLink&&(y=J.default.createElement("li",null,J.default.createElement(q.Link,{target:"_blank",rel:"noopener noreferrer",to:e.window.mm_config.ReportAProblemLink},J.default.createElement("i",{className:"icon fa fa-phone"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.report",defaultMessage:"Report a Problem"}))));var _=null;this.state.showTutorialTip&&(_=(0,Y.createMenuTip)(function(e){return e.preventDefault()},!0),this.closeLeftSidebar(),this.openRightSidebar());var S=null;e.window.mm_config.AppDownloadLink&&!B.isMobileApp()&&(S=J.default.createElement("li",null,J.default.createElement(q.Link,{target:"_blank",rel:"noopener noreferrer",to:e.window.mm_config.AppDownloadLink},J.default.createElement("i",{className:"icon fa fa-mobile"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.nativeApps",defaultMessage:"Download Apps"}))));var T=void 0;this.state.showAddUsersToTeamModal&&(T=J.default.createElement(M.default,{onModalDismissed:this.hideAddUsersToTeamModal}));var k=null;(s||o||d)&&(k=J.default.createElement("li",{className:"divider"}));var D=null;return l&&(D=J.default.createElement("li",{className:"divider"})),J.default.createElement("div",{className:"sidebar--menu",id:"sidebar-menu"},J.default.createElement("div",{className:"team__header theme"},J.default.createElement(q.Link,{className:"team__name",to:"/channels/town-square"},g)),J.default.createElement("div",{className:"nav-pills__container"},_,J.default.createElement("ul",{className:"nav nav-pills nav-stacked"},J.default.createElement("li",null,J.default.createElement("a",{href:"#",onClick:this.searchMentions},J.default.createElement("i",{className:"icon mentions"},"@"),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.recentMentions",defaultMessage:"Recent Mentions"}))),J.default.createElement("li",null,J.default.createElement("a",{href:"#",onClick:this.getFlagged},J.default.createElement("i",{className:"icon fa fa-flag"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.flagged",defaultMessage:"Flagged Posts"}))),J.default.createElement("li",{className:"divider"}),J.default.createElement("li",null,J.default.createElement("a",{href:"#",onClick:function(){return t.setState({showUserSettingsModal:!0})}},J.default.createElement("i",{className:"icon fa fa-cog"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.accountSettings",defaultMessage:"Account Settings"}))),J.default.createElement("li",{className:"divider"}),r,n,i,k,s,o,d,D,l,J.default.createElement("li",{className:"divider"}),v,y,S,J.default.createElement("li",null,J.default.createElement("a",{href:"#",onClick:this.handleAboutModal},J.default.createElement("i",{className:"icon fa fa-info"}),J.default.createElement(W.FormattedMessage,{id:"navbar_dropdown.about",defaultMessage:"About Mattermost"}))),J.default.createElement("li",{className:"divider"}),J.default.createElement("li",null,J.default.createElement("a",{href:"#",onClick:function(){return U.emitUserLoggedOutEvent()}},J.default.createElement("i",{className:"icon fa fa-sign-out"}),J.default.createElement(W.FormattedMessage,{id:"sidebar_right_menu.logout",defaultMessage:"Logout"}))))),J.default.createElement(w.default,{show:this.state.showUserSettingsModal,onModalDismissed:function(){return t.setState({showUserSettingsModal:!1})}}),J.default.createElement(C.default,{show:this.state.showAboutModal,onModalDismissed:this.aboutModalDismissed}),T)}}]),a}(J.default.Component);t.default=Q,Q.propTypes={teamType:J.default.PropTypes.string,teamDisplayName:J.default.PropTypes.string}}).call(t,a(17))},2044:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(31),s=r(i),o=a(43),l=r(o),d=a(36),u=r(d),c=a(6),f=r(c),m=a(2),h=r(m),p=a(5),g=r(p),v=a(4),b=r(v),y=a(3),E=r(y),_=a(143),w=r(_),S=a(187),C=r(S),T=a(24),M=r(T),k=a(15),P=r(k),D=a(46),I=a(28),N=r(I),L=a(16),O=r(L),R=a(8),A=a(11),F=n(A),x=a(81),U=a(1),j=r(U),H=function(e){function t(){return(0,h.default)(this,t),(0,b.default)(this,(t.__proto__||(0,f.default)(t)).apply(this,arguments))}return(0,E.default)(t,e),(0,g.default)(t,[{key:"render",value:function(){var e=this.props,t=e.item,a=e.isSelection,n="mentions__name";a&&(n+=" suggestion--selected");var r=t.display_name,i=null;return t.type===R.Constants.OPEN_CHANNEL?i=j.default.createElement("div",{className:"status"},j.default.createElement("i",{className:"fa fa-globe"})):t.type===R.Constants.PRIVATE_CHANNEL?i=j.default.createElement("div",{className:"status"},j.default.createElement("i",{className:"fa fa-lock"})):t.type===R.Constants.GM_CHANNEL?(r=(0,x.buildGroupChannelName)(t.id),i=j.default.createElement("div",{className:"status status--group"},P.default.getProfileListInChannel(t.id,!0).length)):i=j.default.createElement("div",{className:"pull-left"},j.default.createElement("img",{className:"mention__image",src:N.default.getUsersRoute()+"/"+t.id+"/image?time="+t.last_picture_update})),j.default.createElement("div",{onClick:this.handleClick,className:n},i,r)}}]),t}(w.default),B=function(e){function t(){return(0,h.default)(this,t),(0,b.default)(this,(t.__proto__||(0,f.default)(t)).apply(this,arguments))}return(0,E.default)(t,e),(0,g.default)(t,[{key:"handlePretextChanged",value:function(e,t){var a=this;if(t){this.startNewRequest(t);var n=M.default.getAll(),r=[];(0,D.autocompleteUsers)(t,function(i){if(!a.shouldCancelDispatch(t)){var o=P.default.getCurrentId(),d=!0,c=!1,f=void 0;try{for(var m,h=(0,u.default)((0,l.default)(n));!(d=(m=h.next()).done);d=!0){var p=m.value,g=n[p];if(-1!==g.display_name.toLowerCase().indexOf(t.toLowerCase())){var v=(0,s.default)({},g);v.type===R.Constants.GM_CHANNEL&&(v.name=(0,x.buildGroupChannelName)(v.id)),r.push(v)}}}catch(e){c=!0,f=e}finally{try{!d&&h.return&&h.return()}finally{if(c)throw f}}for(var b={},y=0;y<i.length;y++){var E=i[y],_="@"+E.username+" ";if(E.id!==o){(E.first_name||E.last_name)&&E.nickname?_+="- "+F.getFullName(E)+" ("+E.nickname+")":E.nickname?_+="- ("+E.nickname+")":(E.first_name||E.last_name)&&(_+="- "+F.getFullName(E));var w={display_name:_,name:E.username,id:E.id,update_at:E.update_at,type:R.Constants.DM_CHANNEL};r.push(w),b[E.id]=E}}var S=r.sort(x.sortChannelsByDisplayName).map(function(e){return e.name});O.default.handleServerAction({type:R.ActionTypes.SUGGESTION_RECEIVED_SUGGESTIONS,id:e,matchedPretext:t,terms:S,items:r,component:H}),O.default.handleServerAction({type:R.ActionTypes.RECEIVED_PROFILES,profiles:b})}})}}}]),t}(C.default);t.default=B},2045:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(0),g=r(p),v=a(91),b=r(v),y=a(82),E=r(y),_=a(11),w=n(_),S=a(8),C=r(S),T=a(13),M=a(333),k=a(1),P=r(k),D=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.updateSection=a.updateSection.bind(a),a.handleNameSubmit=a.handleNameSubmit.bind(a),a.handleInviteIdSubmit=a.handleInviteIdSubmit.bind(a),a.handleOpenInviteSubmit=a.handleOpenInviteSubmit.bind(a),a.handleDescriptionSubmit=a.handleDescriptionSubmit.bind(a),a.handleClose=a.handleClose.bind(a),a.onUpdateNameSection=a.onUpdateNameSection.bind(a),a.updateName=a.updateName.bind(a),a.updateDescription=a.updateDescription.bind(a),a.onUpdateDescriptionSection=a.onUpdateDescriptionSection.bind(a),a.onUpdateInviteIdSection=a.onUpdateInviteIdSection.bind(a),a.updateInviteId=a.updateInviteId.bind(a),a.onUpdateOpenInviteSection=a.onUpdateOpenInviteSection.bind(a),a.handleOpenInviteRadio=a.handleOpenInviteRadio.bind(a),a.handleGenerateInviteId=a.handleGenerateInviteId.bind(a),a.state=a.setupInitialState(e),a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"updateSection",value:function(e){(0,g.default)(".section-max").length&&(0,g.default)(".settings-modal .modal-body").scrollTop(0).perfectScrollbar("update"),this.setState(this.setupInitialState(this.props)),this.props.updateSection(e)}},{key:"setupInitialState",value:function(e){var t=e.team;return{name:t.display_name,invite_id:t.invite_id,allow_open_invite:t.allow_open_invite,description:t.description,serverError:"",clientError:""}}},{key:"componentWillReceiveProps",value:function(e){this.setState({name:e.team.display_name,description:e.team.description,invite_id:e.team.invite_id,allow_open_invite:e.team.allow_open_invite})}},{key:"handleGenerateInviteId",value:function(e){e.preventDefault();for(var t="",a=0;a<32;a++)t+=Math.floor(16*Math.random()).toString(16);this.setState({invite_id:t})}},{key:"handleOpenInviteRadio",value:function(e){this.setState({allow_open_invite:e})}},{key:"handleOpenInviteSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=this.props.team;n.allow_open_invite=this.state.allow_open_invite,(0,M.updateTeam)(n,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}},{key:"handleNameSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=!0;if(this.state.name.trim()?a.clientError="":(a.clientError=w.localizeMessage("general_tab.required","This field is required"),n=!1),this.setState(a),n){var r=this.props.team;r.display_name=this.state.name,(0,M.updateTeam)(r,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}}},{key:"handleInviteIdSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=!0;if(this.state.invite_id.trim()?a.clientError="":(a.clientError=w.localizeMessage("general_tab.required","This field is required"),n=!1),this.setState(a),n){var r=this.props.team;r.invite_id=this.state.invite_id,(0,M.updateTeam)(r,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}}},{key:"handleClose",value:function(){this.updateSection("")}},{key:"handleDescriptionSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=!0;if(this.state.description.trim()===this.props.team.description?(a.clientError=w.localizeMessage("general_tab.chooseDescription","Please choose a new description for your team"),n=!1):a.clientError="",this.setState(a),n){var r=this.props.team;r.description=this.state.description,(0,M.updateTeam)(r,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}}},{key:"componentDidMount",value:function(){(0,g.default)("#team_settings").on("hidden.bs.modal",this.handleClose)}},{key:"componentWillUnmount",value:function(){(0,g.default)("#team_settings").off("hidden.bs.modal",this.handleClose)}},{key:"onUpdateNameSection",value:function(e){e.preventDefault(),"name"===this.props.activeSection?this.updateSection(""):this.updateSection("name")}},{key:"onUpdateDescriptionSection",value:function(e){e.preventDefault(),"description"===this.props.activeSection?this.updateSection(""):this.updateSection("description")}},{key:"onUpdateInviteIdSection",value:function(e){e.preventDefault(),"invite_id"===this.props.activeSection?this.updateSection(""):this.updateSection("invite_id")}},{key:"onUpdateOpenInviteSection",value:function(e){e.preventDefault(),"open_invite"===this.props.activeSection?this.updateSection(""):this.updateSection("open_invite")}},{key:"updateName",value:function(e){this.setState({name:e.target.value})}},{key:"updateDescription",value:function(e){this.setState({description:e.target.value})}},{key:"updateInviteId",value:function(e){this.setState({invite_id:e.target.value})}},{key:"render",value:function(){var e=null,t=null;this.state.clientError&&(e=this.state.clientError),this.state.serverError&&(t=this.state.serverError);var a=void 0;if("open_invite"===this.props.activeSection){var n=[P.default.createElement("div",{key:"userOpenInviteOptions"},P.default.createElement("div",{className:"radio"},P.default.createElement("label",null,P.default.createElement("input",{id:"teamOpenInvite",name:"userOpenInviteOptions",type:"radio",defaultChecked:this.state.allow_open_invite,onChange:this.handleOpenInviteRadio.bind(this,!0)}),P.default.createElement(T.FormattedMessage,{id:"general_tab.yes",defaultMessage:"Yes"})),P.default.createElement("br",null)),P.default.createElement("div",{className:"radio"},P.default.createElement("label",null,P.default.createElement("input",{id:"teamOpenInviteNo",name:"userOpenInviteOptions",type:"radio",defaultChecked:!this.state.allow_open_invite,onChange:this.handleOpenInviteRadio.bind(this,!1)}),P.default.createElement(T.FormattedMessage,{id:"general_tab.no",defaultMessage:"No"})),P.default.createElement("br",null)),P.default.createElement("div",null,P.default.createElement("br",null),P.default.createElement(T.FormattedMessage,{id:"general_tab.openInviteDesc",defaultMessage:"When allowed, a link to this team will be included on the landing page allowing anyone with an account to join this team."})))];a=P.default.createElement(E.default,{title:w.localizeMessage("general_tab.openInviteTitle","Allow any user with an account on this server to join this team"),inputs:n,submit:this.handleOpenInviteSubmit,server_error:t,updateSection:this.onUpdateOpenInviteSection})}else{var r="";r=!0===this.state.allow_open_invite?w.localizeMessage("general_tab.yes","Yes"):w.localizeMessage("general_tab.no","No"),a=P.default.createElement(b.default,{title:w.localizeMessage("general_tab.openInviteTitle","Allow any user with an account on this server to join this team"),describe:r,updateSection:this.onUpdateOpenInviteSection})}var i=void 0;if("invite_id"===this.props.activeSection){var s=[];s.push(P.default.createElement("div",{key:"teamInviteSetting"},P.default.createElement("div",{className:"row"},P.default.createElement("label",{className:"col-sm-5 control-label visible-xs-block"}),P.default.createElement("div",{className:"col-sm-12"},P.default.createElement("input",{id:"teamInviteId",className:"form-control",type:"text",onChange:this.updateInviteId,value:this.state.invite_id,maxLength:"32"}),P.default.createElement("div",{className:"padding-top x2"},P.default.createElement("a",{id:"teamInviteIdRegenerate",href:"#",onClick:this.handleGenerateInviteId},P.default.createElement(T.FormattedMessage,{id:"general_tab.regenerate",defaultMessage:"Regenerate"}))))),P.default.createElement("div",{className:"setting-list__hint"},P.default.createElement(T.FormattedMessage,{id:"general_tab.codeLongDesc",defaultMessage:"The Invite Code is used as part of the URL in the team invitation link created by {getTeamInviteLink} in the main menu. Regenerating creates a new team invitation link and invalidates the previous link.",values:{getTeamInviteLink:P.default.createElement("strong",null,P.default.createElement(T.FormattedMessage,{id:"general_tab.getTeamInviteLink",defaultMessage:"Get Team Invite Link"}))}})))),i=P.default.createElement(E.default,{title:w.localizeMessage("general_tab.codeTitle","Invite Code"),inputs:s,submit:this.handleInviteIdSubmit,server_error:t,client_error:e,updateSection:this.onUpdateInviteIdSection})}else i=P.default.createElement(b.default,{title:w.localizeMessage("general_tab.codeTitle","Invite Code"),describe:w.localizeMessage("general_tab.codeDesc","Click 'Edit' to regenerate Invite Code."),updateSection:this.onUpdateInviteIdSection});var o=void 0;if("name"===this.props.activeSection){var l=[],d=P.default.createElement(T.FormattedMessage,{id:"general_tab.teamName",defaultMessage:"Team Name"});w.isMobile()&&(d=""),l.push(P.default.createElement("div",{key:"teamNameSetting",className:"form-group"},P.default.createElement("label",{className:"col-sm-5 control-label"},d),P.default.createElement("div",{className:"col-sm-7"},P.default.createElement("input",{id:"teamName",className:"form-control",type:"text",maxLength:C.default.MAX_TEAMNAME_LENGTH.toString(),onChange:this.updateName,value:this.state.name}))));var u=P.default.createElement("span",null,w.localizeMessage("general_tab.teamNameInfo","Set the name of the team as it appears on your sign-in screen and at the top of the left-hand sidebar."));o=P.default.createElement(E.default,{title:w.localizeMessage("general_tab.teamName","Team Name"),inputs:l,submit:this.handleNameSubmit,server_error:t,client_error:e,updateSection:this.onUpdateNameSection,extraInfo:u})}else{var c=this.state.name;o=P.default.createElement(b.default,{title:w.localizeMessage("general_tab.teamName","Team Name"),describe:c,updateSection:this.onUpdateNameSection})}var f=void 0;if("description"===this.props.activeSection){var m=[],h=P.default.createElement(T.FormattedMessage,{id:"general_tab.teamDescription",defaultMessage:"Team Description"});w.isMobile()&&(h=""),m.push(P.default.createElement("div",{key:"teamDescriptionSetting",className:"form-group"},P.default.createElement("label",{className:"col-sm-5 control-label"},h),P.default.createElement("div",{className:"col-sm-7"},P.default.createElement("input",{id:"teamDescription",className:"form-control",type:"text",maxLength:C.default.MAX_TEAMDESCRIPTION_LENGTH.toString(),onChange:this.updateDescription,value:this.state.description}))));var p=P.default.createElement("span",null,w.localizeMessage("general_tab.teamDescriptionInfo","Team description provides additional information to help users select the right team. Maximum of 50 characters."));f=P.default.createElement(E.default,{title:w.localizeMessage("general_tab.teamDescription","Team Description"),inputs:m,submit:this.handleDescriptionSubmit,server_error:t,client_error:e,updateSection:this.onUpdateDescriptionSection,extraInfo:p})}else{var g="";g=this.state.description?this.state.description:P.default.createElement(T.FormattedMessage,{id:"general_tab.emptyDescription",defaultMessage:"Click 'Edit' to add a team description."}),f=P.default.createElement(b.default,{title:w.localizeMessage("general_tab.teamDescription","Team Description"),describe:g,updateSection:this.onUpdateDescriptionSection})}return P.default.createElement("div",null,P.default.createElement("div",{className:"modal-header"},P.default.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},P.default.createElement("span",{"aria-hidden":"true"},"×")),P.default.createElement("h4",{className:"modal-title",ref:"title"},P.default.createElement("div",{className:"modal-back"},P.default.createElement("i",{className:"fa fa-angle-left"})),P.default.createElement(T.FormattedMessage,{id:"general_tab.title",defaultMessage:"General Settings"}))),P.default.createElement("div",{ref:"wrapper",className:"user-settings"},P.default.createElement("h3",{className:"tab-header"},P.default.createElement(T.FormattedMessage,{id:"general_tab.title",defaultMessage:"General Settings"})),P.default.createElement("div",{className:"divider-dark first"}),o,P.default.createElement("div",{className:"divider-light"}),f,P.default.createElement("div",{className:"divider-light"}),a,P.default.createElement("div",{className:"divider-light"}),i,P.default.createElement("div",{className:"divider-dark"})))}}]),t}(P.default.Component);D.propTypes={updateSection:P.default.PropTypes.func.isRequired,team:P.default.PropTypes.object.isRequired,activeSection:P.default.PropTypes.string.isRequired},t.default=D},2046:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(11),g=n(p),v=a(2038),b=r(v),y=a(13),E=a(1),_=r(E),w=(0,y.defineMessages)({importSlack:{id:"team_import_tab.importSlack",defaultMessage:"Import from Slack (Beta)"}}),S=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.onImportFailure=a.onImportFailure.bind(a),a.onImportSuccess=a.onImportSuccess.bind(a),a.doImportSlack=a.doImportSlack.bind(a),a.state={status:"ready",link:""},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"onImportFailure",value:function(e,t,a){this.setState({status:"fail",link:"data:application/octet-stream;charset=utf-8,"+encodeURIComponent(a.text)})}},{key:"onImportSuccess",value:function(e,t){this.setState({status:"done",link:"data:application/octet-stream;charset=utf-8,"+encodeURIComponent(t.text)})}},{key:"doImportSlack",value:function(e){this.setState({status:"in-progress",link:""}),g.importSlack(e,this.onImportSuccess,this.onImportFailure)}},{key:"render",value:function(){var e,t=this.props.intl.formatMessage,a=_.default.createElement("a",{href:"https://docs.mattermost.com/administration/migrating.html#migrating-from-slack",target:"_blank",rel:"noopener noreferrer"},_.default.createElement(y.FormattedMessage,{id:"team_import_tab.importHelpDocsLink",defaultMessage:"documentation"})),n=_.default.createElement("strong",null,_.default.createElement(y.FormattedMessage,{id:"team_import_tab.importHelpExportInstructions",defaultMessage:"Slack > Team Settings > Import/Export Data > Export > Start Export"})),r=_.default.createElement("a",{href:"https://github.com/grundleborg/slack-advanced-exporter",target:"_blank",rel:"noopener noreferrer"},_.default.createElement(y.FormattedMessage,{id:"team_import_tab.importHelpExporterLink",defaultMessage:"Slack Advanced Exporter"})),i=_.default.createElement("div",null,_.default.createElement("p",null,_.default.createElement(y.FormattedMessage,{id:"team_import_tab.importHelpLine1",defaultMessage:"Slack import to Mattermost supports importing of messages in your Slack team's public channels."})),_.default.createElement("p",null,_.default.createElement(y.FormattedMessage,{id:"team_import_tab.importHelpLine2",defaultMessage:"To import a team from Slack, go to {exportInstructions}. See {uploadDocsLink} to learn more.",values:{exportInstructions:n,uploadDocsLink:a}})),_.default.createElement("p",null,_.default.createElement(y.FormattedMessage,{id:"team_import_tab.importHelpLine3",defaultMessage:"To import posts with attached files, see {slackAdvancedExporterLink} for details.",values:{slackAdvancedExporterLink:r}}))),s=_.default.createElement(b.default,{title:t(w.importSlack),submit:this.doImportSlack,helpText:i,fileTypesAccepted:".zip"});switch(this.state.status){case"ready":e="";break;case"in-progress":e=_.default.createElement("p",{className:"confirm-import alert alert-warning"},_.default.createElement("i",{className:"fa fa-spinner fa-pulse"}),_.default.createElement(y.FormattedMessage,{id:"team_import_tab.importing",defaultMessage:" Importing..."}));break;case"done":e=_.default.createElement("p",{className:"confirm-import alert alert-success"},_.default.createElement("i",{className:"fa fa-check"}),_.default.createElement(y.FormattedMessage,{id:"team_import_tab.successful",defaultMessage:" Import successful: "}),_.default.createElement("a",{href:this.state.link,download:"MattermostImportSummary.txt"},_.default.createElement(y.FormattedMessage,{id:"team_import_tab.summary",defaultMessage:"View Summary"})));break;case"fail":e=_.default.createElement("p",{className:"confirm-import alert alert-warning"},_.default.createElement("i",{className:"fa fa-warning"}),_.default.createElement(y.FormattedMessage,{id:"team_import_tab.failure",defaultMessage:" Import failure: "}),_.default.createElement("a",{href:this.state.link,download:"MattermostImportSummary.txt"},_.default.createElement(y.FormattedMessage,{id:"team_import_tab.summary",defaultMessage:"View Summary"})))}return _.default.createElement("div",null,_.default.createElement("div",{className:"modal-header"},_.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},_.default.createElement("span",{"aria-hidden":"true"},"×")),_.default.createElement("h4",{className:"modal-title",ref:"title"},_.default.createElement("div",{className:"modal-back"},_.default.createElement("i",{className:"fa fa-angle-left"})),_.default.createElement(y.FormattedMessage,{id:"team_import_tab.import",defaultMessage:"Import"}))),_.default.createElement("div",{ref:"wrapper",className:"user-settings"},_.default.createElement("h3",{className:"tab-header"},_.default.createElement(y.FormattedMessage,{id:"team_import_tab.import",defaultMessage:"Import"})),_.default.createElement("div",{className:"divider-dark first"}),s,_.default.createElement("div",{className:"divider-dark"}),e))}}]),t}(_.default.Component);S.propTypes={intl:y.intlShape.isRequired},t.default=(0,y.injectIntl)(S)},2047:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(23),g=r(p),v=a(2046),b=r(v),y=a(2045),E=r(y),_=a(11),w=n(_),S=a(1),C=r(S),T=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.onChange=a.onChange.bind(a),a.state={team:g.default.getCurrent()},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){g.default.addChangeListener(this.onChange)}},{key:"componentWillUnmount",value:function(){g.default.removeChangeListener(this.onChange)}},{key:"onChange",value:function(){var e=g.default.getCurrent();w.areObjectsEqual(this.state.team,e)||this.setState({team:e})}},{key:"render",value:function(){if(!this.state.team)return null;var e;switch(this.props.activeTab){case"general":e=C.default.createElement("div",null,C.default.createElement(E.default,{team:this.state.team,activeSection:this.props.activeSection,updateSection:this.props.updateSection}));break;case"import":e=C.default.createElement("div",null,C.default.createElement(b.default,{team:this.state.team,activeSection:this.props.activeSection,updateSection:this.props.updateSection}));break;default:e=C.default.createElement("div",null)}return e}}]),t}(C.default.Component);t.default=T,T.defaultProps={activeTab:"",activeSection:""},T.propTypes={activeTab:C.default.PropTypes.string.isRequired,activeSection:C.default.PropTypes.string.isRequired,updateSection:C.default.PropTypes.func.isRequired}},2048:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(0),g=r(p),v=a(30),b=r(v),y=a(602),E=r(y),_=a(2047),w=r(_),S=a(11),C=n(S),T=a(13),M=a(1),k=r(M),P=(0,T.defineMessages)({generalTab:{id:"team_settings_modal.generalTab",defaultMessage:"General"},importTab:{id:"team_settings_modal.importTab",defaultMessage:"Import"}}),D=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.updateTab=a.updateTab.bind(a),a.updateSection=a.updateSection.bind(a),a.state={activeTab:"general",activeSection:""},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){var e=(0,g.default)(b.default.findDOMNode(this.refs.modal));e.on("click",".modal-back",function(){(0,g.default)(this).closest(".modal-dialog").removeClass("display--content"),(0,g.default)(this).closest(".modal-dialog").find(".settings-table .nav li.active").removeClass("active")}),e.on("click",".modal-header .close",function(){setTimeout(function(){(0,g.default)(".modal-dialog.display--content").removeClass("display--content")},500)}),C.isMobile()||(0,g.default)(".settings-modal .settings-content").perfectScrollbar()}},{key:"updateTab",value:function(e){this.setState({activeTab:e,activeSection:""}),C.isMobile()||(0,g.default)(".settings-modal .modal-body").scrollTop(0).perfectScrollbar("update")}},{key:"updateSection",value:function(e){(0,g.default)(".section-max").length&&(0,g.default)(".settings-modal .modal-body").scrollTop(0).perfectScrollbar("update"),this.setState({activeSection:e})}},{key:"render",value:function(){var e=this.props.intl.formatMessage,t=[];return t.push({name:"general",uiName:e(P.generalTab),icon:"icon fa fa-cog"}),t.push({name:"import",uiName:e(P.importTab),icon:"icon fa fa-upload"}),k.default.createElement("div",{className:"modal fade",ref:"modal",id:"team_settings",role:"dialog",tabIndex:"-1","aria-hidden":"true"},k.default.createElement("div",{className:"modal-dialog settings-modal"},k.default.createElement("div",{className:"modal-content"},k.default.createElement("div",{className:"modal-header"},k.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},k.default.createElement("span",{"aria-hidden":"true"},"×")),k.default.createElement("h4",{className:"modal-title",ref:"title"},k.default.createElement(T.FormattedMessage,{id:"team_settings_modal.title",defaultMessage:"Team Settings"}))),k.default.createElement("div",{className:"modal-body settings-modal__body"},k.default.createElement("div",{className:"settings-table"},k.default.createElement("div",{className:"settings-links"},k.default.createElement(E.default,{tabs:t,activeTab:this.state.activeTab,updateTab:this.updateTab})),k.default.createElement("div",{className:"settings-content minimize-settings"},k.default.createElement(w.default,{activeTab:this.state.activeTab,activeSection:this.state.activeSection,updateSection:this.updateSection})))))))}}]),t}(k.default.Component);D.propTypes={intl:T.intlShape.isRequired},t.default=(0,T.injectIntl)(D)},2052:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),i=n(r),s=a(2),o=n(s),l=a(5),d=n(l),u=a(4),c=n(u),f=a(3),m=n(f),h=a(1661),p=n(h),g=a(27),v=a(8),b=n(v),y=a(13),E=a(1),_=n(E),w=b.default.ActionTypes,S=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.updateShow=a.updateShow.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.handleChange=a.handleChange.bind(a),a.state={value:"",inputError:"",show:!1,callback:null},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){p.default.addModalListener(w.TOGGLE_IMPORT_THEME_MODAL,this.updateShow)}},{key:"componentWillUnmount",value:function(){p.default.removeModalListener(w.TOGGLE_IMPORT_THEME_MODAL,this.updateShow)}},{key:"updateShow",value:function(e,t){this.setState({show:e,callback:t.callback})}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state.value;if(!this.isInputValid(t))return void this.setState({inputError:_.default.createElement(y.FormattedMessage,{id:"user.settings.import_theme.submitError",defaultMessage:"Invalid format, please try copying and pasting in again."})});var a=t.split(","),n={type:"custom"};n.sidebarBg=a[0],n.sidebarText=a[5],n.sidebarUnreadText=a[5],n.sidebarTextHoverBg=a[4],n.sidebarTextActiveBorder=a[2],n.sidebarTextActiveColor=a[3],n.sidebarHeaderBg=a[1],n.sidebarHeaderTextColor=a[5],n.onlineIndicator=a[6],n.awayIndicator="#E0B333",n.mentionBj=a[7],n.mentionColor="#ffffff",n.centerChannelBg="#ffffff",n.centerChannelColor="#333333",n.newMessageSeparator="#F80",n.linkColor="#2389d7",n.buttonBg="#26a970",n.buttonColor="#ffffff",n.mentionHighlightBg="#fff2bb",n.mentionHighlightLink="#2f81b7",n.codeTheme="github",this.state.callback(n),this.setState({show:!1,callback:null})}},{key:"isInputValid",value:function(e){if(0===e.length)return!1;if(-1!==e.indexOf(" "))return!1;if(e.length>0&&-1===e.indexOf(","))return!1;if(e.length>0){var t=e.split(",");if(8!==t.length)return!1;for(var a=0;a<t.length;a++){if(7!==t[a].length&&4!==t[a].length)return!1;if("#"!==t[a].charAt(0))return!1}}return!0}},{key:"handleChange",value:function(e){var t=e.target.value;this.setState({value:t}),this.isInputValid(t)?this.setState({inputError:null}):this.setState({inputError:_.default.createElement(y.FormattedMessage,{id:"user.settings.import_theme.submitError",defaultMessage:"Invalid format, please try copying and pasting in again."})})}},{key:"render",value:function(){var e=this;return _.default.createElement("span",null,_.default.createElement(g.Modal,{show:this.state.show,onHide:function(){return e.setState({show:!1})}},_.default.createElement(g.Modal.Header,{closeButton:!0},_.default.createElement(g.Modal.Title,null,_.default.createElement(y.FormattedMessage,{id:"user.settings.import_theme.importHeader",defaultMessage:"Import Slack Theme"}))),_.default.createElement("form",{role:"form",className:"form-horizontal"},_.default.createElement(g.Modal.Body,null,_.default.createElement("p",null,_.default.createElement(y.FormattedMessage,{id:"user.settings.import_theme.importBody",defaultMessage:"To import a theme, go to a Slack team and look for “Preferences -> Sidebar Theme”. Open the custom theme option, copy the theme color values and paste them here:"})),_.default.createElement("div",{className:"form-group less"},_.default.createElement("div",{className:"col-sm-12"},_.default.createElement("input",{id:"themeVector",type:"text",className:"form-control",value:this.state.value,onChange:this.handleChange}),_.default.createElement("div",{className:"input__help"},this.state.inputError)))),_.default.createElement(g.Modal.Footer,null,_.default.createElement("button",{id:"cancelButton",type:"button",className:"btn btn-default",onClick:function(){return e.setState({show:!1})}},_.default.createElement(y.FormattedMessage,{id:"user.settings.import_theme.cancel",defaultMessage:"Cancel"})),_.default.createElement("button",{id:"submitButton",onClick:this.handleSubmit,type:"submit",className:"btn btn-primary",tabIndex:"3"},_.default.createElement(y.FormattedMessage,{id:"user.settings.import_theme.submit",defaultMessage:"Submit"}))))))}}]),t}(_.default.Component);t.default=S},2053:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(6),i=n(r),s=a(2),o=n(s),l=a(5),d=n(l),u=a(4),c=n(u),f=a(3),m=n(f),h=a(8),p=n(h),g=a(27),v=a(13),b=a(1),y=n(b),E=function(e){function t(){return(0,o.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=y.default.createElement(v.FormattedMessage,{id:"webrtc.header",defaultMessage:"Call with {username}",values:{username:this.props.username}}),t=y.default.createElement(g.Tooltip,{id:"closeSidebarTooltip"},y.default.createElement(v.FormattedMessage,{id:"rhs_header.closeTooltip",defaultMessage:"Close Sidebar"})),a=y.default.createElement(g.Tooltip,{id:"expandSidebarTooltip"},y.default.createElement(v.FormattedMessage,{id:"rhs_header.expandTooltip",defaultMessage:"Expand Sidebar"})),n=y.default.createElement(g.Tooltip,{id:"shrinkSidebarTooltip"},y.default.createElement(v.FormattedMessage,{id:"rhs_header.expandTooltip",defaultMessage:"Shrink Sidebar"}));return y.default.createElement("div",{className:"sidebar--right__header"},y.default.createElement("span",{className:"sidebar--right__title"},e),y.default.createElement("div",{className:"pull-right"},y.default.createElement("button",{type:"button",className:"sidebar--right__expand","aria-label":"Expand",onClick:this.props.toggleSize},y.default.createElement(g.OverlayTrigger,{delayShow:p.default.OVERLAY_TIME_DELAY,placement:"top",overlay:a},y.default.createElement("i",{className:"fa fa-expand"})),y.default.createElement(g.OverlayTrigger,{delayShow:p.default.OVERLAY_TIME_DELAY,placement:"top",overlay:n},y.default.createElement("i",{className:"fa fa-compress"}))),y.default.createElement("button",{type:"button",className:"sidebar--right__close","aria-label":"Close",title:"Close",onClick:this.props.onClose},y.default.createElement(g.OverlayTrigger,{delayShow:p.default.OVERLAY_TIME_DELAY,placement:"top",overlay:t},y.default.createElement("i",{className:"fa fa-sign-out"})))))}}]),t}(y.default.Component);t.default=E,E.propTypes={username:y.default.PropTypes.string.isRequired,onClose:y.default.PropTypes.func.isRequired,toggleSize:y.default.PropTypes.func}},2054:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(28),g=r(p),v=a(340),b=r(v),y=a(15),E=r(y),_=a(334),w=r(_),S=a(41),C=n(S),T=a(247),M=n(T),k=a(11),P=n(k),D=a(8),I=a(1),N=r(I),L=a(13),O=a(1778),R=r(O),A=D.Constants.PRE_RELEASE_FEATURES,F=function(e){function t(){(0,l.default)(this,t);var e=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return e.mounted=!1,e.closeNotification=e.closeNotification.bind(e),e.onIncomingCall=e.onIncomingCall.bind(e),e.onCancelCall=e.onCancelCall.bind(e),e.onRhs=e.onRhs.bind(e),e.handleClose=e.handleClose.bind(e),e.handleAnswer=e.handleAnswer.bind(e),e.handleTimeout=e.handleTimeout.bind(e),e.stopRinging=e.stopRinging.bind(e),e.closeRightHandSide=e.closeRightHandSide.bind(e),e.state={userCalling:null,rhsOpened:!1},e}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){w.default.addNotifyListener(this.onIncomingCall),w.default.addChangedListener(this.onCancelCall),w.default.addRhsChangedListener(this.onRhs),this.mounted=!0}},{key:"componentWillUnmount",value:function(){w.default.removeNotifyListener(this.onIncomingCall),w.default.removeChangedListener(this.onCancelCall),w.default.removeRhsChangedListener(this.onRhs),this.refs.ring&&this.refs.ring.removeListener("ended",this.handleTimeout),this.mounted=!1}},{key:"componentDidUpdate",value:function(){this.state.userCalling&&this.refs.ring.addEventListener("ended",this.handleTimeout)}},{key:"closeNotification",value:function(){this.setState({userCalling:null})}},{key:"stopRinging",value:function(){this.refs.ring&&(this.refs.ring.pause(),this.refs.ring.currentTime=0),this.setState({userCalling:null})}},{key:"closeRightHandSide",value:function(e){e.preventDefault(),C.emitCloseRightHandSide()}},{key:"onIncomingCall",value:function(e){if(this.mounted){var t=e.from_user_id,a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;P.isFeatureEnabled(A.WEBRTC_PREVIEW)?w.default.isBusy()?(b.default.sendMessage("webrtc",{action:D.WebrtcActionTypes.BUSY,from_user_id:E.default.getCurrentId(),to_user_id:t}),this.stopRinging()):a?(w.default.setVideoCallWith(t),this.setState({userCalling:E.default.getProfile(t)})):(b.default.sendMessage("webrtc",{action:D.WebrtcActionTypes.UNSUPPORTED,from_user_id:E.default.getCurrentId(),to_user_id:t}),this.stopRinging()):(b.default.sendMessage("webrtc",{action:D.WebrtcActionTypes.DISABLED,from_user_id:E.default.getCurrentId(),to_user_id:t}),this.stopRinging())}}},{key:"onCancelCall",value:function(e){e&&e.action!==D.WebrtcActionTypes.CANCEL||e&&e.action===D.WebrtcActionTypes.CANCEL&&this.state.userCalling&&e.from_user_id!==this.state.userCalling.id||(w.default.setVideoCallWith(null),this.closeNotification())}},{key:"onRhs",value:function(e){this.setState({rhsOpened:e})}},{key:"handleTimeout",value:function(){b.default.sendMessage("webrtc",{action:D.WebrtcActionTypes.NO_ANSWER,from_user_id:E.default.getCurrentId(),to_user_id:this.state.userCalling.id}),this.onCancelCall()}},{key:"handleAnswer",value:function(e){e&&e.preventDefault();var t=this.state.userCalling;if(t){var a=t.id,n=E.default.getCurrentId(),r={action:D.WebrtcActionTypes.ANSWER,from_user_id:n,to_user_id:a};C.emitCloseRightHandSide(),M.initWebrtc(a,!1),b.default.sendMessage("webrtc",r),setTimeout(function(){r.from_user_id=a,r.to_user_id=n,M.handle(r)},0),this.closeNotification()}}},{key:"handleClose",value:function(e){e&&e.preventDefault(),this.state.userCalling&&b.default.sendMessage("webrtc",{action:D.WebrtcActionTypes.DECLINE,from_user_id:E.default.getCurrentId(),to_user_id:this.state.userCalling.id}),this.onCancelCall()}},{key:"render",value:function(){var e=this.state.userCalling;if(e){var t=P.displayUsername(e.id),a=g.default.getUsersRoute()+"/"+e.id+"/image?time="+(e.last_picture_update||(new Date).getTime()),n=N.default.createElement("img",{className:"user-popover__image",src:a,height:"128",width:"128",key:"user-popover-image"}),r=N.default.createElement("svg",{className:"webrtc-icons__pickup",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:this.handleAnswer},N.default.createElement("circle",{cx:"24",cy:"24",r:"34"},N.default.createElement("title",null,N.default.createElement(L.FormattedMessage,{id:"webrtc.notification.answer",defaultMessage:"Answer"}))),N.default.createElement("path",{transform:"translate(-10,-10)",fill:"#fff",d:"M29.854,37.627c1.723,1.904 3.679,3.468 5.793,4.684l3.683,-3.334c0.469,-0.424 1.119,-0.517 1.669,-0.302c1.628,0.63 3.331,1.021 5.056,1.174c0.401,0.026 0.795,0.199 1.09,0.525c0.295,0.326 0.433,0.741 0.407,1.153l-0.279,5.593c-0.02,0.418 -0.199,0.817 -0.525,1.112c-0.326,0.296 -0.741,0.434 -1.159,0.413c-6.704,-0.504 -13.238,-3.491 -18.108,-8.87c-4.869,-5.38 -7.192,-12.179 -7.028,-18.899c0.015,-0.413 0.199,-0.817 0.526,-1.113c0.326,-0.295 0.74,-0.433 1.153,-0.407l5.593,0.279c0.407,0.02 0.812,0.193 1.107,0.519c0.29,0.32 0.428,0.735 0.413,1.137c-0.018,1.732 0.202,3.464 0.667,5.147c0.159,0.569 0.003,1.207 -0.466,1.631l-3.683,3.334c1.005,2.219 2.368,4.32 4.091,6.224Z"})),i=N.default.createElement("svg",{className:"webrtc-icons__cancel",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:this.handleClose},N.default.createElement("circle",{cx:"24",cy:"24",r:"34"},N.default.createElement("title",null,N.default.createElement(L.FormattedMessage,{id:"webrtc.notification.decline",defaultMessage:"Decline"}))),N.default.createElement("path",{transform:"scale(0.7), translate(11,10)",d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"})),s=N.default.createElement("div",null,N.default.createElement(L.FormattedMessage,{id:"webrtc.notification.incoming_call",defaultMessage:"{username} is calling you.",values:{username:t}}),N.default.createElement("div",{className:"webrtc-buttons webrtc-icons active",style:{marginTop:"5px"}},r,i));return N.default.createElement("div",{className:"webrtc-notification"},N.default.createElement("audio",{ref:"ring",src:R.default,autoPlay:!0}),N.default.createElement("div",null,n),s)}return this.state.rhsOpened&&w.default.isBusy()?N.default.createElement("div",{className:"webrtc__notification--rhs",onClick:this.closeRightHandSide},N.default.createElement("i",{className:"fa fa-phone"}),N.default.createElement(L.FormattedMessage,{id:"webrtc.notification.returnToCall",defaultMessage:"Return to ongoing call with {username}",values:{username:P.displayUsername(w.default.getVideoCallWith())}})):N.default.createElement("div",null)}}]),t}(N.default.Component);t.default=F},2055:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(0),g=r(p),v=a(2056),b=r(v),y=a(15),E=r(y),_=a(334),w=r(_),S=a(11),C=n(S),T=a(1),M=r(T),k=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.plScrolledToBottom=!0,a.onShrink=a.onShrink.bind(a),a.toggleSize=a.toggleSize.bind(a),a.onInitializeVideoCall=a.onInitializeVideoCall.bind(a),a.doStrangeThings=a.doStrangeThings.bind(a),a.state={expanded:!1,currentUser:E.default.getCurrentUser(),videoCallVisible:!1,isCaller:!1,videoCallWithUserId:null},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){w.default.addInitListener(this.onInitializeVideoCall),this.doStrangeThings()}},{key:"componentWillUnmount",value:function(){w.default.removeInitListener(this.onInitializeVideoCall)}},{key:"shouldComponentUpdate",value:function(e,t){return!C.areObjectsEqual(t,this.state)}},{key:"doStrangeThings",value:function(){return(0,g.default)(".app__body .inner-wrap").removeClass("move--right"),(0,g.default)(".app__body .inner-wrap").addClass("webrtc--show"),(0,g.default)(".app__body .sidebar--left").removeClass("move--right"),(0,g.default)(".multi-teams .team-sidebar").removeClass("move--right"),(0,g.default)(".app__body .webrtc").addClass("webrtc--show"),this.state.videoCallVisible?null:((0,g.default)(".app__body .inner-wrap").removeClass("webrtc--show").removeClass("move--right"),(0,g.default)(".app__body .webrtc").removeClass("webrtc--show"),M.default.createElement("div",null))}},{key:"componentDidUpdate",value:function(){this.doStrangeThings()}},{key:"onShrink",value:function(){this.setState({expanded:!1})}},{key:"toggleSize",value:function(e){e&&e.preventDefault(),this.setState({expanded:!this.state.expanded})}},{key:"onInitializeVideoCall",value:function(e,t){var a=this.state.expanded;null===e&&(a=!1),this.setState({videoCallVisible:null!==e,isCaller:t,videoCallWithUserId:e,expanded:a}),null!==e&&this.forceUpdate()}},{key:"render",value:function(){var e=null,t="";return this.state.expanded&&(t="sidebar--right--expanded"),this.state.videoCallVisible&&(e=M.default.createElement(b.default,{currentUser:this.state.currentUser,userId:this.state.videoCallWithUserId,isCaller:this.state.isCaller,expanded:this.state.expanded,toggleSize:this.toggleSize})),M.default.createElement("div",{className:"sidebar--right webrtc "+t,id:"sidebar-webrtc"},M.default.createElement("div",{onClick:this.onShrink,className:"sidebar--right__bg"}),M.default.createElement("div",{className:"sidebar-right-container"},e))}}]),t}(M.default.Component);t.default=k},2056:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),s=r(i),o=a(2),l=r(o),d=a(5),u=r(d),c=a(4),f=r(c),m=a(3),h=r(m),p=a(15),g=r(p),v=a(24),b=r(v),y=a(334),E=r(y),_=a(28),w=r(_),S=a(340),C=r(S),T=a(2212),M=r(T),k=a(576),P=r(k),D=a(2053),I=r(D),N=a(164),L=r(N),O=a(165),R=a(247),A=n(R),F=a(11),x=n(F),U=a(8),j=a(1),H=r(j),B=a(13),V=a(1778),G=r(V),z=640,W=360,q=1.777,Y=1.778,K=477,J=476,X=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,s.default)(a)).call(this,e));t.mounted=!1,t.localMedia=null,t.session=null,t.videocall=null,t.handleResize=t.handleResize.bind(t),t.handleClose=t.handleClose.bind(t),t.close=t.close.bind(t),t.clearError=t.clearError.bind(t),t.getLocalMedia=t.getLocalMedia.bind(t),t.stopMediaStream=t.stopMediaStream.bind(t),t.previewVideo=t.previewVideo.bind(t),t.stopRinging=t.stopRinging.bind(t),t.handleMakeOffer=t.handleMakeOffer.bind(t),t.handleCancelOffer=t.handleCancelOffer.bind(t),t.handleWebrtcEvent=t.handleWebrtcEvent.bind(t),t.handleVideoCallEvent=t.handleVideoCallEvent.bind(t),t.handleRemoteStream=t.handleRemoteStream.bind(t),t.onStatusChange=t.onStatusChange.bind(t),t.onCallDeclined=t.onCallDeclined.bind(t),t.onUnsupported=t.onUnsupported.bind(t),t.onNoAnswer=t.onNoAnswer.bind(t),t.onBusy=t.onBusy.bind(t),t.onDisabled=t.onDisabled.bind(t),t.onFailed=t.onFailed.bind(t),t.onCancelled=t.onCancelled.bind(t),t.onConnectCall=t.onConnectCall.bind(t),t.onSessionCreated=t.onSessionCreated.bind(t),t.onSessionError=t.onSessionError.bind(t),t.doCall=t.doCall.bind(t),t.doAnswer=t.doAnswer.bind(t),t.doHangup=t.doHangup.bind(t),t.doCleanup=t.doCleanup.bind(t),t.renderButtons=t.renderButtons.bind(t),t.onToggleVideo=t.onToggleVideo.bind(t),t.onToggleAudio=t.onToggleAudio.bind(t),t.onToggleRemoteMute=t.onToggleRemoteMute.bind(t),t.toggleIcons=t.toggleIcons.bind(t);var n=g.default.getCurrentUser(),r=g.default.getProfile(e.userId),i=w.default.getUsersRoute()+"/"+r.id+"/image?time="+r.last_picture_update;return t.state={windowWidth:x.windowWidth(),windowHeight:x.windowHeight(),channelId:b.default.getCurrentId(),currentUser:n,currentUserImage:w.default.getUsersRoute()+"/"+n.id+"/image?time="+n.last_picture_update,remoteUserImage:i,localMediaLoaded:!1,isPaused:!1,isMuted:!1,isRemotePaused:!1,isRemoteMuted:!1,isCalling:!1,isAnswering:!1,callInProgress:!1,error:null,errorType:"",ended:null},t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),E.default.addChangedListener(this.handleWebrtcEvent),g.default.addStatusesChangeListener(this.onStatusChange),this.mounted=!0,this.previewVideo(),this.props.isCaller&&this.handleMakeOffer()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),E.default.removeChangedListener(this.handleWebrtcEvent),g.default.removeStatusesChangeListener(this.onStatusChange),this.mounted=!1,this.close()}},{key:"componentWillReceiveProps",value:function(e){if(e.currentUser!==this.props.currentUser||e.userId!==this.props.userId||e.isCaller!==this.props.isCaller){var t=g.default.getProfile(e.userId),a=w.default.getUsersRoute()+"/"+t.id+"/image?time="+t.last_picture_update;this.setState({error:null,remoteUserImage:a})}e.isCaller&&e.expanded===this.props.expanded&&(this.startCall=!0)}},{key:"componentDidUpdate",value:function(){this.props.isCaller&&this.startCall&&(this.startCall=!1,this.handleMakeOffer())}},{key:"handleResize",value:function(){this.setState({windowWidth:x.windowWidth(),windowHeight:x.windowHeight()})}},{key:"clearError",value:function(){var e=this;setTimeout(function(){e.setState({error:null,ended:null,errorType:""})},U.Constants.WEBRTC_CLEAR_ERROR_DELAY)}},{key:"getLocalMedia",value:function(e,t,a){var n=e||{audio:!0,video:!0};navigator.mediaDevices.getUserMedia(n).then(function(e){t&&(t.srcObject=e),a&&"function"==typeof a&&a(null,e)}).catch(function(e){a(e)})}},{key:"stopMediaStream",value:function(e){e.getTracks().forEach(function(e){e.stop()})}},{key:"previewVideo",value:function(){var e=this;this.mounted&&(this.localMedia?(this.setState({localMediaLoaded:!0,error:null}),this.localMedia.enabled=!0):this.getLocalMedia({audio:!0,video:{minAspectRatio:q,maxAspectRatio:Y,width:z,height:W}},this.refs["local-video"],function(t,a){if(t)return void e.setState({error:H.default.createElement(B.FormattedMessage,{id:"webrtc.mediaError",defaultMessage:"Unable to access Camera and Microphone"})});e.localMedia=a,e.setState({localMediaLoaded:!0})}))}},{key:"stopRinging",value:function(){this.refs.ring&&(this.refs.ring.pause(),this.refs.ring.currentTime=0)}},{key:"handleMakeOffer",value:function(){if(g.default.getStatus(this.props.userId)===U.UserStatuses.OFFLINE)this.onStatusChange();else{var e=H.default.createElement(B.FormattedMessage,{id:"calling_screen",defaultMessage:"Calling"});this.setState({isCalling:!0,isAnswering:!1,callInProgress:!1,error:null,ended:null,connectingMsg:e}),E.default.setVideoCallWith(this.props.userId);var t=this.state.currentUser;C.default.sendMessage("webrtc",{action:U.WebrtcActionTypes.NOTIFY,from_user_id:t.id,to_user_id:this.props.userId})}}},{key:"handleCancelOffer",value:function(){this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:null,ended:null});var e=this.state.currentUser;C.default.sendMessage("webrtc",{action:U.WebrtcActionTypes.CANCEL,from_user_id:e.id,to_user_id:this.props.userId}),this.doCleanup()}},{key:"handleWebrtcEvent",value:function(e){switch(e.action){case U.WebrtcActionTypes.DECLINE:this.onCallDeclined(),this.clearError();break;case U.WebrtcActionTypes.UNSUPPORTED:this.onUnsupported(),this.clearError();break;case U.WebrtcActionTypes.BUSY:this.onBusy(),this.clearError();break;case U.WebrtcActionTypes.NO_ANSWER:this.onNoAnswer(),this.clearError();break;case U.WebrtcActionTypes.FAILED:this.onFailed(),this.clearError();break;case U.WebrtcActionTypes.ANSWER:this.onConnectCall();break;case U.WebrtcActionTypes.CANCEL:this.onCancelled(),this.clearError();break;case U.WebrtcActionTypes.MUTED:this.onToggleRemoteMute(e);break;case U.WebrtcActionTypes.IN_PROGRESS:this.setState({error:H.default.createElement(B.FormattedMessage,{id:"webrtc.inProgress",defaultMessage:"You have a call in progress. Please hang up first."}),errorType:" warning"}),this.clearError();break;case U.WebrtcActionTypes.DISABLED:this.onDisabled(),this.clearError()}}},{key:"handleVideoCallEvent",value:function(e,t){var a=e.result;if(a){switch(a.event){case"registered":this.state.isCalling&&this.doCall();break;case"incomingcall":this.doAnswer(t);break;case"accepted":this.stopRinging(),t&&this.videocall.handleRemoteJsep({jsep:t});break;case"hangup":this.doHangup(!1)}}else{var n=e.error_code;n!==K&&n!==J?this.doHangup(!0):this.state.isCalling&&this.doCall()}}},{key:"handleRemoteStream",value:function(e){this.refs["main-video"].srcObject=e;var t=!1,a=!1,n=e.getVideoTracks(),r=e.getAudioTracks();n&&0!==n.length&&!n[0].muted&&n[0].enabled||(t=!0),r&&0!==r.length&&!r[0].muted&&r[0].enabled||(a=!0),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!0,isMuted:!1,isPaused:!1,error:null,ended:null,isRemotePaused:t,isRemoteMuted:a}),this.toggleIcons()}},{key:"handleClose",value:function(e){e.preventDefault(),this.state.callInProgress?this.setState({error:H.default.createElement(B.FormattedMessage,{id:"webrtc.inProgress",defaultMessage:"You have a call in progress. Please hang up first."}),errorType:" warning"}):this.state.isCalling?(this.handleCancelOffer(),this.close()):this.close()}},{key:"close",value:function(){this.doCleanup(),this.session&&(this.session.destroy(),this.session=null),this.localMedia&&(this.stopMediaStream(this.localMedia),this.localMedia=null),A.initWebrtc(null,!1)}},{key:"onStatusChange",value:function(){var e=g.default.getStatus(this.props.userId);if(e===U.UserStatuses.OFFLINE){var t=H.default.createElement(B.FormattedMessage,{id:"webrtc.offline",defaultMessage:"{username} is offline",values:{username:x.displayUsername(this.props.userId)}});this.state.isCalling||this.state.isAnswering?this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:t}):this.setState({error:t})}else e!==U.UserStatuses.OFFLINE&&this.state.error&&this.setState({error:null,ended:null})}},{key:"onCallDeclined",value:function(){var e=null;this.state.isCalling&&(e=H.default.createElement(B.FormattedMessage,{id:"webrtc.declined",defaultMessage:"Your call has been declined by {username}",values:{username:x.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onUnsupported",value:function(){this.mounted&&(this.stopRinging(),this.setState({error:H.default.createElement(B.FormattedMessage,{id:"webrtc.unsupported",defaultMessage:"Call to {username} not successful. Their client does not support video calls.",values:{username:x.displayUsername(this.props.userId)}}),callInProgress:!1,isCalling:!1,isAnswering:!1})),this.doCleanup()}},{key:"onNoAnswer",value:function(){var e=null;this.state.isCalling&&(e=H.default.createElement(B.FormattedMessage,{id:"webrtc.noAnswer",defaultMessage:"{username} is not answering the call",values:{username:x.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onBusy",value:function(){var e=null;this.state.isCalling&&(e=H.default.createElement(B.FormattedMessage,{id:"webrtc.busy",defaultMessage:"{username} is busy",values:{username:x.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onDisabled",value:function(){var e=null;this.state.isCalling&&(e=H.default.createElement(B.FormattedMessage,{id:"webrtc.disabled",defaultMessage:"{username} has WebRTC disabled, and cannot receive calls. To enable the feature, they must go to Account Settings > Advanced > Preview pre-release features and turn on WebRTC.",values:{username:x.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onFailed",value:function(){(0,O.trackEvent)("api","api_users_webrtc_failed"),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,isPaused:!1,isMuted:!1,isRemotePaused:!1,isRemoteMuted:!1,error:H.default.createElement(B.FormattedMessage,{id:"webrtc.failed",defaultMessage:"There was a problem connecting the video call"})}),this.stopRinging(),this.doCleanup()}},{key:"onCancelled",value:function(){this.mounted&&this.state.isAnswering&&(this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:H.default.createElement(B.FormattedMessage,{id:"webrtc.cancelled",defaultMessage:"{username} cancelled the call",values:{username:x.displayUsername(this.props.userId)}})})),this.doCleanup()}},{key:"onConnectCall",value:function(){var t=this;A.webrtcToken(function(a){var n=H.default.createElement(B.FormattedMessage,{id:"connecting_screen",defaultMessage:"Connecting"});if(t.setState({isAnswering:!t.state.isCalling,connectingMsg:n}),t.session)t.onSessionCreated();else{var r=[];a.stun_uri&&r.push({urls:[a.stun_uri]}),a.turn_uri&&r.push({urls:[a.turn_uri],username:a.turn_username,credential:a.turn_password}),M.default.init({debug:"true"===e.mm_config.EnableDeveloper}),t.session=new M.default({server:a.gateway_url,iceServers:r,token:a.token,success:t.onSessionCreated,error:t.onSessionError})}},function(){t.onSessionError()})}},{key:"onSessionCreated",value:function(){var e=this;this.videocall?this.doCall():this.session.attach({plugin:"janus.plugin.videocall",success:function(t){e.videocall=t,e.videocall.send({message:{request:"register",username:e.state.currentUser.id}})},error:this.onSessionError,onmessage:this.handleVideoCallEvent,onremotestream:this.handleRemoteStream})}},{key:"onSessionError",value:function(){var e=this.state.currentUser;C.default.sendMessage("webrtc",{action:U.WebrtcActionTypes.FAILED,from_user_id:e.id,to_user_id:this.props.userId}),this.onFailed()}},{key:"doCall",value:function(){var e=this;setTimeout(function(){e.videocall.createOffer({stream:e.localMedia,success:function(t){var a={request:"call",username:e.props.userId};e.videocall.send({message:a,jsep:t})},error:function(){e.doHangup(!0)}})},U.Constants.WEBRTC_TIME_DELAY)}},{key:"doAnswer",value:function(e){var t=this;(0,O.trackEvent)("api","api_users_webrtc_start"),this.videocall.createAnswer({jsep:e,stream:this.localMedia,success:function(e){var a={request:"accept"};t.videocall.send({message:a,jsep:e})},error:function(){t.doHangup(!0)}})}},{key:"doHangup",value:function(e,t){return(0,O.trackEvent)("api","api_users_webrtc_end"),this.videocall&&this.state.callInProgress&&(this.videocall.send({message:{request:"hangup"}}),this.videocall.hangup(),this.toggleIcons(),this.localMedia&&(this.localMedia.getVideoTracks()[0].enabled=!0,this.localMedia.getAudioTracks()[0].enabled=!0)),e?(this.onSessionError(),this.doCleanup()):(E.default.setVideoCallWith(null),E.default.emitRhsChanged(!1),t?this.close():(this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,isPaused:!1,isMuted:!1,isRemotePaused:!1,isRemoteMuted:!1,error:null,ended:H.default.createElement(B.FormattedMessage,{id:"webrtc.callEnded",defaultMessage:"Call with {username} ended.",values:{username:x.displayUsername(this.props.userId)}})}),this.clearError(),this.doCleanup()))}},{key:"doCleanup",value:function(){E.default.setVideoCallWith(null),this.videocall&&(this.videocall.detach(),this.videocall=null)}},{key:"onToggleVideo",value:function(){var e=!this.state.isPaused;e?this.videocall.unmuteVideo():this.videocall.muteVideo();var t=this.state.currentUser;C.default.sendMessage("webrtc",{action:U.WebrtcActionTypes.MUTED,from_user_id:t.id,to_user_id:this.props.userId,type:"video",mute:e}),this.setState({isPaused:e,error:null,ended:null})}},{key:"onToggleAudio",value:function(){var e=!this.state.isMuted;e?this.videocall.unmuteAudio():this.videocall.muteAudio();var t=this.state.currentUser;C.default.sendMessage("webrtc",{action:U.WebrtcActionTypes.MUTED,from_user_id:t.id,to_user_id:this.props.userId,type:"audio",mute:e}),this.setState({isMuted:e,error:null,ended:null})}},{key:"onToggleRemoteMute",value:function(e){"video"===e.type?this.setState({isRemotePaused:e.mute}):this.setState({isRemoteMuted:e.mute,error:null,ended:null})}},{key:"toggleIcons",value:function(){var e=this.refs.icons;e&&(e.classList.toggle("hidden"),e.classList.toggle("active"))}},{key:"renderButtons",value:function(){var e=this,t=void 0;if(this.state.isCalling)t=H.default.createElement("svg",{id:"cancel",className:"webrtc-icons__cancel",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.handleCancelOffer()}},H.default.createElement("circle",{cx:"24",cy:"24",r:"34"},H.default.createElement("title",null,H.default.createElement(B.FormattedMessage,{id:"webrtc.cancel",defaultMessage:"Cancel Call"}))),H.default.createElement("path",{transform:"scale(0.8), translate(6,10)",d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"}));else if(!this.state.callInProgress&&this.state.localMediaLoaded)t=H.default.createElement("svg",{id:"call",className:"webrtc-icons__call",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.handleMakeOffer()},disabled:"offline"===g.default.getStatus(this.props.userId)},H.default.createElement("circle",{cx:"24",cy:"24",r:"34"},H.default.createElement("title",null,H.default.createElement(B.FormattedMessage,{id:"webrtc.call",defaultMessage:"Call"}))),H.default.createElement("path",{transform:"translate(-10,-10)",fill:"#fff",d:"M29.854,37.627c1.723,1.904 3.679,3.468 5.793,4.684l3.683,-3.334c0.469,-0.424 1.119,-0.517 1.669,-0.302c1.628,0.63 3.331,1.021 5.056,1.174c0.401,0.026 0.795,0.199 1.09,0.525c0.295,0.326 0.433,0.741 0.407,1.153l-0.279,5.593c-0.02,0.418 -0.199,0.817 -0.525,1.112c-0.326,0.296 -0.741,0.434 -1.159,0.413c-6.704,-0.504 -13.238,-3.491 -18.108,-8.87c-4.869,-5.38 -7.192,-12.179 -7.028,-18.899c0.015,-0.413 0.199,-0.817 0.526,-1.113c0.326,-0.295 0.74,-0.433 1.153,-0.407l5.593,0.279c0.407,0.02 0.812,0.193 1.107,0.519c0.29,0.32 0.428,0.735 0.413,1.137c-0.018,1.732 0.202,3.464 0.667,5.147c0.159,0.569 0.003,1.207 -0.466,1.631l-3.683,3.334c1.005,2.219 2.368,4.32 4.091,6.224Z"}));else if(this.state.callInProgress){var a="on",n="off",r=n,i=a,s=n,o=a,l=H.default.createElement(B.FormattedMessage,{id:"webrtc.mute_audio",defaultMessage:"Mute"}),d=H.default.createElement(B.FormattedMessage,{id:"webrtc.pause_video",defaultMessage:"Turn off Video"});this.state.isMuted&&(r=a,i=n,l=H.default.createElement(B.FormattedMessage,{id:"webrtc.unmute_audio",defaultMessage:"Unmute"})),this.state.isPaused&&(s=a,o=n,d=H.default.createElement(B.FormattedMessage,{id:"webrtc.unpause_video",defaultMessage:"Turn on Video"})),t=H.default.createElement("div",{ref:"icons",className:"webrtc-icons hidden"},H.default.createElement("svg",{id:"mute-audio",className:"webrtc-icons__call",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.onToggleAudio()}},H.default.createElement("circle",{cx:"24",cy:"24",r:"34"},H.default.createElement("title",null,l)),H.default.createElement("path",{className:r,transform:"scale(0.6), translate(17,18)",d:"M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z",fill:"white"}),H.default.createElement("path",{className:i,transform:"scale(0.6), translate(17,18)",d:"M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z",fill:"white"})),H.default.createElement("svg",{id:"mute-video",className:"webrtc-icons__call",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.onToggleVideo()}},H.default.createElement("circle",{cx:"24",cy:"24",r:"34"},H.default.createElement("title",null,d)),H.default.createElement("path",{className:s,transform:"scale(0.6), translate(17,16)",d:"M40 8H15.64l8 8H28v4.36l1.13 1.13L36 16v12.36l7.97 7.97L44 36V12c0-2.21-1.79-4-4-4zM4.55 2L2 4.55l4.01 4.01C4.81 9.24 4 10.52 4 12v24c0 2.21 1.79 4 4 4h29.45l4 4L44 41.46 4.55 2zM12 16h1.45L28 30.55V32H12V16z",fill:"white"}),H.default.createElement("path",{className:o,transform:"scale(0.6), translate(17,16)",d:"M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm-4 24l-8-6.4V32H12V16h16v6.4l8-6.4v16z",fill:"white"})),H.default.createElement("svg",{id:"hangup",className:"webrtc-icons__cancel",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.doHangup(!1,!0)}},H.default.createElement("circle",{cx:"24",cy:"24",r:"34"},H.default.createElement("title",null,H.default.createElement(B.FormattedMessage,{id:"webrtc.hangup",defaultMessage:"Hang up"}))),H.default.createElement("path",{transform:"scale(0.7), translate(11,10)",d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"})))}return t}},{key:"render",value:function(){var e=g.default.getCurrentId(),t=H.default.createElement("img",{src:this.state.remoteUserImage}),a=void 0,n="",r="hidden",i=void 0,s=void 0,o="webrtc__local-image hidden",l="webrtc__remote-image";this.state.error?i=H.default.createElement("div",{className:"webrtc__error"},H.default.createElement("div",{className:"form-group has-error"},H.default.createElement("label",{className:"control-label"+this.state.errorType},this.state.error))):this.state.ended&&(i=H.default.createElement("div",{className:"webrtc__error"},H.default.createElement("div",{className:"form-group"},H.default.createElement("label",{className:"control-label"},this.state.ended)))),this.state.isRemoteMuted&&(s=H.default.createElement("div",{className:"webrtc__remote-mute"},H.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"60",height:"60",viewBox:"-10 -10 68 68"},H.default.createElement("path",{className:"off",transform:"scale(0.6), translate(17,18)",d:"M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z",fill:"white"}),H.default.createElement("path",{className:"on",transform:"scale(0.6), translate(17,18)",d:"M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z",fill:"white"}))));var d=void 0;null!=e&&(d=H.default.createElement(P.default,null));var u=this.renderButtons(),c=this.state.isCalling,f=void 0,m=void 0;return(c||this.state.isAnswering)&&(c&&(m=H.default.createElement("audio",{ref:"ring",src:G.default,autoPlay:!0})),f=H.default.createElement("div",{className:"connecting"},H.default.createElement(L.default,{position:"absolute",message:this.state.connectingMsg}),m)),this.state.callInProgress&&(this.state.isPaused&&(n="hidden",o="webrtc__local-image",a=H.default.createElement("img",{src:this.state.currentUserImage})),this.state.isRemotePaused?(r="hidden",l="webrtc__remote-image"):(r="",l="webrtc__remote-image hidden")),H.default.createElement("div",{className:"post-right__container"},H.default.createElement("div",{className:"search-bar__container sidebar--right__search-header"},d),H.default.createElement("div",{className:"sidebar-right__body"},H.default.createElement(I.default,{username:x.displayUsername(this.props.userId),onClose:this.handleClose,toggleSize:this.props.toggleSize}),H.default.createElement("div",{className:"post-right__scroll"},H.default.createElement("div",{id:"videos"},s,H.default.createElement("div",{id:"main-video",className:r,autoPlay:!0},H.default.createElement("video",{ref:"main-video",autoPlay:!0})),H.default.createElement("div",{id:"local-video",className:n},H.default.createElement("video",{ref:"local-video",autoPlay:!0,muted:!0})),H.default.createElement("div",{className:l},t),H.default.createElement("div",{className:o},a)),i,f,H.default.createElement("div",{className:"webrtc-buttons"},u))))}}]),a}(H.default.Component);t.default=X,X.propTypes={currentUser:H.default.PropTypes.object,userId:H.default.PropTypes.string.isRequired,isCaller:H.default.PropTypes.bool.isRequired,expanded:H.default.PropTypes.bool.isRequired,toggleSize:H.default.PropTypes.func}}).call(t,a(17))},2068:function(e,t,a){var n=(a(0),a(0),{animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0});e.exports=function(e,t){return"number"!=typeof t||n[e]?t:t+"px"}},2163:function(e,t,a){a(0),a(0);!function(t){var a=0,n=!1,r=function(e){for(var t=e.target;t!==document.body;){var n=window.getComputedStyle(t);if(!n)break;if("INPUT"===t.nodeName&&"range"===t.getAttribute("type"))return;var r=n.getPropertyValue("-webkit-overflow-scrolling"),i=n.getPropertyValue("overflow-y"),s=parseInt(n.getPropertyValue("height"),10),o="touch"===r&&("auto"===i||"scroll"===i),l=t.scrollHeight>t.offsetHeight;if(o&&l){var d=e.touches?e.touches[0].screenY:e.screenY,u=a<=d&&0===t.scrollTop,c=a>=d&&t.scrollHeight-t.scrollTop===s;return void((u||c)&&e.preventDefault())}t=t.parentNode}e.preventDefault()},i=function(e){a=e.touches?e.touches[0].screenY:e.screenY},s=function(){window.addEventListener("touchstart",i,!1),window.addEventListener("touchmove",r,!1),n=!0},o=function(){window.removeEventListener("touchstart",i,!1),window.removeEventListener("touchmove",r,!1),n=!1},l=function(){return n},d=document.createElement("div");document.documentElement.appendChild(d),d.style.WebkitOverflowScrolling="touch";var u="getComputedStyle"in window&&"touch"===window.getComputedStyle(d)["-webkit-overflow-scrolling"];document.documentElement.removeChild(d),u&&s();var c={enable:s,disable:o,isEnabled:l};void 0!==e&&e.exports&&(e.exports=c),"function"==typeof t.define?function(e){e("iNoBounce",[],function(){return c})}(t.define):t.iNoBounce=c}(this)},2169:function(e,t,a){(function(t){a(0),a(0);(function(){var a,n,r;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:void 0!==t&&null!==t&&t.hrtime?(e.exports=function(){return(a()-r)/1e6},n=t.hrtime,a=function(){var e;return e=n(),1e9*e[0]+e[1]},r=a()):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}).call(t,a(185))},2170:function(e,t,a){var n=(a(0),a(0),null),r=["Webkit","Moz","O","ms"];e.exports=function(e){n||(n=document.createElement("div"));var t=n.style;if(e in t)return e;for(var a=e.charAt(0).toUpperCase()+e.slice(1),i=r.length;i>=0;i--){var s=r[i]+a;if(s in t)return s}return!1}},2174:function(e,t,a){(function(t){for(var n=(a(0),a(0),a(2169)),r="undefined"==typeof window?t:window,i=["moz","webkit"],s="AnimationFrame",o=r["request"+s],l=r["cancel"+s]||r["cancelRequest"+s],d=0;!o&&d<i.length;d++)o=r[i[d]+"Request"+s],l=r[i[d]+"Cancel"+s]||r[i[d]+"CancelRequest"+s];if(!o||!l){var u=0,c=0,f=[],m=1e3/60;o=function(e){if(0===f.length){var t=n(),a=Math.max(0,m-(t-u));u=a+t,setTimeout(function(){var e=f.slice(0);f.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(u)}catch(e){setTimeout(function(){throw e},0)}},Math.round(a))}return f.push({handle:++c,callback:e,cancelled:!1}),c},l=function(e){for(var t=0;t<f.length;t++)f[t].handle===e&&(f[t].cancelled=!0)}}e.exports=function(e){return o.call(r,e)},e.exports.cancel=function(){l.apply(r,arguments)},e.exports.polyfill=function(){r.requestAnimationFrame=o,r.cancelAnimationFrame=l}}).call(t,a(17))},2175:function(e,t,a){function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}function i(e){return f.default.createElement("div",e)}function s(e){var t=e.style,a=r(e,["style"]),n=u({},t,{right:2,bottom:2,left:2,borderRadius:3});return f.default.createElement("div",u({style:n},a))}function o(e){var t=e.style,a=r(e,["style"]),n=u({},t,{right:2,bottom:2,top:2,borderRadius:3});return f.default.createElement("div",u({style:n},a))}function l(e){var t=e.style,a=r(e,["style"]),n=u({},t,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return f.default.createElement("div",u({style:n},a))}function d(e){var t=e.style,a=r(e,["style"]),n=u({},t,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return f.default.createElement("div",u({style:n},a))}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.renderViewDefault=i,t.renderTrackHorizontalDefault=s,t.renderTrackVerticalDefault=o,t.renderThumbHorizontalDefault=l,t.renderThumbVerticalDefault=d;var c=a(1),f=n(c)},2176:function(e,t,a){function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},s=a(2174),o=n(s),l=a(1795),d=n(l),u=a(1),c=a(2182),f=n(c),m=a(2181),h=n(m),p=a(2183),g=n(p),v=a(2180),b=n(v),y=a(2179),E=n(y),_=a(2177),w=a(2175);t.default=(0,u.createClass)({displayName:"Scrollbars",propTypes:{onScroll:u.PropTypes.func,onScrollFrame:u.PropTypes.func,onScrollStart:u.PropTypes.func,onScrollStop:u.PropTypes.func,onUpdate:u.PropTypes.func,renderView:u.PropTypes.func,renderTrackHorizontal:u.PropTypes.func,renderTrackVertical:u.PropTypes.func,renderThumbHorizontal:u.PropTypes.func,renderThumbVertical:u.PropTypes.func,tagName:u.PropTypes.string,thumbSize:u.PropTypes.number,thumbMinSize:u.PropTypes.number,hideTracksWhenNotNeeded:u.PropTypes.bool,autoHide:u.PropTypes.bool,autoHideTimeout:u.PropTypes.number,autoHideDuration:u.PropTypes.number,autoHeight:u.PropTypes.bool,autoHeightMin:u.PropTypes.oneOfType([u.PropTypes.number,u.PropTypes.string]),autoHeightMax:u.PropTypes.oneOfType([u.PropTypes.number,u.PropTypes.string]),universal:u.PropTypes.bool,style:u.PropTypes.object,children:u.PropTypes.node},getDefaultProps:function(){return{renderView:w.renderViewDefault,renderTrackHorizontal:w.renderTrackHorizontalDefault,renderTrackVertical:w.renderTrackVerticalDefault,renderThumbHorizontal:w.renderThumbHorizontalDefault,renderThumbVertical:w.renderThumbVerticalDefault,tagName:"div",thumbMinSize:30,hideTracksWhenNotNeeded:!1,autoHide:!1,autoHideTimeout:1e3,autoHideDuration:200,autoHeight:!1,autoHeightMin:0,autoHeightMax:200,universal:!1}},getInitialState:function(){return{didMountUniversal:!1}},componentDidMount:function(){this.addListeners(),this.update(),this.componentDidMountUniversal()},componentDidMountUniversal:function(){this.props.universal&&this.setState({didMountUniversal:!0})},componentDidUpdate:function(){this.update()},componentWillUnmount:function(){this.removeListeners(),(0,s.cancel)(this.requestFrame),clearTimeout(this.hideTracksTimeout),clearInterval(this.detectScrollingInterval)},getScrollLeft:function(){return this.refs.view.scrollLeft},getScrollTop:function(){return this.refs.view.scrollTop},getScrollWidth:function(){return this.refs.view.scrollWidth},getScrollHeight:function(){return this.refs.view.scrollHeight},getClientWidth:function(){return this.refs.view.clientWidth},getClientHeight:function(){return this.refs.view.clientHeight},getValues:function(){var e=this.refs.view,t=e.scrollLeft,a=e.scrollTop,n=e.scrollWidth,r=e.scrollHeight,i=e.clientWidth,s=e.clientHeight;return{left:t/(n-i)||0,top:a/(r-s)||0,scrollLeft:t,scrollTop:a,scrollWidth:n,scrollHeight:r,clientWidth:i,clientHeight:s}},getThumbHorizontalWidth:function(){var e=this.props,t=e.thumbSize,a=e.thumbMinSize,n=this.refs,r=n.view,i=n.trackHorizontal,s=r.scrollWidth,o=r.clientWidth,l=(0,b.default)(i),d=Math.ceil(o/s*l);return l===d?0:t||Math.max(d,a)},getThumbVerticalHeight:function(){var e=this.props,t=e.thumbSize,a=e.thumbMinSize,n=this.refs,r=n.view,i=n.trackVertical,s=r.scrollHeight,o=r.clientHeight,l=(0,E.default)(i),d=Math.ceil(o/s*l);return l===d?0:t||Math.max(d,a)},getScrollLeftForOffset:function(e){var t=this.refs,a=t.view,n=t.trackHorizontal,r=a.scrollWidth,i=a.clientWidth;return e/((0,b.default)(n)-this.getThumbHorizontalWidth())*(r-i)},getScrollTopForOffset:function(e){var t=this.refs,a=t.view,n=t.trackVertical,r=a.scrollHeight,i=a.clientHeight;return e/((0,E.default)(n)-this.getThumbVerticalHeight())*(r-i)},scrollLeft:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.refs.view.scrollLeft=e},scrollTop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.refs.view.scrollTop=e},scrollToLeft:function(){this.refs.view.scrollLeft=0},scrollToTop:function(){this.refs.view.scrollTop=0},scrollToRight:function(){var e=this.refs.view;e.scrollLeft=e.scrollWidth},scrollToBottom:function(){var e=this.refs.view;e.scrollTop=e.scrollHeight},addListeners:function(){if("undefined"!=typeof document){var e=this.refs,t=e.view,a=e.trackHorizontal,n=e.trackVertical,r=e.thumbHorizontal,i=e.thumbVertical;t.addEventListener("scroll",this.handleScroll),(0,h.default)()&&(a.addEventListener("mouseenter",this.handleTrackMouseEnter),a.addEventListener("mouseleave",this.handleTrackMouseLeave),a.addEventListener("mousedown",this.handleHorizontalTrackMouseDown),n.addEventListener("mouseenter",this.handleTrackMouseEnter),n.addEventListener("mouseleave",this.handleTrackMouseLeave),n.addEventListener("mousedown",this.handleVerticalTrackMouseDown),r.addEventListener("mousedown",this.handleHorizontalThumbMouseDown),i.addEventListener("mousedown",this.handleVerticalThumbMouseDown),window.addEventListener("resize",this.handleWindowResize))}},removeListeners:function(){if("undefined"!=typeof document){var e=this.refs,t=e.view,a=e.trackHorizontal,n=e.trackVertical,r=e.thumbHorizontal,i=e.thumbVertical;t.removeEventListener("scroll",this.handleScroll),(0,h.default)()&&(a.removeEventListener("mouseenter",this.handleTrackMouseEnter),a.removeEventListener("mouseleave",this.handleTrackMouseLeave),a.removeEventListener("mousedown",this.handleHorizontalTrackMouseDown),n.removeEventListener("mouseenter",this.handleTrackMouseEnter),n.removeEventListener("mouseleave",this.handleTrackMouseLeave),n.removeEventListener("mousedown",this.handleVerticalTrackMouseDown),r.removeEventListener("mousedown",this.handleHorizontalThumbMouseDown),i.removeEventListener("mousedown",this.handleVerticalThumbMouseDown),window.removeEventListener("resize",this.handleWindowResize),this.teardownDragging())}},handleScroll:function(e){var t=this,a=this.props,n=a.onScroll,r=a.onScrollFrame;n&&n(e),this.update(function(e){var a=e.scrollLeft,n=e.scrollTop;t.viewScrollLeft=a,t.viewScrollTop=n,r&&r(e)}),this.detectScrolling()},handleScrollStart:function(){var e=this.props.onScrollStart;e&&e(),this.handleScrollStartAutoHide()},handleScrollStartAutoHide:function(){this.props.autoHide&&this.showTracks()},handleScrollStop:function(){var e=this.props.onScrollStop;e&&e(),this.handleScrollStopAutoHide()},handleScrollStopAutoHide:function(){this.props.autoHide&&this.hideTracks()},handleWindowResize:function(){this.update()},handleHorizontalTrackMouseDown:function(e){e.preventDefault();var t=this.refs.view,a=e.target,n=e.clientX,r=a.getBoundingClientRect(),i=r.left,s=this.getThumbHorizontalWidth(),o=Math.abs(i-n)-s/2;t.scrollLeft=this.getScrollLeftForOffset(o)},handleVerticalTrackMouseDown:function(e){e.preventDefault();var t=this.refs.view,a=e.target,n=e.clientY,r=a.getBoundingClientRect(),i=r.top,s=this.getThumbVerticalHeight(),o=Math.abs(i-n)-s/2;t.scrollTop=this.getScrollTopForOffset(o)},handleHorizontalThumbMouseDown:function(e){e.preventDefault(),this.handleDragStart(e);var t=e.target,a=e.clientX,n=t.offsetWidth,r=t.getBoundingClientRect(),i=r.left;this.prevPageX=n-(a-i)},handleVerticalThumbMouseDown:function(e){e.preventDefault(),this.handleDragStart(e);var t=e.target,a=e.clientY,n=t.offsetHeight,r=t.getBoundingClientRect(),i=r.top;this.prevPageY=n-(a-i)},setupDragging:function(){(0,d.default)(document.body,_.disableSelectStyle),document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.handleDragEnd),document.onselectstart=g.default},teardownDragging:function(){(0,d.default)(document.body,_.disableSelectStyleReset),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleDragEnd),document.onselectstart=void 0},handleDragStart:function(e){this.dragging=!0,e.stopImmediatePropagation(),this.setupDragging()},handleDrag:function(e){if(this.prevPageX){var t=e.clientX,a=this.refs,n=a.view,r=a.trackHorizontal,i=r.getBoundingClientRect(),s=i.left,o=this.getThumbHorizontalWidth(),l=o-this.prevPageX,d=-s+t-l;n.scrollLeft=this.getScrollLeftForOffset(d)}if(this.prevPageY){var u=e.clientY,c=this.refs,f=c.view,m=c.trackVertical,h=m.getBoundingClientRect(),p=h.top,g=this.getThumbVerticalHeight(),v=g-this.prevPageY,b=-p+u-v;f.scrollTop=this.getScrollTopForOffset(b)}return!1},handleDragEnd:function(){this.dragging=!1,this.prevPageX=this.prevPageY=0,this.teardownDragging(),this.handleDragEndAutoHide()},handleDragEndAutoHide:function(){this.props.autoHide&&this.hideTracks()},handleTrackMouseEnter:function(){this.trackMouseOver=!0,this.handleTrackMouseEnterAutoHide()},handleTrackMouseEnterAutoHide:function(){this.props.autoHide&&this.showTracks()},handleTrackMouseLeave:function(){this.trackMouseOver=!1,this.handleTrackMouseLeaveAutoHide()},handleTrackMouseLeaveAutoHide:function(){this.props.autoHide&&this.hideTracks()},showTracks:function(){var e=this.refs,t=e.trackHorizontal,a=e.trackVertical;clearTimeout(this.hideTracksTimeout),(0,d.default)(t,{opacity:1}),(0,d.default)(a,{opacity:1})},hideTracks:function(){if(!this.dragging&&!this.scrolling&&!this.trackMouseOver){var e=this.props.autoHideTimeout,t=this.refs,a=t.trackHorizontal,n=t.trackVertical;clearTimeout(this.hideTracksTimeout),this.hideTracksTimeout=setTimeout(function(){(0,d.default)(a,{opacity:0}),(0,d.default)(n,{opacity:0})},e)}},detectScrolling:function(){var e=this;this.scrolling||(this.scrolling=!0,this.handleScrollStart(),this.detectScrollingInterval=setInterval(function(){e.lastViewScrollLeft===e.viewScrollLeft&&e.lastViewScrollTop===e.viewScrollTop&&(clearInterval(e.detectScrollingInterval),e.scrolling=!1,e.handleScrollStop()),e.lastViewScrollLeft=e.viewScrollLeft,e.lastViewScrollTop=e.viewScrollTop},100))},raf:function(e){var t=this;this.requestFrame&&o.default.cancel(this.requestFrame),this.requestFrame=(0,o.default)(function(){t.requestFrame=void 0,e()})},update:function(e){var t=this;this.raf(function(){return t._update(e)})},_update:function(e){var t=this.props,a=t.onUpdate,n=t.hideTracksWhenNotNeeded,r=this.getValues();if((0,h.default)()){var i=this.refs,s=i.thumbHorizontal,o=i.thumbVertical,l=i.trackHorizontal,u=i.trackVertical,c=r.scrollLeft,f=r.clientWidth,m=r.scrollWidth,p=(0,b.default)(l),g=this.getThumbHorizontalWidth(),v=c/(m-f)*(p-g),y={width:g,transform:"translateX("+v+"px)"},_=r.scrollTop,w=r.clientHeight,S=r.scrollHeight,C=(0,E.default)(u),T=this.getThumbVerticalHeight(),M=_/(S-w)*(C-T),k={height:T,transform:"translateY("+M+"px)"};if(n){var P={visibility:m>f?"visible":"hidden"},D={visibility:S>w?"visible":"hidden"};(0,d.default)(l,P),(0,d.default)(u,D)}(0,d.default)(s,y),(0,d.default)(o,k)}a&&a(r),"function"==typeof e&&e(r)},render:function(){var e=(0,h.default)(),t=this.props,a=(t.onScroll,t.onScrollFrame,t.onScrollStart,t.onScrollStop,t.onUpdate,t.renderView),n=t.renderTrackHorizontal,s=t.renderTrackVertical,o=t.renderThumbHorizontal,l=t.renderThumbVertical,d=t.tagName,c=(t.hideTracksWhenNotNeeded,t.autoHide),m=(t.autoHideTimeout,t.autoHideDuration),p=(t.thumbSize,t.thumbMinSize,t.universal),g=t.autoHeight,v=t.autoHeightMin,b=t.autoHeightMax,y=t.style,E=t.children,w=r(t,["onScroll","onScrollFrame","onScrollStart","onScrollStop","onUpdate","renderView","renderTrackHorizontal","renderTrackVertical","renderThumbHorizontal","renderThumbVertical","tagName","hideTracksWhenNotNeeded","autoHide","autoHideTimeout","autoHideDuration","thumbSize","thumbMinSize","universal","autoHeight","autoHeightMin","autoHeightMax","style","children"]),S=this.state.didMountUniversal,C=i({},_.containerStyleDefault,g&&i({},_.containerStyleAutoHeight,{minHeight:v,maxHeight:b}),y),T=i({},_.viewStyleDefault,{marginRight:e?-e:0,marginBottom:e?-e:0},g&&i({},_.viewStyleAutoHeight,{minHeight:(0,f.default)(v)?"calc("+v+" + "+e+"px)":v+e,maxHeight:(0,f.default)(b)?"calc("+b+" + "+e+"px)":b+e}),g&&p&&!S&&{minHeight:v,maxHeight:b},p&&!S&&_.viewStyleUniversalInitial),M={transition:"opacity "+m+"ms",opacity:0},k=i({},_.trackHorizontalStyleDefault,c&&M,(!e||p&&!S)&&{display:"none"}),P=i({},_.trackVerticalStyleDefault,c&&M,(!e||p&&!S)&&{display:"none"});return(0,u.createElement)(d,i({},w,{style:C,ref:"container"}),[(0,u.cloneElement)(a({style:T}),{key:"view",ref:"view"},E),(0,u.cloneElement)(n({style:k}),{key:"trackHorizontal",ref:"trackHorizontal"},(0,u.cloneElement)(o({style:_.thumbHorizontalStyleDefault}),{ref:"thumbHorizontal"})),(0,u.cloneElement)(s({style:P}),{key:"trackVertical",ref:"trackVertical"},(0,u.cloneElement)(l({style:_.thumbVerticalStyleDefault}),{ref:"thumbVertical"}))])}})},2177:function(e,t,a){a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0});t.containerStyleDefault={position:"relative",overflow:"hidden",width:"100%",height:"100%"},t.containerStyleAutoHeight={height:"auto"},t.viewStyleDefault={position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"scroll",WebkitOverflowScrolling:"touch"},t.viewStyleAutoHeight={position:"relative",top:void 0,left:void 0,right:void 0,bottom:void 0},t.viewStyleUniversalInitial={overflow:"hidden",marginRight:0,marginBottom:0},t.trackHorizontalStyleDefault={position:"absolute",height:6},t.trackVerticalStyleDefault={position:"absolute",width:6},t.thumbHorizontalStyleDefault={position:"relative",display:"block",height:"100%"},t.thumbVerticalStyleDefault={position:"relative",display:"block",width:"100%"},t.disableSelectStyle={userSelect:"none"},t.disableSelectStyleReset={userSelect:""}},2178:function(e,t,a){function n(e){return e&&e.__esModule?e:{default:e}}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.Scrollbars=void 0;var r=a(2176),i=n(r);t.default=i.default,t.Scrollbars=i.default},2179:function(e,t,a){function n(e){var t=e.clientHeight,a=getComputedStyle(e),n=a.paddingTop,r=a.paddingBottom;return t-parseFloat(n)-parseFloat(r)}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2180:function(e,t,a){function n(e){var t=e.clientWidth,a=getComputedStyle(e),n=a.paddingLeft,r=a.paddingRight;return t-parseFloat(n)-parseFloat(r)}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2181:function(e,t,a){function n(e){return e&&e.__esModule?e:{default:e}}function r(){if(!1!==o)return o;if("undefined"!=typeof document){var e=document.createElement("div");(0,s.default)(e,{width:100,height:100,position:"absolute",top:-9999,overflow:"scroll",MsOverflowStyle:"scrollbar"}),document.body.appendChild(e),o=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}else o=0;return o||0}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var i=a(1795),s=n(i),o=!1},2182:function(e,t,a){function n(e){return"string"==typeof e}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2183:function(e,t,a){function n(){return!1}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2191:function(e,t,a){var n=(a(0),a(0),{});n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var a={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":a.relatedAddress=t[n+1];break;case"rport":a.relatedPort=parseInt(t[n+1],10);break;case"tcptype":a.tcpType=t[n+1]}return a},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var a=e.type;return t.push("typ"),t.push(a),"host"!==a&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),a={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),a.name=t[0],a.clockRate=parseInt(t[1],10),a.numChannels=3===t.length?parseInt(t[2],10):1,a},n.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,a={},n=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<n.length;r++)t=n[r].trim().split("="),a[t[0].trim()]=t[1];return a},n.writeFmtp=function(e){var t="",a=e.payloadType;if(void 0!==e.preferredPayloadType&&(a=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){n.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+a+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",a=e.payloadType;return void 0!==e.preferredPayloadType&&(a=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+a+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),a={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(a.attribute=e.substr(t+1,n-t-1),a.value=e.substr(n+1)):a.attribute=e.substr(t+1),a},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.getDtlsParameters=function(e,t){var a=n.splitLines(e);a=a.concat(n.splitLines(t));var r=a.filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:r.split(" ")[0].toLowerCase(),value:r.split(" ")[1]}]}},n.writeDtlsParameters=function(e,t){var a="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){a+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),a},n.getIceParameters=function(e,t){var a=n.splitLines(e);return a=a.concat(n.splitLines(t)),{usernameFragment:a.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:a.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=n.splitLines(e),r=a[0].split(" "),i=3;i<r.length;i++){var s=r[i],o=n.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){var l=n.parseRtpMap(o),d=n.matchPrefix(e,"a=fmtp:"+s+" ");switch(l.parameters=d.length?n.parseFmtp(d[0]):{},l.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(n.parseRtcpFb),t.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(l.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var a="";a+="m="+e+" ",a+=t.codecs.length>0?"9":"0",a+=" UDP/TLS/RTP/SAVPF ",a+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",a+="c=IN IP4 0.0.0.0\r\n",a+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){a+=n.writeRtpMap(e),a+=n.writeFmtp(e),a+=n.writeRtcpFb(e)});var r=0;return t.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),r>0&&(a+="a=maxptime:"+r+"\r\n"),a+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){a+=n.writeExtmap(e)}),a},n.parseRtpEncodingParameters=function(e){var t,a=[],r=n.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),s=-1!==r.fecMechanisms.indexOf("ULPFEC"),o=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),l=o.length>0&&o[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===l&&(t=d[0][1]),r.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:l,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};a.push(n),i&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:t,mechanism:s?"red+ulpfec":"red"},a.push(n))}}),0===a.length&&l&&a.push({ssrc:l});var u=n.matchPrefix(e,"b=");return u.length&&(0===u[0].indexOf("b=TIAS:")?u=parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")&&(u=parseInt(u[0].substr(5),10)),a.forEach(function(e){e.maxBitrate=u})),a},n.parseRtcpParameters=function(e){var t={},a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];a&&(t.cname=a.value,t.ssrc=a.ssrc);var r=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;var i=n.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},n.parseMsid=function(e){var t,a=n.matchPrefix(e,"a=msid:");if(1===a.length)return t=a[0].substr(7).split(" "),{stream:t[0],track:t[1]};var r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return r.length>0?(t=r[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,a,r){var i=n.writeRtpDescription(e.kind,t);if(i+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===a?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var s="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+s,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),i},n.getDirection=function(e,t){for(var a=n.splitLines(e),r=0;r<a.length;r++)switch(a[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[r].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},e.exports=n},2199:function(e,t,a){function n(e){return r(e).replace(/\s(\w)/g,function(e,t){return t.toUpperCase()})}var r=(a(0),a(0),a(2201));e.exports=n},2200:function(e,t,a){function n(e){return s.test(e)?e.toLowerCase():o.test(e)?(r(e)||e).toLowerCase():l.test(e)?i(e).toLowerCase():e.toLowerCase()}function r(e){return e.replace(d,function(e,t){return t?" "+t:""})}function i(e){return e.replace(u,function(e,t,a){return t+" "+a.toLowerCase().split("").join(" ")})}a(0),a(0);e.exports=n;var s=/\s/,o=/(_|-|\.|:)/,l=/([a-z][A-Z]|[A-Z][a-z])/,d=/[\W_]+(.|$)/g,u=/(.)([A-Z]+)/g},2201:function(e,t,a){function n(e){return r(e).replace(/[\W_]+(.|$)/g,function(e,t){return t?" "+t:""}).trim()}var r=(a(0),a(0),a(2200));e.exports=n},2204:function(e,t,a){a(0),a(0);!function(){var t=a(1743),n=t.log,r=t.browserDetails;e.exports.browserDetails=r,e.exports.extractVersion=t.extractVersion,e.exports.disableLog=t.disableLog;var i=a(2205)||null,s=a(2207)||null,o=a(2209)||null,l=a(2211)||null;switch(r.browser){case"chrome":if(!i||!i.shimPeerConnection)return void n("Chrome shim is not included in this adapter release.");n("adapter.js shimming chrome."),e.exports.browserShim=i,i.shimGetUserMedia(),i.shimMediaStream(),t.shimCreateObjectURL(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack(),i.shimGetSendersWithDtmf();break;case"firefox":if(!o||!o.shimPeerConnection)return void n("Firefox shim is not included in this adapter release.");n("adapter.js shimming firefox."),e.exports.browserShim=o,o.shimGetUserMedia(),t.shimCreateObjectURL(),o.shimSourceObject(),o.shimPeerConnection(),o.shimOnTrack();break;case"edge":if(!s||!s.shimPeerConnection)return void n("MS edge shim is not included in this adapter release.");n("adapter.js shimming edge."),e.exports.browserShim=s,s.shimGetUserMedia(),t.shimCreateObjectURL(),s.shimPeerConnection();break;case"safari":if(!l)return void n("Safari shim is not included in this adapter release.");n("adapter.js shimming safari."),e.exports.browserShim=l,l.shimGetUserMedia();break;default:n("Unsupported browser!")}}()},2205:function(e,t,a){var n=(a(0),a(0),a(1743).log),r=a(1743).browserDetails,i={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(a){var n=new Event("track");n.track=a.track,n.receiver={track:a.track},n.streams=[e.stream],t.dispatchEvent(n)}),e.stream.getTracks().forEach(function(t){var a=new Event("track");a.track=t,a.receiver={track:t},a.streams=[e.stream],this.dispatchEvent(a)}.bind(this))}.bind(this))}})},shimGetSendersWithDtmf:function(){if("object"==typeof window&&window.RTCPeerConnection&&!("getSenders"in RTCPeerConnection.prototype)&&"createDTMFSender"in RTCPeerConnection.prototype){RTCPeerConnection.prototype.getSenders=function(){return this._senders};var e=RTCPeerConnection.prototype.addStream,t=RTCPeerConnection.prototype.removeStream;RTCPeerConnection.prototype.addStream=function(t){var a=this;a._senders=a._senders||[],e.apply(a,[t]),t.getTracks().forEach(function(e){a._senders.push({track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=a.createDTMFSender(e):this._dtmf=null),this._dtmf}})})},RTCPeerConnection.prototype.removeStream=function(e){var a=this;a._senders=a._senders||[],t.apply(a,[e]),e.getTracks().forEach(function(e){var t=a._senders.find(function(t){return t.track===e});t&&a._senders.splice(a._senders.indexOf(t),1)})}}},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;if(this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),!e)return void(this.src="");this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})}}))},shimPeerConnection:function(){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){return n("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy),new webkitRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}));var e=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(t,a,n){var r=this,i=arguments;if(arguments.length>0&&"function"==typeof t)return e.apply(this,arguments);if(0===e.length&&(0===arguments.length||"function"!=typeof arguments[0]))return e.apply(this,[]);var s=function(e){var t={};return e.result().forEach(function(e){var a={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){a[t]=e.stat(t)}),t[a.id]=a}),t},o=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var l=function(e){i[1](o(s(e)))};return e.apply(this,[l,arguments[0]])}return new Promise(function(t,a){e.apply(r,[function(e){t(o(s(e)))},a])}).then(a,n)},r.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){var e=arguments,a=this,n=new Promise(function(n,r){t.apply(a,[e[0],n,r])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),r.version<52&&["createOffer","createAnswer"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var a=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,r){t.apply(e,[n,r,a])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var t=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:i.shimMediaStream,shimOnTrack:i.shimOnTrack,shimGetSendersWithDtmf:i.shimGetSendersWithDtmf,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:a(2206)}},2206:function(e,t,a){var n=(a(0),a(0),a(1743).log),r=a(1743).browserDetails;e.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(a){if("require"!==a&&"advanced"!==a&&"mediaSource"!==a){var n="object"==typeof e[a]?e[a]:{ideal:e[a]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var i={};"number"==typeof n.ideal?(i[r("min",a)]=n.ideal,t.optional.push(i),i={},i[r("max",a)]=n.ideal,t.optional.push(i)):(i[r("",a)]=n.ideal,t.optional.push(i))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",a)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,a)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,a){if(t=JSON.parse(JSON.stringify(t)),t&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var i=t.video.facingMode;i=i&&("object"==typeof i?i:{ideal:i});var s=r.version<59;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||s)&&(delete t.video.facingMode,"environment"===i.exact||"environment"===i.ideal))return navigator.mediaDevices.enumerateDevices().then(function(r){r=r.filter(function(e){return"videoinput"===e.kind});var s=r.find(function(e){return-1!==e.label.toLowerCase().indexOf("back")})||r.length&&r[r.length-1];return s&&(t.video.deviceId=i.exact?{exact:s.deviceId}:{ideal:s.deviceId}),t.video=e(t.video),n("chrome: "+JSON.stringify(t)),a(t)});t.video=e(t.video)}return n("chrome: "+JSON.stringify(t)),a(t)},a=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},i=function(e,n,r){t(e,function(e){navigator.webkitGetUserMedia(e,n,function(e){r(a(e))})})};navigator.getUserMedia=i;var s=function(e){return new Promise(function(t,a){navigator.getUserMedia(e,t,a)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:s,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(a){e(a.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),navigator.mediaDevices.getUserMedia){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return o(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(a(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return s(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){n("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){n("Dummy mediaDevices.removeEventListener called.")})}},2207:function(e,t,a){function n(e){var t=e.filter(function(e){return"audio"===e.kind}),a=e.filter(function(e){return"video"===e.kind});for(e=[];t.length||a.length;)t.length&&e.push(t.shift()),a.length&&e.push(a.shift());return e}function r(e){var t=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var a=e.urls||e.url,n="string"==typeof a;return n&&(a=[a]),a=a.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||t?0===e.indexOf("stun:")&&s.version>=14393:(t=!0,!0)}),delete e.url,e.urls=n?a[0]:a,!!a.length}return!1})}var i=(a(0),a(0),a(2191)),s=a(1743).browserDetails,o={shimPeerConnection:function(){if(window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e}),s.version<15025)){var e=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(t){e.set.call(this,t);var a=new Event("enabled");a.enabled=t,this.dispatchEvent(a)}})}window.RTCPeerConnection=function(e){var t=this,a=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=a[e].bind(a)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy}this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers&&(this.iceOptions.iceServers=r(e.iceServers)),this._config=e,this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=i.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(a){if(a.candidate&&0!==Object.keys(a.candidate).length)t[a.candidate.sdpMLineIndex+1]+="a="+a.candidate.candidate+"\r\n";else for(var n=1;n<t.length;n++)-1===t[n].indexOf("\r\na=end-of-candidates\r\n")&&(t[n]+="a=end-of-candidates\r\n");if(e.localDescription.sdp=t.join(""),e.dispatchEvent(a),null!==e.onicecandidate&&e.onicecandidate(a),!a.candidate&&"complete"!==e.iceGatheringState){e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&"complete"!==e.iceGatheringStateChange&&(e.iceGatheringState="complete",e._emitGatheringStateChange())}}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.getConfiguration=function(){return this._config},window.RTCPeerConnection.prototype.addStream=function(e){if(s.version>=15025)this.localStreams.push(e);else{var t=e.clone();e.getTracks().forEach(function(e,a){var n=t.getTracks()[a];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),this.localStreams.push(t)}this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var a={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var a=0;a<t.length;a++)if(t[a].payloadType===e||t[a].preferredPayloadType===e)return t[a]},r=function(e,t,a,r){var i=n(e.parameters.apt,a),s=n(t.parameters.apt,r);return i&&s&&i.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(n){for(var i=0;i<t.codecs.length;i++){var s=t.codecs[i];if(n.name.toLowerCase()===s.name.toLowerCase()&&n.clockRate===s.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&s.parameters.apt&&!r(n,s,e.codecs,t.codecs))continue;s=JSON.parse(JSON.stringify(s)),s.numChannels=Math.min(n.numChannels,s.numChannels),a.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var r=t.headerExtensions[n];if(e.uri===r.uri){a.headerExtensions.push(r);break}}}),a},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var a=this,n=new RTCIceGatherer(a.iceOptions),r=new RTCIceTransport(n);n.onlocalcandidate=function(s){var o=new Event("icecandidate");o.candidate={sdpMid:e,sdpMLineIndex:t};var l=s.candidate,d=!l||0===Object.keys(l).length;d?void 0===n.state&&(n.state="completed"):(l.component="RTCP"===r.component?2:1,o.candidate.candidate=i.writeCandidate(l));var u=i.splitSections(a.localDescription.sdp);u[o.candidate.sdpMLineIndex+1]+=d?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",a.localDescription.sdp=u.join("");var c=a._pendingOffer?a._pendingOffer:a.transceivers,f=c.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(a.iceGatheringState){case"new":d||a._localIceCandidatesBuffer.push(o),d&&f&&a._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":a._emitBufferedCandidates(),d||(a.dispatchEvent(o),null!==a.onicecandidate&&a.onicecandidate(o)),f&&(a.dispatchEvent(new Event("icecandidate")),null!==a.onicecandidate&&a.onicecandidate(new Event("icecandidate")),a.iceGatheringState="complete",a._emitGatheringStateChange())}},r.onicestatechange=function(){a._updateConnectionState()};var s=new RTCDtlsTransport(r);return s.ondtlsstatechange=function(){a._updateConnectionState()},s.onerror=function(){s.state="failed",a._updateConnectionState()},{iceGatherer:n,iceTransport:r,dtlsTransport:s}},window.RTCPeerConnection.prototype._transceive=function(e,t,a){var n=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(n.encodings=e.sendEncodingParameters,n.rtcp={cname:i.localCName},e.recvEncodingParameters.length&&(n.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(n)),a&&e.rtpReceiver&&("video"===e.kind&&e.recvEncodingParameters&&s.version<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),n.encodings=e.recvEncodingParameters,n.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(n.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(n))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t,a,n=this;if("offer"===e.type)this._pendingOffer&&(t=i.splitSections(e.sdp),a=t.shift(),t.forEach(function(e,t){var a=i.parseRtpParameters(e);n._pendingOffer[t].localCapabilities=a}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=i.splitSections(n.remoteDescription.sdp),a=t.shift();var r=i.matchPrefix(a,"a=ice-lite").length>0;t.forEach(function(e,t){var s=n.transceivers[t],o=s.iceGatherer,l=s.iceTransport,d=s.dtlsTransport,u=s.localCapabilities,c=s.remoteCapabilities;if("0"!==e.split("\n",1)[0].split(" ",2)[1]&&!s.isDatachannel){var f=i.getIceParameters(e,a),m=i.getDtlsParameters(e,a);r&&(m.role="server"),n.usingBundle&&0!==t||(l.start(o,f,r?"controlling":"controlled"),d.start(m));var h=n._getCommonCapabilities(u,c);n._transceive(s,h.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var s=arguments.length>1&&"function"==typeof arguments[1];if(s){var o=arguments[1];window.setTimeout(function(){o(),"new"===n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),n._emitBufferedCandidates()},0)}var l=Promise.resolve();return l.then(function(){s||("new"===n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),window.setTimeout(n._emitBufferedCandidates.bind(n),500))}),l},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,a=new MediaStream,n=[],r=i.splitSections(e.sdp),o=r.shift(),l=i.matchPrefix(o,"a=ice-lite").length>0;switch(this.usingBundle=i.matchPrefix(o,"a=group:BUNDLE ").length>0,r.forEach(function(r,d){var u=i.splitLines(r),c=u[0].substr(2).split(" "),f=c[0],m="0"===c[1],h=i.getDirection(r,o),p=i.matchPrefix(r,"a=mid:");if(p=p.length?p[0].substr(6):i.generateIdentifier(),"application"===f&&"DTLS/SCTP"===c[2])return void(t.transceivers[d]={mid:p,isDatachannel:!0});var g,v,b,y,E,_,w,S,C,T,M,k,P=i.parseRtpParameters(r);m||(M=i.getIceParameters(r,o),k=i.getDtlsParameters(r,o),k.role="client"),S=i.parseRtpEncodingParameters(r);var D,I=i.matchPrefix(r,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];I&&(D=I.value);var N=i.matchPrefix(r,"a=end-of-candidates",o).length>0,L=i.matchPrefix(r,"a=candidate:").map(function(e){return i.parseCandidate(e)}).filter(function(e){return"1"===e.component});if("offer"!==e.type||m)"answer"!==e.type||m||(g=t.transceivers[d],v=g.iceGatherer,b=g.iceTransport,y=g.dtlsTransport,E=g.rtpSender,_=g.rtpReceiver,w=g.sendEncodingParameters,C=g.localCapabilities,t.transceivers[d].recvEncodingParameters=S,t.transceivers[d].remoteCapabilities=P,t.transceivers[d].cname=D,(l||N)&&L.length&&b.setRemoteCandidates(L),t.usingBundle&&0!==d||(b.start(v,M,"controlling"),y.start(k)),t._transceive(g,"sendrecv"===h||"recvonly"===h,"sendrecv"===h||"sendonly"===h),!_||"sendrecv"!==h&&"sendonly"!==h?delete g.rtpReceiver:(T=_.track,n.push([T,_]),a.addTrack(T)));else{var O=t.usingBundle&&d>0?{iceGatherer:t.transceivers[0].iceGatherer,iceTransport:t.transceivers[0].iceTransport,dtlsTransport:t.transceivers[0].dtlsTransport}:t._createIceAndDtlsTransports(p,d);if(!N||t.usingBundle&&0!==d||O.iceTransport.setRemoteCandidates(L),C=RTCRtpReceiver.getCapabilities(f),s.version<15019&&(C.codecs=C.codecs.filter(function(e){return"rtx"!==e.name})),w=[{ssrc:1001*(2*d+2)}],"sendrecv"!==h&&"sendonly"!==h||(_=new RTCRtpReceiver(O.dtlsTransport,f),T=_.track,n.push([T,_]),a.addTrack(T)),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=d){var R;"audio"===f?R=t.localStreams[0].getAudioTracks()[0]:"video"===f&&(R=t.localStreams[0].getVideoTracks()[0]),R&&(s.version>=15019&&"video"===f&&(w[0].rtx={ssrc:1001*(2*d+2)+1}),E=new RTCRtpSender(R,O.dtlsTransport))}t.transceivers[d]={iceGatherer:O.iceGatherer,iceTransport:O.iceTransport,dtlsTransport:O.dtlsTransport,localCapabilities:C,remoteCapabilities:P,rtpSender:E,rtpReceiver:_,kind:f,mid:p,cname:D,sendEncodingParameters:w,recvEncodingParameters:S},t._transceive(t.transceivers[d],!1,"sendrecv"===h||"sendonly"===h)}}),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return a.getTracks().length&&(t.remoteStreams.push(a),window.setTimeout(function(){var e=new Event("addstream");e.stream=a,t.dispatchEvent(e),null!==t.onaddstream&&window.setTimeout(function(){t.onaddstream(e)},0),n.forEach(function(e){var n=e[0],r=e[1],i=new Event("track");i.track=n,i.receiver=r,i.streams=[a],t.dispatchEvent(i),null!==t.ontrack&&window.setTimeout(function(){t.ontrack(i)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,a={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){a[e.iceTransport.state]++,a[e.dtlsTransport.state]++}),a.connected+=a.completed,e="new",a.failed>0?e="failed":a.connecting>0||a.checking>0?e="connecting":a.disconnected>0?e="disconnected":a.new>0?e="new":(a.connected>0||a.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},window.RTCPeerConnection.prototype.createOffer=function(){var e=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var t;1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var a=[],r=0,o=0;if(this.localStreams.length&&(r=this.localStreams[0].getAudioTracks().length,o=this.localStreams[0].getVideoTracks().length),t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(r=t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(o=t.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){a.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?r>0:o>0}),"audio"===e.kind?r--:"video"===e.kind&&o--});r>0||o>0;)r>0&&(a.push({kind:"audio",wantReceive:!0}),r--),o>0&&(a.push({kind:"video",wantReceive:!0}),o--);a=n(a);var l=i.writeSessionBoilerplate(),d=[];a.forEach(function(t,a){var n=t.track,r=t.kind,o=i.generateIdentifier(),l=e.usingBundle&&a>0?{iceGatherer:d[0].iceGatherer,iceTransport:d[0].iceTransport,dtlsTransport:d[0].dtlsTransport}:e._createIceAndDtlsTransports(o,a),u=RTCRtpSender.getCapabilities(r);s.version<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var c,f,m=[{ssrc:1001*(2*a+1)}];n&&(s.version>=15019&&"video"===r&&(m[0].rtx={ssrc:1001*(2*a+1)+1}),c=new RTCRtpSender(n,l.dtlsTransport)),t.wantReceive&&(f=new RTCRtpReceiver(l.dtlsTransport,r)),d[a]={iceGatherer:l.iceGatherer,iceTransport:l.iceTransport,dtlsTransport:l.dtlsTransport,localCapabilities:u,remoteCapabilities:null,rtpSender:c,rtpReceiver:f,kind:r,mid:o,sendEncodingParameters:m,recvEncodingParameters:null}}),this.usingBundle&&(l+="a=group:BUNDLE "+d.map(function(e){return e.mid}).join(" ")+"\r\n"),a.forEach(function(t,a){var n=d[a];l+=i.writeMediaSection(n,n.localCapabilities,"offer",e.localStreams[0])}),this._pendingOffer=d;var u=new RTCSessionDescription({type:"offer",sdp:l});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,u),Promise.resolve(u)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=i.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(a){if(a.isDatachannel)return void(t+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+a.mid+"\r\n");var n=e._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);t+=i.writeMediaSection(a,n,"answer",e.localStreams[0])});var a=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,a),Promise.resolve(a)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<this.transceivers.length;a++)if(this.transceivers[a].mid===e.sdpMid){t=a;break}var n=this.transceivers[t];if(n){var r=Object.keys(e.candidate).length>0?i.parseCandidate(e.candidate):{};if("tcp"===r.protocol&&(0===r.port||9===r.port))return Promise.resolve();if("1"!==r.component)return Promise.resolve();n.iceTransport.addRemoteCandidate(r);var s=i.splitSections(this.remoteDescription.sdp);s[t+1]+=(r.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=s.join("")}}else for(var o=0;o<this.transceivers.length;o++)if(this.transceivers[o].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(a){t[a]&&e.push(t[a].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],a=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(n){var r=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=a(e[t]),r.set(t,e[t])})}),t&&window.setTimeout(t,0,r),n(r)})})}}};e.exports={shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:a(2208)}},2208:function(e,t,a){a(0),a(0);e.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){return t(a).catch(function(t){return Promise.reject(e(t))})}}},2209:function(e,t,a){var n=(a(0),a(0),a(1743).browserDetails),r={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var a=new Event("track");a.track=t,a.receiver={track:t},a.streams=[e.stream],this.dispatchEvent(a)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(n.version<38&&e&&e.iceServers){for(var a=[],r=0;r<e.iceServers.length;r++){var i=e.iceServers[r];if(i.hasOwnProperty("urls"))for(var s=0;s<i.urls.length;s++){var o={url:i.urls[s]};0===i.urls[s].indexOf("turn")&&(o.username=i.username,o.credential=i.credential),a.push(o)}else a.push(e.iceServers[r])}e.iceServers=a}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var t=function(e){var t=new Map;return Object.keys(e).forEach(function(a){t.set(a,e[a]),t[a]=e[a]}),t},a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,i,s){return r.apply(this,[e||null]).then(function(e){if(n.version<48&&(e=t(e)),n.version<53&&!i)try{e.forEach(function(e){e.type=a[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:a[t.type]||t.type}))})}return e}).then(i,s)}}}};e.exports={shimOnTrack:r.shimOnTrack,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:a(2210)}},2210:function(e,t,a){var n=(a(0),a(0),a(1743).log),r=a(1743).browserDetails;e.exports=function(){var e=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,a,i){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(a){if("require"!==a&&"advanced"!==a&&"mediaSource"!==a){var n=e[a]="object"==typeof e[a]?e[a]:{ideal:e[a]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(a),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[a]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var r={};"number"==typeof n.ideal?r[a]={min:n.ideal,max:n.ideal}:r[a]=n.ideal,e.advanced.push(r),delete n.ideal,Object.keys(n).length||delete e[a]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),r.version<38&&(n("spec: "+JSON.stringify(t)),t.audio&&(t.audio=s(t.audio)),t.video&&(t.video=s(t.video)),n("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,a,function(t){i(e(t))})},a=function(e){return new Promise(function(a,n){t(e,a,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},r.version<41){var i=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return i().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(r.version<49){var s=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return s(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(t){return Promise.reject(e(t))})}}navigator.getUserMedia=function(e,a,n){if(r.version<44)return t(e,a,n);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(a,n)}}},2211:function(e,t,a){var n=(a(0),a(0),{shimGetUserMedia:function(){navigator.getUserMedia||(navigator.webkitGetUserMedia?navigator.getUserMedia=navigator.webkitGetUserMedia.bind(navigator):navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(e,t,a){navigator.mediaDevices.getUserMedia(e).then(t,a)}.bind(navigator)))}});e.exports={shimGetUserMedia:n.shimGetUserMedia}},2212:function(e,t,a){function n(e){function t(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="",n=0;n<e;n++){var r=Math.floor(Math.random()*t.length);a+=t.substring(r,r+1)}return a}function a(){if(null!=X){if(n.debug("Long poll..."),!J)return void n.warn("Is the gateway down? (connected=false)");var t=V+"/"+X+"?rid="+(new Date).getTime();void 0!==q&&null!==q&&(t=t+"&maxev="+q),null!==Y&&void 0!==Y&&(t=t+"&token="+Y),null!==K&&void 0!==K&&(t=t+"&apisecret="+K),n.ajax({type:"GET",url:t,cache:!1,timeout:6e4,success:s,error:function(t,r,i){if(n.error(r+": "+i),++Q>3)return J=!1,void e.error("Lost connection to the gateway (is it down?)");a()},dataType:"json"})}}function s(e){if(Q=0,F||void 0===X||null===X||setTimeout(a,200),F||!Array.isArray(e)){if("keepalive"===e.janus)return void n.vdebug("Got a keepalive on session "+X);if("ack"!==e.janus)if("success"!==e.janus){if("webrtcup"===e.janus){n.debug("Got a webrtcup event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var r=Z[t];return void 0===r||null===r?void n.warn("This handle is not attached to this session"):void r.webrtcState(!0)}if("hangup"===e.janus){n.debug("Got a hangup event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var r=Z[t];if(void 0===r||null===r)return void n.warn("This handle is not attached to this session");r.webrtcState(!1),r.hangup()}else if("detached"===e.janus){n.debug("Got a detached event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var r=Z[t];if(void 0===r||null===r)return;r.ondetached(),r.detach()}else if("media"===e.janus){n.debug("Got a media event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var r=Z[t];if(void 0===r||null===r)return void n.warn("This handle is not attached to this session");r.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){n.debug("Got a slowlink event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var r=Z[t];if(void 0===r||null===r)return void n.warn("This handle is not attached to this session");r.slowLink(e.uplink,e.nacks)}else{if("error"===e.janus){n.error("Ooops: "+e.error.code+" "+e.error.reason),n.debug(e);var i=e.transaction;if(null!==i&&void 0!==i){var o=ee[i];null!==o&&void 0!==o&&o(e),delete ee[i]}return}if("event"===e.janus){n.debug("Got a plugin event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var l=e.plugindata;if(void 0===l||null===l)return void n.warn("Missing plugindata...");n.debug("  -- Event is coming from "+t+" ("+l.plugin+")");var d=l.data;n.debug(d);var r=Z[t];if(void 0===r||null===r)return void n.warn("This handle is not attached to this session");var u=e.jsep;void 0!==u&&null!==u&&(n.debug("Handling SDP as well..."),n.debug(u));var c=r.onmessage;null!==c&&void 0!==c?(n.debug("Notifying application..."),c(d,u)):n.debug("No provided notification callback")}else n.warn("Unkown message/event  '"+e.janus+"' on session "+X),n.debug(e)}}else{n.debug("Got a success on session "+X),n.debug(e);var i=e.transaction;if(null!==i&&void 0!==i){var o=ee[i];null!==o&&void 0!==o&&o(e),delete ee[i]}}else{n.debug("Got an ack on session "+X),n.debug(e);var i=e.transaction;if(null!==i&&void 0!==i){var o=ee[i];null!==o&&void 0!==o&&o(e),delete ee[i]}}}else for(var f=0;f<e.length;f++)s(e[f])}function o(){if(null!==V&&F&&J){j=setTimeout(o,3e4);var e={janus:"keepalive",session_id:X,transaction:t(12)};null!==Y&&void 0!==Y&&(e.token=Y),null!==K&&void 0!==K&&(e.apisecret=K),x.send(JSON.stringify(e))}}function l(r){var i=t(12),d={janus:"create",transaction:i};if(null!==Y&&void 0!==Y&&(d.token=Y),null!==K&&void 0!==K&&(d.apisecret=K),null===V&&Array.isArray(H)&&(V=H[B],0===V.indexOf("ws")?(F=!0,n.log("Server #"+(B+1)+": trying WebSockets to contact Janus ("+V+")")):(F=!1,n.log("Server #"+(B+1)+": trying REST API to contact Janus ("+V+")"))),F){x=new WebSocket(V,"janus-protocol"),U={error:function(){if(n.error("Error connecting to the Janus WebSockets server... "+V),Array.isArray(H))return++B==H.length?void r.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(V=null,void setTimeout(function(){l(r)},200));r.error("Error connecting to the Janus WebSockets server: Is the gateway down?")},open:function(){ee[i]=function(e){if(n.debug(e),"success"!==e.janus)return n.error("Ooops: "+e.error.code+" "+e.error.reason),void r.error(e.error.reason);j=setTimeout(o,3e4),J=!0,X=e.data.id,n.log("Created session: "+X),n.sessions[X]=$,r.success()},x.send(JSON.stringify(d))},message:function(e){s(JSON.parse(e.data))},close:function(){null!==V&&J&&(J=!1,e.error("Lost connection to the gateway (is it down?)"))}};for(var u in U)x.addEventListener(u,U[u])}else n.ajax({type:"POST",url:V,cache:!1,contentType:"application/json",data:JSON.stringify(d),success:function(e){if(n.debug(e),"success"!==e.janus)return n.error("Ooops: "+e.error.code+" "+e.error.reason),void r.error(e.error.reason);J=!0,X=e.data.id,n.log("Created session: "+X),n.sessions[X]=$,a(),r.success()},error:function(e,t,a){if(n.error(t+": "+a),Array.isArray(H))return++B==H.length?void r.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(V=null,void setTimeout(function(){l(r)},200));""===a?r.error(t+": Is the gateway down?"):r.error(t+": "+a)},dataType:"json"})}function d(a){a=a||{},a.success="function"==typeof a.success?a.success:n.noop;var r=!0;if(void 0!==a.asyncRequest&&null!==a.asyncRequest&&(r=!0===a.asyncRequest),n.log("Destroying session "+X+" (async="+r+")"),!J)return n.warn("Is the gateway down? (connected=false)"),void a.success();if(void 0===X||null===X)return n.warn("No session to destroy"),a.success(),void e.destroyed();delete n.sessions[X];for(var i in Z){var s=Z[i];n.log("Destroying handle "+s.id+" ("+s.plugin+")"),p(s.id,{asyncRequest:r})}var o={janus:"destroy",transaction:t(12)};if(null!==Y&&void 0!==Y&&(o.token=Y),null!==K&&void 0!==K&&(o.apisecret=K),F){o.session_id=X;var l=function(){for(var e in U)x.removeEventListener(e,U[e]);x.removeEventListener("message",d),x.removeEventListener("error",u),j&&clearTimeout(j)},d=function(t){var n=JSON.parse(t.data);n.session_id==o.session_id&&n.transaction==o.transaction&&(l(),a.success(),e.destroyed())},u=function(t){l(),a.error("Failed to destroy the gateway: Is the gateway down?"),e.destroyed()};return x.addEventListener("message",d),x.addEventListener("error",u),void x.send(JSON.stringify(o))}n.ajax({type:"POST",url:V+"/"+X,async:r,cache:!1,contentType:"application/json",data:JSON.stringify(o),success:function(t){n.log("Destroyed session:"),n.debug(t),X=null,J=!1,"success"!==t.janus&&n.error("Ooops: "+t.error.code+" "+t.error.reason),a.success(),e.destroyed()},error:function(t,r,i){n.error(r+": "+i),X=null,J=!1,a.success(),e.destroyed()},dataType:"json"})}function u(e){if(e=e||{},e.success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:n.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:n.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:n.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:n.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:n.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:n.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:n.noop,e.ondata="function"==typeof e.ondata?e.ondata:n.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:n.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:n.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:n.noop,!J)return n.warn("Is the gateway down? (connected=false)"),void e.error("Is the gateway down? (connected=false)");var a=e.plugin;if(void 0===a||null===a)return n.error("Invalid plugin"),void e.error("Invalid plugin");var r=t(12),i={janus:"attach",plugin:a,transaction:r};if(null!==Y&&void 0!==Y&&(i.token=Y),null!==K&&void 0!==K&&(i.apisecret=K),F)return ee[r]=function(t){if(n.debug(t),"success"!==t.janus)return n.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;n.log("Created handle: "+r);var i={session:$,plugin:a,id:r,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return a},getVolume:function(){return w(r)},isAudioMuted:function(){return S(r,!1)},muteAudio:function(){return C(r,!1,!0)},unmuteAudio:function(){return C(r,!1,!1)},isVideoMuted:function(){return S(r,!0)},muteVideo:function(){return C(r,!0,!0)},unmuteVideo:function(){return C(r,!0,!1)},getBitrate:function(){return T(r)},send:function(e){c(r,e)},data:function(e){m(r,e)},dtmf:function(e){h(r,e)},consentDialog:e.consentDialog,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){v(r,e)},createAnswer:function(e){v(r,e)},handleRemoteJsep:function(e){b(r,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){k(r,!0===e)},detach:function(e){p(r,e)}};Z[r]=i,e.success(i)},i.session_id=X,void x.send(JSON.stringify(i));n.ajax({type:"POST",url:V+"/"+X,cache:!1,contentType:"application/json",data:JSON.stringify(i),success:function(t){if(n.debug(t),"success"!==t.janus)return n.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;n.log("Created handle: "+r);var i={session:$,plugin:a,id:r,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return a},getVolume:function(){return w(r)},isAudioMuted:function(){return S(r,!1)},muteAudio:function(){return C(r,!1,!0)},unmuteAudio:function(){return C(r,!1,!1)},isVideoMuted:function(){return S(r,!0)},muteVideo:function(){return C(r,!0,!0)},unmuteVideo:function(){return C(r,!0,!1)},getBitrate:function(){return T(r)},send:function(e){c(r,e)},data:function(e){m(r,e)},dtmf:function(e){h(r,e)},consentDialog:e.consentDialog,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){v(r,e)},createAnswer:function(e){v(r,e)},handleRemoteJsep:function(e){b(r,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){k(r,!0===e)},detach:function(e){p(r,e)}};Z[r]=i,e.success(i)},error:function(e,t,a){n.error(t+": "+a)},dataType:"json"})}function c(e,a){if(a=a||{},a.success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop,!J)return n.warn("Is the gateway down? (connected=false)"),void a.error("Is the gateway down? (connected=false)");var r=a.message,i=a.jsep,s=t(12),o={janus:"message",body:r,transaction:s};if(null!==Y&&void 0!==Y&&(o.token=Y),null!==K&&void 0!==K&&(o.apisecret=K),null!==i&&void 0!==i&&(o.jsep=i),n.debug("Sending message to plugin (handle="+e+"):"),n.debug(o),F)return o.session_id=X,o.handle_id=e,ee[s]=function(e){if(n.debug("Message sent!"),n.debug(e),"success"===e.janus){var t=e.plugindata;if(void 0===t||null===t)return n.warn("Request succeeded, but missing plugindata..."),void a.success();n.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return n.debug(r),void a.success(r)}if("ack"!==e.janus)return void(void 0!==e.error&&null!==e.error?(n.error("Ooops: "+e.error.code+" "+e.error.reason),a.error(e.error.code+" "+e.error.reason)):(n.error("Unknown error"),a.error("Unknown error")));a.success()},void x.send(JSON.stringify(o));n.ajax({type:"POST",url:V+"/"+X+"/"+e,cache:!1,contentType:"application/json",data:JSON.stringify(o),success:function(e){if(n.debug("Message sent!"),n.debug(e),"success"===e.janus){var t=e.plugindata;if(void 0===t||null===t)return n.warn("Request succeeded, but missing plugindata..."),void a.success();n.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return n.debug(r),void a.success(r)}if("ack"!==e.janus)return void(void 0!==e.error&&null!==e.error?(n.error("Ooops: "+e.error.code+" "+e.error.reason),a.error(e.error.code+" "+e.error.reason)):(n.error("Unknown error"),a.error("Unknown error")));a.success()},error:function(e,t,r){n.error(t+": "+r),a.error(t+": "+r)},dataType:"json"})}function f(e,a){if(!J)return void n.warn("Is the gateway down? (connected=false)");var r={janus:"trickle",candidate:a,transaction:t(12)};if(null!==Y&&void 0!==Y&&(r.token=Y),null!==K&&void 0!==K&&(r.apisecret=K),n.vdebug("Sending trickle candidate (handle="+e+"):"),n.vdebug(r),F)return r.session_id=X,r.handle_id=e,void x.send(JSON.stringify(r));n.ajax({type:"POST",url:V+"/"+X+"/"+e,cache:!1,contentType:"application/json",data:JSON.stringify(r),success:function(e){if(n.vdebug("Candidate sent!"),n.vdebug(e),"ack"!==e.janus)return void n.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t,a){n.error(t+": "+a)},dataType:"json"})}function m(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=Z[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var r=a.webrtcStuff,i=t.text;if(null===i||void 0===i)return n.warn("Invalid text"),void t.error("Invalid text");n.log("Sending string on data channel: "+i),r.dataChannel.send(i),t.success()}function h(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=Z[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var r=a.webrtcStuff;if(null===r.dtmfSender||void 0===r.dtmfSender){if(void 0!==r.myStream&&null!==r.myStream){var i=r.myStream.getAudioTracks();if(null!==i&&void 0!==i&&i.length>0){var s=i[0];r.dtmfSender=r.pc.createDTMFSender(s),n.log("Created DTMF Sender"),r.dtmfSender.ontonechange=function(e){n.debug("Sent DTMF tone: "+e.tone)}}}if(null===r.dtmfSender||void 0===r.dtmfSender)return n.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var o=t.dtmf;if(null===o||void 0===o)return n.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var l=o.tones;if(null===l||void 0===l)return n.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var d=o.duration;null!==d&&void 0!==d||(d=500);var u=o.gap;null!==u&&void 0!==u||(u=50),n.debug("Sending DTMF string "+l+" (duration "+d+"ms, gap "+u+"ms)"),r.dtmfSender.insertDTMF(l,d,u)}function p(e,a){a=a||{},a.success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop;var r=!0;if(void 0!==a.asyncRequest&&null!==a.asyncRequest&&(r=!0===a.asyncRequest),n.log("Destroying handle "+e+" (sync="+r+")"),k(e),!J)return n.warn("Is the gateway down? (connected=false)"),void a.error("Is the gateway down? (connected=false)");var i={janus:"detach",transaction:t(12)};if(null!==Y&&void 0!==Y&&(i.token=Y),null!==K&&void 0!==K&&(i.apisecret=K),F)return i.session_id=X,i.handle_id=e,x.send(JSON.stringify(i)),delete Z[e],void a.success();n.ajax({type:"POST",url:V+"/"+X+"/"+e,async:r,cache:!1,contentType:"application/json",data:JSON.stringify(i),success:function(t){n.log("Destroyed handle:"),n.debug(t),"success"!==t.janus&&n.error("Ooops: "+t.error.code+" "+t.error.reason),delete Z[e],a.success()},error:function(t,r,i){n.error(r+": "+i),delete Z[e],a.success()},dataType:"json"})}function g(e,t,a,r,s){var o=Z[e];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return n.warn("Invalid handle"),void r.error("Invalid handle");var l=o.webrtcStuff;n.debug("streamsDone:",s),l.myStream=s;var d={iceServers:G,iceTransportPolicy:z},u={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===W&&u.optional.push({googIPv6:!0}),"edge"===i.browserDetails.browser&&(d.bundlePolicy="max-bundle"),n.log("Creating PeerConnection"),n.debug(u),l.pc=new RTCPeerConnection(d,u),n.debug(l.pc),l.pc.getStats&&(l.volume.value=0,l.bitrate.value="0 kbits/sec"),n.log("Preparing local SDP and gathering candidates (trickle="+l.trickle+")"),l.pc.onicecandidate=function(t){if(null==t.candidate||"edge"===i.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)n.log("End of candidates."),l.iceDone=!0,!0===l.trickle?f(e,{completed:!0}):_(e,r);else{var a={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===l.trickle&&f(e,a)}},null!==s&&void 0!==s&&(n.log("Adding local stream"),l.pc.addStream(s),o.onlocalstream(s)),l.pc.onaddstream=function(e){n.log("Handling Remote Stream"),n.debug(e),l.remoteStream=e,o.onremotestream(e.stream)},R(a)){n.log("Creating data channel");var c=function(e){n.log("Received message on data channel: "+e.data),o.ondata(e.data)},m=function(){var e=null!==l.dataChannel?l.dataChannel.readyState:"null";n.log("State change on data channel: "+e),"open"===e&&o.ondataopen()},h=function(e){n.error("Got error on data channel:",e)};l.dataChannel=l.pc.createDataChannel("JanusDataChannel",{ordered:!1}),l.dataChannel.onmessage=c,l.dataChannel.onopen=m,l.dataChannel.onclose=m,l.dataChannel.onerror=h}null===t||void 0===t?y(e,a,r):("edge"===i.browserDetails.browser&&(t.sdp+="a=end-of-candidates\r\n"),l.pc.setRemoteDescription(new RTCSessionDescription(t),function(){n.log("Remote description accepted!"),E(e,a,r)},r.error))}function v(e,t){function a(a,n){l.consentDialog(!1),a?t.error({code:a.code,name:a.name,message:a.message}):g(e,s,o,t,n)}function r(e,t){n.log("Adding media constraint (screen capture)"),n.debug(e),navigator.mediaDevices.getUserMedia(e).then(function(e){t(null,e)}).catch(function(e){l.consentDialog(!1),t(e)})}t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:M;var s=t.jsep,o=t.media,l=Z[e];if(null===l||void 0===l||null===l.webrtcStuff||void 0===l.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var d=l.webrtcStuff;if(void 0!==d.pc&&null!==d.pc)return n.log("Updating existing media session"),void(null===s||void 0===s?y(e,o,t):("edge"===i.browserDetails.browser&&(s.sdp+="a=end-of-candidates\r\n"),d.pc.setRemoteDescription(new RTCSessionDescription(s),function(){n.log("Remote description accepted!"),E(e,o,t)},t.error)));if(null!==t.stream&&void 0!==t.stream){var u=t.stream;return n.log("MediaStream provided by the application"),n.debug(u),d.streamExternal=!0,void g(e,s,o,t,u)}if(d.trickle=A(t.trickle),P(o)||N(o)){var c={mandatory:{},optional:[]};l.consentDialog(!0);var f=P(o);!0===f&&void 0!=o&&null!=o&&"object"==typeof o.audio&&(f=o.audio);var m=N(o);if(!0===m&&void 0!=o&&null!=o)if(o.video&&"screen"!=o.video&&"window"!=o.video){var h=0,p=0,v=0;if("lowres"===o.video)p=240,v=240,h=320;else if("lowres-16:9"===o.video)p=180,v=180,h=320;else if("hires"===o.video||"hires-16:9"===o.video){if(p=720,v=720,h=1280,navigator.mozGetUserMedia){var b=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);b<38&&(n.warn(o.video+" unsupported, falling back to stdres (old Firefox)"),p=480,v=480,h=640)}}else"stdres"===o.video?(p=480,v=480,h=640):"stdres-16:9"===o.video?(p=360,v=360,h=640):(n.log("Default video setting ("+o.video+") is stdres 4:3"),p=480,v=480,h=640);if(n.log("Adding media constraint "+o.video),navigator.mozGetUserMedia){var b=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);m=b<38?{require:["height","width"],height:{max:v,min:p},width:{max:h,min:h}}:{height:{ideal:p},width:{ideal:h}}}else m={mandatory:{maxHeight:v,minHeight:p,maxWidth:h,minWidth:h},optional:[]};"object"==typeof o.video&&(m=o.video),n.debug(m)}else if("screen"===o.video||"window"===o.video){if("https:"!==window.location.protocol)return n.warn("Screen sharing only works on HTTPS, try the https:// version of this page"),l.consentDialog(!1),void t.error("Screen sharing only works on HTTPS, try the https:// version of this page");var _={};if("chrome"===i.browserDetails.browser){var w=i.browserDetails.version,S=33;if(window.navigator.userAgent.match("Linux")&&(S=35),w>=26&&w<=S)c={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}},audio:P(o)},r(c,a);else{var C=window.setTimeout(function(){return k=new Error("NavigatorUserMediaError"),k.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',l.consentDialog(!1),t.error(k)},1e3);_[C]=[a,null],window.postMessage({type:"janusGetScreen",id:C},"*")}}else if(window.navigator.userAgent.match("Firefox")){var T=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);if(!(T>=33)){var k=new Error("NavigatorUserMediaError");return k.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",l.consentDialog(!1),void t.error(k)}c={video:{mozMediaSource:o.video,mediaSource:o.video},audio:P(o)},r(c,function(e,t){if(a(e,t),!e)var n=t.currentTime,r=window.setInterval(function(){t||window.clearInterval(r),t.currentTime==n&&(window.clearInterval(r),t.onended&&t.onended()),n=t.currentTime},500)})}return void window.addEventListener("message",function(e){if(e.origin==window.location.origin)if("janusGotScreen"==e.data.type&&_[e.data.id]){var a=_[e.data.id],n=a[0];if(delete _[e.data.id],""===e.data.sourceId){var i=new Error("NavigatorUserMediaError");i.name="You cancelled the request for permission, giving up...",l.consentDialog(!1),t.error(i)}else c={audio:P(o),video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},c.video.mandatory.chromeMediaSourceId=e.data.sourceId,r(c,n)}else"janusGetScreenPending"==e.data.type&&window.clearTimeout(e.data.id)})}null!==o&&void 0!==o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then(function(a){var n=a.some(function(e){return"audioinput"===e.kind}),r=a.some(function(e){return"videoinput"===e.kind}),i=P(o),d=N(o),u=D(o),c=L(o);if(i||d||u||c){var h=!!i&&n,p=!!d&&r;if(!h&&!p)return l.consentDialog(!1),t.error("No capture device found"),!1;if(!h&&u)return l.consentDialog(!1),t.error("Audio capture is required, but no capture device found"),!1;if(!p&&c)return l.consentDialog(!1),t.error("Video capture is required, but no capture device found"),!1}navigator.mediaDevices.getUserMedia({audio:!!n&&f,video:!!r&&m}).then(function(a){l.consentDialog(!1),g(e,s,o,t,a)}).catch(function(e){l.consentDialog(!1),t.error({code:e.code,name:e.name,message:e.message})})}).catch(function(e){l.consentDialog(!1),t.error("enumerateDevices error",e)})}else g(e,s,o,t)}function b(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:M;var a=t.jsep,r=Z[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var s=r.webrtcStuff;if(void 0!==a&&null!==a){if(null===s.pc)return n.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");"edge"===i.browserDetails.browser&&(a.sdp+="a=end-of-candidates\r\n"),s.pc.setRemoteDescription(new RTCSessionDescription(a),function(){n.log("Remote description accepted!"),t.success()},t.error)}else t.error("Invalid JSEP")}function y(e,t,a){a=a||{},a.success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop;var r=Z[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var s=r.webrtcStuff;n.log("Creating offer (iceDone="+s.iceDone+")");var o=null;o="firefox"==i.browserDetails.browser||"edge"==i.browserDetails.browser?{offerToReceiveAudio:I(t),offerToReceiveVideo:O(t)}:{mandatory:{OfferToReceiveAudio:I(t),OfferToReceiveVideo:O(t)}},n.debug(o),s.pc.createOffer(function(e){if(n.debug(e),null!==s.mySdp&&void 0!==s.mySdp||(n.log("Setting local description"),s.mySdp=e.sdp,s.pc.setLocalDescription(e)),!s.iceDone&&!s.trickle)return void n.log("Waiting for all candidates...");if(s.sdpSent)return void n.log("Offer already sent, not sending it again");n.log("Offer ready"),n.debug(a),s.sdpSent=!0;var t={type:e.type,sdp:e.sdp};a.success(t)},a.error,o)}function E(e,t,a){a=a||{},a.success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop;var r=Z[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var s=r.webrtcStuff;n.log("Creating answer (iceDone="+s.iceDone+")");var o=null;o="firefox"==i.browserDetails.browser||"edge"==i.browserDetails.browser?{offerToReceiveAudio:I(t),offerToReceiveVideo:O(t)}:{mandatory:{OfferToReceiveAudio:I(t),OfferToReceiveVideo:O(t)}},n.debug(o),s.pc.createAnswer(function(e){if(n.debug(e),null!==s.mySdp&&void 0!==s.mySdp||(n.log("Setting local description"),s.mySdp=e.sdp,s.pc.setLocalDescription(e)),!s.iceDone&&!s.trickle)return void n.log("Waiting for all candidates...");if(s.sdpSent)return void n.log("Answer already sent, not sending it again");s.sdpSent=!0;var t={type:e.type,sdp:e.sdp};a.success(t)},a.error,o)}function _(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=Z[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return void n.warn("Invalid handle, not sending anything");var r=a.webrtcStuff;return n.log("Sending offer/answer SDP..."),null===r.mySdp||void 0===r.mySdp?void n.warn("Local SDP instance is invalid, not sending anything..."):(r.mySdp={type:r.pc.localDescription.type,sdp:r.pc.localDescription.sdp},r.sdpSent?void n.log("Offer/Answer SDP already sent, not sending it again"):(!1===r.trickle&&(r.mySdp.trickle=!1),n.debug(t),r.sdpSent=!0,void t.success(r.mySdp)))}function w(e){var t=Z[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return n.warn("Invalid handle"),0;var a=t.webrtcStuff;return a.pc.getStats&&"chrome"==i.browserDetails.browser?null===a.remoteStream||void 0===a.remoteStream?(n.warn("Remote stream unavailable"),0):null===a.volume.timer||void 0===a.volume.timer?(n.log("Starting volume monitor"),a.volume.timer=setInterval(function(){a.pc.getStats(function(e){for(var t=e.result(),n=0;n<t.length;n++){var r=t[n];"ssrc"==r.type&&r.stat("audioOutputLevel")&&(a.volume.value=r.stat("audioOutputLevel"))}})},200),0):a.volume.value:(n.log("Getting the remote volume unsupported by browser"),0)}function S(e,t){var a=Z[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return n.warn("Invalid handle"),!0;var r=a.webrtcStuff;return null===r.pc||void 0===r.pc?(n.warn("Invalid PeerConnection"),!0):void 0===r.myStream||null===r.myStream?(n.warn("Invalid local MediaStream"),!0):t?null===r.myStream.getVideoTracks()||void 0===r.myStream.getVideoTracks()||0===r.myStream.getVideoTracks().length?(n.warn("No video track"),!0):!r.myStream.getVideoTracks()[0].enabled:null===r.myStream.getAudioTracks()||void 0===r.myStream.getAudioTracks()||0===r.myStream.getAudioTracks().length?(n.warn("No audio track"),!0):!r.myStream.getAudioTracks()[0].enabled}function C(e,t,a){var r=Z[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return n.warn("Invalid handle"),!1;var i=r.webrtcStuff;return null===i.pc||void 0===i.pc?(n.warn("Invalid PeerConnection"),!1):void 0===i.myStream||null===i.myStream?(n.warn("Invalid local MediaStream"),!1):t?null===i.myStream.getVideoTracks()||void 0===i.myStream.getVideoTracks()||0===i.myStream.getVideoTracks().length?(n.warn("No video track"),!1):(i.myStream.getVideoTracks()[0].enabled=a,!0):null===i.myStream.getAudioTracks()||void 0===i.myStream.getAudioTracks()||0===i.myStream.getAudioTracks().length?(n.warn("No audio track"),!1):(i.myStream.getAudioTracks()[0].enabled=a,!0)}function T(e){var t=Z[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return n.warn("Invalid handle"),"Invalid handle";var a=t.webrtcStuff;if(null===a.pc||void 0===a.pc)return"Invalid PeerConnection";if(a.pc.getStats&&"chrome"==i.browserDetails.browser)return null===a.remoteStream||void 0===a.remoteStream?(n.warn("Remote stream unavailable"),"Remote stream unavailable"):null===a.bitrate.timer||void 0===a.bitrate.timer?(n.log("Starting bitrate timer (Chrome)"),a.bitrate.timer=setInterval(function(){a.pc.getStats(function(e){for(var t=e.result(),n=0;n<t.length;n++){var r=t[n];if("ssrc"==r.type&&r.stat("googFrameHeightReceived"))if(a.bitrate.bsnow=r.stat("bytesReceived"),a.bitrate.tsnow=r.timestamp,null===a.bitrate.bsbefore||null===a.bitrate.tsbefore)a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow;else{var i=Math.round(8*(a.bitrate.bsnow-a.bitrate.bsbefore)/(a.bitrate.tsnow-a.bitrate.tsbefore));a.bitrate.value=i+" kbits/sec",a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow}}})},1e3),"0 kbits/sec"):a.bitrate.value;if(a.pc.getStats&&"firefox"==i.browserDetails.browser){if(null===a.remoteStream||void 0===a.remoteStream||null===a.remoteStream.stream||void 0===a.remoteStream.stream)return n.warn("Remote stream unavailable"),"Remote stream unavailable";var r=a.remoteStream.stream.getVideoTracks();return null===r||void 0===r||r.length<1?(n.warn("No video track"),"No video track"):null===a.bitrate.timer||void 0===a.bitrate.timer?(n.log("Starting bitrate timer (Firefox)"),a.bitrate.timer=setInterval(function(){var e=function(e){if(null===e||void 0===e||null==e.inbound_rtp_video_1||null==e.inbound_rtp_video_1)return void(a.bitrate.value="Missing inbound_rtp_video_1");if(a.bitrate.bsnow=e.inbound_rtp_video_1.bytesReceived,a.bitrate.tsnow=e.inbound_rtp_video_1.timestamp,null===a.bitrate.bsbefore||null===a.bitrate.tsbefore)a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow;else{var t=Math.round(8*(a.bitrate.bsnow-a.bitrate.bsbefore)/(a.bitrate.tsnow-a.bitrate.tsbefore));a.bitrate.value=t+" kbits/sec",a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow}};a.pc.getStats(r[0],function(t){e(t)},e)},1e3),"0 kbits/sec"):a.bitrate.value}return n.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"}function M(e){n.error("WebRTC error:",e)}function k(e,a){n.log("Cleaning WebRTC stuff");var i=Z[e];if(null!==i&&void 0!==i){var s=i.webrtcStuff;if(null!==s&&void 0!==s){if(!0===a){var o={janus:"hangup",transaction:t(12)};null!==Y&&void 0!==Y&&(o.token=Y),null!==K&&void 0!==K&&(o.apisecret=K),n.debug("Sending hangup request (handle="+e+"):"),n.debug(o),F?(o.session_id=X,o.handle_id=e,x.send(JSON.stringify(o))):r.ajax({type:"POST",url:V+"/"+X+"/"+e,cache:!1,contentType:"application/json",data:JSON.stringify(o),dataType:"json"})}s.remoteStream=null,s.volume.timer&&clearInterval(s.volume.timer),s.volume.value=null,s.bitrate.timer&&clearInterval(s.bitrate.timer),s.bitrate.timer=null,s.bitrate.bsnow=null,s.bitrate.bsbefore=null,s.bitrate.tsnow=null,s.bitrate.tsbefore=null,s.bitrate.value=null;try{s.streamExternal||null===s.myStream||void 0===s.myStream||(n.log("Stopping local stream"),s.myStream.stop())}catch(e){}try{if(!s.streamExternal&&null!==s.myStream&&void 0!==s.myStream){n.log("Stopping local stream tracks");var l=s.myStream.getTracks();for(var d in l){var u=l[d];n.log(u),null!==u&&void 0!==u&&u.stop()}}}catch(e){}s.streamExternal=!1,s.myStream=null;try{s.pc.close()}catch(e){}s.pc=null,s.mySdp=null,s.iceDone=!1,s.sdpSent=!1,s.dataChannel=null,s.dtmfSender=null}i.oncleanup()}}function P(e){return n.debug("isAudioSendEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function D(e){return n.debug("isAudioSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function I(e){return n.debug("isAudioRecvEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function N(e){return n.debug("isVideoSendEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function L(e){return n.debug("isVideoSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function O(e){return n.debug("isVideoRecvEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function R(e){return n.debug("isDataEnabled:",e),"edge"==i.browserDetails.browser?(n.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function A(e){return n.debug("isTrickleEnabled:",e),void 0===e||null===e||!0===e}if(void 0===n.initDone)return e.error("Library not initialized"),{};if(!n.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(n.log("Library initialized: "+n.initDone),e=e||{},e.success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:n.noop,null===e.server||void 0===e.server)return e.error("Invalid gateway url"),{};var F=!1,x=null,U={},j=null,H=null,B=0,V=e.server;Array.isArray(V)?(n.log("Multiple servers provided ("+V.length+"), will use the first that works"),V=null,H=e.server,n.debug(H)):0===V.indexOf("ws")?(F=!0,n.log("Using WebSockets to contact Janus: "+V)):(F=!1,n.log("Using REST API to contact Janus: "+V));var G=e.iceServers;void 0!==G&&null!==G&&0!==G.length||(G=[{urls:"stun:stun.l.google.com:19302"}],n.log("using ice",G));var z=e.iceTransportPolicy,W=e.ipv6;void 0!==W&&null!==W||(W=!1);var q=null;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(q=e.max_poll_events),q<1&&(q=1);var Y=null;void 0!==e.token&&null!==e.token&&(Y=e.token);var K=null;void 0!==e.apisecret&&null!==e.apisecret&&(K=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var J=!1,X=null,Z={},$=this,Q=0,ee={};l(e),this.getServer=function(){return V},this.isConnected=function(){return J},this.getSessionId=function(){return X},this.destroy=function(e){d(e,!0)},this.attach=function(e){u(e)}}var r=a(0),i=(a(0),a(2204));n.sessions={},n.extensionId="hapfgfdkleiggjjpfpenajgdnfckjpaj",n.isExtensionEnabled=function(){if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||null!==document.getElementById("janus-extension-installed")}return!0},n.noop=function(){},n.init=function(e){function t(t){function n(){r++,r<t.length?a(t[r],n):e.callback()}t&&Array.isArray(t)&&0!=t.length||e.callback();var r=0;a(t[r],n)}function a(e,t){try{if(i)return n.debug(e+" already loaded, skipping"),void t()}catch(e){}var a=document.getElementsByTagName("head").item(0),r=document.createElement("script");r.type="text/javascript",r.src=e,r.onload=function(){n.log("Library "+e+" loaded"),t()},a.appendChild(r)}if(e=e||{},e.callback="function"==typeof e.callback?e.callback:n.noop,!0===n.initDone)e.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),n.trace=n.noop,n.debug=n.noop,n.vdebug=n.noop,n.log=n.noop,n.warn=n.noop,n.error=n.noop,!0===e.debug||"all"===e.debug)n.trace=console.trace.bind(console),n.debug=console.debug.bind(console),n.vdebug=console.debug.bind(console),n.log=console.log.bind(console),n.warn=console.warn.bind(console),n.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var r in e.debug){var s=e.debug[r];switch(s){case"trace":n.trace=console.trace.bind(console);break;case"debug":n.debug=console.debug.bind(console);break;case"vdebug":n.vdebug=console.debug.bind(console);break;case"log":n.log=console.log.bind(console);break;case"warn":n.warn=console.warn.bind(console);break;case"error":n.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+s+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}n.log("Initializing library"),n.listDevices=function(e){e="function"==typeof e?e:n.noop,navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(t){navigator.mediaDevices.enumerateDevices().then(function(a){n.debug(a),e(a);try{t.stop()}catch(e){}try{var r=t.getTracks();for(var i in r){var s=r[i];null!==s&&void 0!==s&&s.stop()}}catch(e){}})}).catch(function(t){n.error(t),e([])}):(n.warn("navigator.mediaDevices unavailable"),e([]))},n.attachMediaStream=function(e,t){if("chrome"===i.browserDetails.browser){i.browserDetails.version>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):n.error("Error attaching stream to element")}else e.srcObject=t},n.reattachMediaStream=function(e,t){if("chrome"===i.browserDetails.browser){i.browserDetails.version>=43?e.srcObject=t.srcObject:void 0!==e.src&&(e.src=t.src)}else e.srcObject=t.srcObject},n.ajax=function(e){if(null!==e&&void 0!==e){if(e.success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,null===e.url||void 0===e.url)return n.error("Missing url",e.url),void e.error(null,-1,"Missing url");e.async=null===e.async||void 0===e.async||!0===e.async,n.log(e);var t=new XMLHttpRequest;t.open(e.type,e.url,e.async),null!==e.contentType&&void 0!==e.contentType&&t.setRequestHeader("Content-type",e.contentType),e.async&&(t.onreadystatechange=function(){if(4==t.readyState)return 200!==t.status?(0===t.status&&(t.status="error"),void e.error(t,t.status,"")):void e.success(JSON.parse(t.responseText))});try{if(t.send(e.data),!e.async){if(200!==t.status)return 0===t.status&&(t.status="error"),void e.error(t,t.status,"");e.success(JSON.parse(t.responseText))}}catch(a){e.error(t,"error","")}}};var o=window.onbeforeunload;window.onbeforeunload=function(){n.log("Closing window");for(var e in n.sessions)null!==n.sessions[e]&&void 0!==n.sessions[e]&&n.sessions[e].destroyOnUnload&&(n.log("Destroying session "+e),n.sessions[e].destroy({asyncRequest:!1}));o&&"function"==typeof o&&o()},n.initDone=!0,t(["adapter.js"])}},n.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection&&void 0!==navigator.getUserMedia&&null!==navigator.getUserMedia},e.exports=n}});
//# sourceMappingURL=6.f832ec0c055fcc7c9b4b.js.map